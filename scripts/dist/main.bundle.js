/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t,e){if(!t)throw n(e)},n=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},i=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,l=a?t[e+2]:0,c=s>>2,h=(3&s)<<4|o>>4;let u=(15&o)<<2|l>>6,d=63&l;a||(d=64,r||(u=64)),i.push(n[c],n[h],n[u],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const l=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==l)throw new r;const c=s<<2|o>>4;if(i.push(c),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==l){const t=a<<6&192|l;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){const e=i(t);return s.encodeByteArray(e,!0)},a=function(t){return o(t).replace(/\./g,"")},l=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function c(t){return h(void 0,t)}function h(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=h(t[n],e[n]));return t}const u=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const t="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&l(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},d=t=>{var e,n;return null===(n=null===(e=u())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},p=t=>{const e=d(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]},f=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config},g=t=>{var e;return null===(e=u())||void 0===e?void 0:e[`_${t}`]};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function _(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(r)),""].join(".")}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function v(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())}function b(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function w(){try{return"object"==typeof indexedDB}catch(t){return!1}}function x(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class k extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,I.prototype.create)}}class I{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(C,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new k(i,o,n)}}const C=/\{\$([^}]+)}/g;function T(t){return JSON.parse(t)}function E(t){return JSON.stringify(t)}const S=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=T(l(r[0])||""),n=T(l(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:i,signature:s}};function P(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function M(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function O(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function D(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(N(n)&&N(r)){if(!D(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function N(t){return null!==t&&"object"==typeof t}function A(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function L(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}})),e}function F(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class U{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"==typeof t)for(let i=0;i<16;i++)n[i]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let i=0;i<16;i++)n[i]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let t=16;t<80;t++){const e=n[t-3]^n[t-8]^n[t-14]^n[t-16];n[t]=4294967295&(e<<1|e>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let t=0;t<80;t++){t<40?t<20?(i=l^o&(a^l),s=1518500249):(i=o^a^l,s=1859775393):t<60?(i=o&a|l&(o|a),s=2400959708):(i=o^a^l,s=3395469782);const e=(r<<5|r>>>27)+i+c+s+n[t]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=r,r=e}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const n=e-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<e;){if(0===r)for(;i<=n;)this.compress_(t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(s[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<e;)if(s[r]=t[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let t=this.blockSize-1;t>=56;t--)this.buf_[t]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let e=0;e<5;e++)for(let i=24;i>=0;i-=8)t[n]=this.chain_[e]>>i&255,++n;return t}}class j{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=B),void 0===i.error&&(i.error=B),void 0===i.complete&&(i.complete=B);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}})),this.observers.push(i),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function B(){}function z(t,e){return`${t} failed: ${e} argument `}const W=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};function V(t){return t&&t._delegate?t._delegate:t}class H{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const q="[DEFAULT]";class ${constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new m;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:q})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=q){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=q){return this.instances.has(t)}getOptions(t=q){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===q?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=q){return this.component?this.component.multipleInstances?t:q:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class K{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new $(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const Y=[];var G;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(G||(G={}));const X={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},J=G.INFO,Q={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},Z=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=Q[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class tt{constructor(t){this.name=t,this._logLevel=J,this._logHandler=Z,this._userLogHandler=null,Y.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in G))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?X[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...t),this._logHandler(this,G.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...t),this._logHandler(this,G.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,G.INFO,...t),this._logHandler(this,G.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,G.WARN,...t),this._logHandler(this,G.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...t),this._logHandler(this,G.ERROR,...t)}}let et,nt;const it=new WeakMap,st=new WeakMap,rt=new WeakMap,ot=new WeakMap,at=new WeakMap;let lt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return st.get(t);if("objectStoreNames"===e)return t.objectStoreNames||rt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ht(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function ct(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(nt||(nt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ut(this),t),ht(it.get(this))}:function(...t){return ht(e.apply(ut(this),t))}:function(t,...n){const i=e.call(ut(this),t,...n);return rt.set(i,t.sort?t.sort():[t]),ht(i)}:(t instanceof IDBTransaction&&function(t){if(st.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));st.set(t,e)}(t),n=t,(et||(et=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,lt):t);var e,n}function ht(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(ht(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&it.set(e,t)})).catch((()=>{})),at.set(e,t),e}(t);if(ot.has(t))return ot.get(t);const e=ct(t);return e!==t&&(ot.set(t,e),at.set(e,t)),e}const ut=t=>at.get(t),dt=["get","getKey","getAll","getAllKeys","count"],pt=["put","add","delete","clear"],ft=new Map;function gt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(ft.get(e))return ft.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=pt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!dt.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return ft.set(e,r),r}var mt;mt=lt,lt={...mt,get:(t,e,n)=>gt(t,e)||mt.get(t,e,n),has:(t,e)=>!!gt(t,e)||mt.has(t,e)};class _t{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const yt="@firebase/app",vt="0.9.13",bt=new tt("@firebase/app"),wt="@firebase/app-compat",xt="@firebase/analytics-compat",kt="@firebase/analytics",It="@firebase/app-check-compat",Ct="@firebase/app-check",Tt="@firebase/auth",Et="@firebase/auth-compat",St="@firebase/database",Pt="@firebase/database-compat",Rt="@firebase/functions",Mt="@firebase/functions-compat",Ot="@firebase/installations",Dt="@firebase/installations-compat",Nt="@firebase/messaging",At="@firebase/messaging-compat",Lt="@firebase/performance",Ft="@firebase/performance-compat",Ut="@firebase/remote-config",jt="@firebase/remote-config-compat",Bt="@firebase/storage",zt="@firebase/storage-compat",Wt="@firebase/firestore",Vt="@firebase/firestore-compat",Ht="firebase",qt="[DEFAULT]",$t={[yt]:"fire-core",[wt]:"fire-core-compat",[kt]:"fire-analytics",[xt]:"fire-analytics-compat",[Ct]:"fire-app-check",[It]:"fire-app-check-compat",[Tt]:"fire-auth",[Et]:"fire-auth-compat",[St]:"fire-rtdb",[Pt]:"fire-rtdb-compat",[Rt]:"fire-fn",[Mt]:"fire-fn-compat",[Ot]:"fire-iid",[Dt]:"fire-iid-compat",[Nt]:"fire-fcm",[At]:"fire-fcm-compat",[Lt]:"fire-perf",[Ft]:"fire-perf-compat",[Ut]:"fire-rc",[jt]:"fire-rc-compat",[Bt]:"fire-gcs",[zt]:"fire-gcs-compat",[Wt]:"fire-fst",[Vt]:"fire-fst-compat","fire-js":"fire-js",[Ht]:"fire-js-all"},Kt=new Map,Yt=new Map;function Gt(t,e){try{t.container.addComponent(e)}catch(n){bt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xt(t){const e=t.name;if(Yt.has(e))return bt.debug(`There were multiple attempts to register component ${e}.`),!1;Yt.set(e,t);for(const e of Kt.values())Gt(e,t);return!0}function Jt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const Qt=new I("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Zt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new H("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Qt.create("app-deleted",{appName:this._name})}}const te="9.23.0";function ee(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:qt,automaticDataCollectionEnabled:!1},e),s=i.name;if("string"!=typeof s||!s)throw Qt.create("bad-app-name",{appName:String(s)});if(n||(n=f()),!n)throw Qt.create("no-options");const r=Kt.get(s);if(r){if(D(n,r.options)&&D(i,r.config))return r;throw Qt.create("duplicate-app",{appName:s})}const o=new K(s);for(const t of Yt.values())o.addComponent(t);const a=new Zt(n,i,o);return Kt.set(s,a),a}function ne(t=qt){const e=Kt.get(t);if(!e&&t===qt&&f())return ee();if(!e)throw Qt.create("no-app",{appName:t});return e}function ie(t,e,n){var i;let s=null!==(i=$t[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void bt.warn(t.join(" "))}Xt(new H(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const se="firebase-heartbeat-store";let re=null;function oe(){return re||(re=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=ht(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(ht(o.result),t.oldVersion,t.newVersion,ht(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(se)}}).catch((t=>{throw Qt.create("idb-open",{originalErrorMessage:t.message})}))),re}async function ae(t,e){try{const n=(await oe()).transaction(se,"readwrite"),i=n.objectStore(se);await i.put(e,le(t)),await n.done}catch(t){if(t instanceof k)bt.warn(t.message);else{const e=Qt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});bt.warn(e.message)}}}function le(t){return`${t.name}!${t.options.appId}`}class ce{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ue(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=he();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=he(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),de(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),de(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function he(){return(new Date).toISOString().substring(0,10)}class ue{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!w()&&x().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await oe();return await e.transaction(se).objectStore(se).get(le(t))}catch(t){if(t instanceof k)bt.warn(t.message);else{const e=Qt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});bt.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ae(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function de(t){return a(JSON.stringify({version:2,heartbeats:t})).length}function pe(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n}Xt(new H("platform-logger",(t=>new _t(t)),"PRIVATE")),Xt(new H("heartbeat",(t=>new ce(t)),"PRIVATE")),ie(yt,vt,""),ie(yt,vt,"esm2017"),ie("fire-js",""),ie("firebase","9.23.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const fe=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ge=new I("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),me=new tt("@firebase/auth");function _e(t,...e){me.logLevel<=G.ERROR&&me.error(`Auth (${te}): ${t}`,...e)}function ye(t,...e){throw be(t,...e)}function ve(t,...e){return be(t,...e)}function be(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return ge.create(t,...e)}function we(t,e,...n){if(!t)throw be(e,...n)}function xe(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _e(e),new Error(e)}function ke(t,e){t||xe(e)}function Ie(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function Ce(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}function Te(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Ce()||"https:"===Ce()||function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||"connection"in navigator))||navigator.onLine}class Ee{constructor(t,e){this.shortDelay=t,this.longDelay=e,ke(e>t,"Short delay should be less than long delay!"),this.isMobile=v()||b()}get(){return Te()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Se(t,e){ke(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Pe{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void xe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void xe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void xe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Re={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Me=new Ee(3e4,6e4);function Oe(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function De(t,e,n,i,s={}){return Ne(t,s,(async()=>{let s={},r={};i&&("GET"===e?r=i:s={body:JSON.stringify(i)});const o=A(Object.assign({key:t.config.apiKey},r)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),Pe.fetch()(Le(t,t.config.apiHost,n,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Ne(t,e,n){t._canInitEmulator=!1;const i=Object.assign(Object.assign({},Re),e);try{const e=new Fe(t),s=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Ue(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const e=s.ok?r.errorMessage:r.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ue(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ue(t,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ue(t,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(t,e,n){const i=Object.assign(Object.assign({},fe()),{[e]:n});return new I("auth","Firebase",i).create(e,{appName:t.name})}(t,a,o);ye(t,a)}}catch(e){if(e instanceof k)throw e;ye(t,"network-request-failed",{message:String(e)})}}async function Ae(t,e,n,i,s={}){const r=await De(t,e,n,i,s);return"mfaPendingCredential"in r&&ye(t,"multi-factor-auth-required",{_serverResponse:r}),r}function Le(t,e,n,i){const s=`${e}${n}?${i}`;return t.config.emulator?Se(t.config,s):`${t.config.apiScheme}://${s}`}class Fe{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(ve(this.auth,"network-request-failed"))),Me.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ue(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=ve(t,e,i);return s.customData._tokenResponse=n,s}function je(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function Be(t){return 1e3*Number(t)}function ze(t){const[e,n,i]=t.split(".");if(void 0===e||void 0===n||void 0===i)return _e("JWT malformed, contained fewer than 3 sections"),null;try{const t=l(n);return t?JSON.parse(t):(_e("Failed to decode base64 JWT payload"),null)}catch(t){return _e("Caught error parsing JWT payload as JSON",null==t?void 0:t.toString()),null}}async function We(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof k&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Ve{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class He{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=je(this.lastLoginAt),this.creationTime=je(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function qe(t){var e;const n=t.auth,i=await t.getIdToken(),s=await We(t,async function(t,e){return De(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:i}));we(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];t._notifyReloadListener(r);const o=(null===(e=r.providerUserInfo)||void 0===e?void 0:e.length)?r.providerUserInfo.map((t=>{var{providerId:e}=t,n=pe(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(l=t.providerData,c=o,[...l.filter((t=>!c.some((e=>e.providerId===t.providerId)))),...c]);var l,c;const h=t.isAnonymous,u=!(t.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new He(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,p)}class $e{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){we(t.idToken,"internal-error"),we(void 0!==t.idToken,"internal-error"),we(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=ze(t);return we(e,"internal-error"),we(void 0!==e.exp,"internal-error"),we(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return we(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(t,e){const n=await Ne(t,{},(async()=>{const n=A({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,r=Le(t,i,"/v1/token",`key=${s}`),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Pe.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:s}=e,r=new $e;return n&&(we("string"==typeof n,"internal-error",{appName:t}),r.refreshToken=n),i&&(we("string"==typeof i,"internal-error",{appName:t}),r.accessToken=i),s&&(we("number"==typeof s,"internal-error",{appName:t}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new $e,this.toJSON())}_performRefresh(){return xe("not implemented")}}function Ke(t,e){we("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Ye{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,s=pe(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ve(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new He(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await We(this,this.stsTokenManager.getToken(this.auth,t));return we(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=V(t),i=await n.getIdToken(e),s=ze(i);we(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:je(Be(s.auth_time)),issuedAtTime:je(Be(s.iat)),expirationTime:je(Be(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=V(t);await qe(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(we(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Ye(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await qe(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await We(this,async function(t,e){return De(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,s,r,o,a,l,c;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,u=null!==(i=e.email)&&void 0!==i?i:void 0,d=null!==(s=e.phoneNumber)&&void 0!==s?s:void 0,p=null!==(r=e.photoURL)&&void 0!==r?r:void 0,f=null!==(o=e.tenantId)&&void 0!==o?o:void 0,g=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=e.createdAt)&&void 0!==l?l:void 0,_=null!==(c=e.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:v,isAnonymous:b,providerData:w,stsTokenManager:x}=e;we(y&&x,t,"internal-error");const k=$e.fromJSON(this.name,x);we("string"==typeof y,t,"internal-error"),Ke(h,t.name),Ke(u,t.name),we("boolean"==typeof v,t,"internal-error"),we("boolean"==typeof b,t,"internal-error"),Ke(d,t.name),Ke(p,t.name),Ke(f,t.name),Ke(g,t.name),Ke(m,t.name),Ke(_,t.name);const I=new Ye({uid:y,auth:t,email:u,emailVerified:v,displayName:h,isAnonymous:b,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:k,createdAt:m,lastLoginAt:_});return w&&Array.isArray(w)&&(I.providerData=w.map((t=>Object.assign({},t)))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(t,e,n=!1){const i=new $e;i.updateFromServerResponse(e);const s=new Ye({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await qe(s),s}}const Ge=new Map;function Xe(t){ke(t instanceof Function,"Expected a class definition");let e=Ge.get(t);return e?(ke(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ge.set(t,e),e)}class Je{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Je.type="NONE";const Qe=Je;function Ze(t,e,n){return`firebase:${t}:${e}:${n}`}class tn{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Ze(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ze("persistence",i.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Ye._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new tn(Xe(Qe),t,n);const i=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let s=i[0]||Xe(Qe);const r=Ze(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(r);if(e){const i=Ye._fromJSON(t,e);n!==s&&(o=i),s=n;break}}catch(t){}const a=i.filter((t=>t._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==s)try{await t._remove(r)}catch(t){}}))),new tn(s,t,n)):new tn(s,t,n)}}function en(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(on(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(nn(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ln(e))return"Blackberry";if(cn(e))return"Webos";if(sn(e))return"Safari";if((e.includes("chrome/")||rn(e))&&!e.includes("edge/"))return"Chrome";if(an(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function nn(t=y()){return/firefox\//i.test(t)}function sn(t=y()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function rn(t=y()){return/crios\//i.test(t)}function on(t=y()){return/iemobile/i.test(t)}function an(t=y()){return/android/i.test(t)}function ln(t=y()){return/blackberry/i.test(t)}function cn(t=y()){return/webos/i.test(t)}function hn(t=y()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function un(t=y()){return hn(t)||an(t)||cn(t)||ln(t)||/windows phone/i.test(t)||on(t)}function dn(t,e=[]){let n;switch(t){case"Browser":n=en(y());break;case"Worker":n=`${en(y())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${te}/${i}`}async function pn(t,e){return De(t,"GET","/v2/recaptchaConfig",Oe(t,e))}function fn(t){return void 0!==t&&void 0!==t.enterprise}class gn{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some((t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState))}}function mn(t){return new Promise(((e,n)=>{const i=document.createElement("script");var s,r;i.setAttribute("src",t),i.onload=e,i.onerror=t=>{const e=ve("internal-error");e.customData=t,n(e)},i.type="text/javascript",i.charset="UTF-8",(null!==(r=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==r?r:document).appendChild(i)}))}function _n(t){return`__${t}${Math.floor(1e6*Math.random())}`}class yn{constructor(t){this.type="recaptcha-enterprise",this.auth=xn(t)}async verify(t="verify",e=!1){function n(e,n,i){const s=window.grecaptcha;fn(s)?s.enterprise.ready((()=>{s.enterprise.execute(e,{action:t}).then((t=>{n(t)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((t,i)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise((async(e,n)=>{pn(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new gn(i);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((t=>{n(t)}))}))})(this.auth).then((s=>{if(!e&&fn(window.grecaptcha))n(s,t,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));mn("https://www.google.com/recaptcha/enterprise.js?render="+s).then((()=>{n(s,t,i)})).catch((t=>{i(t)}))}})).catch((t=>{i(t)}))}))}}async function vn(t,e,n,i=!1){const s=new yn(t);let r;try{r=await s.verify(n)}catch(t){r=await s.verify(n,!0)}const o=Object.assign({},e);return i?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class bn{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,i)=>{try{n(t(e))}catch(t){i(t)}}));n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==t?void 0:t.message})}}}class wn{constructor(t,e,n,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kn(this),this.idTokenSubscription=new kn(this),this.beforeStateQueue=new bn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ge,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Xe(e)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await tn.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(t){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await qe(t)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?V(t):null;return e&&we(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&we(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Xe(t))}))}async initializeRecaptchaConfig(){const t=await pn(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),e=new gn(t);null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled&&new yn(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new I("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Xe(t)||this._popupRedirectResolver;we(e,this,"argument-error"),this.redirectPersistenceManager=await tn.create(this,[Xe(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const s="function"==typeof e?e:e.next.bind(e),r=this._isInitialized?Promise.resolve():this._initializationPromise;return we(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof e?t.addObserver(e,n,i):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=dn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){me.logLevel<=G.WARN&&me.warn(`Auth (${te}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function xn(t){return V(t)}class kn{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t){const e=new j(t,void 0);return e.subscribe.bind(e)}((t=>this.observer=t))}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function In(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Cn(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class Tn{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return xe("not implemented")}_getIdTokenResponse(t){return xe("not implemented")}_linkToIdToken(t,e){return xe("not implemented")}_getReauthenticationResolver(t){return xe("not implemented")}}async function En(t,e){return Ae(t,"POST","/v1/accounts:signInWithPassword",Oe(t,e))}class Sn extends Tn{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new Sn(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Sn(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){var e;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(e=t._getRecaptchaConfig())||void 0===e?void 0:e.emailPasswordEnabled){const e=await vn(t,n,"signInWithPassword");return En(t,e)}return En(t,n).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await vn(t,n,"signInWithPassword");return En(t,e)}return Promise.reject(e)}));case"emailLink":return async function(t,e){return Ae(t,"POST","/v1/accounts:signInWithEmailLink",Oe(t,e))}(t,{email:this._email,oobCode:this._password});default:ye(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return De(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Ae(t,"POST","/v1/accounts:signInWithEmailLink",Oe(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:ye(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function Pn(t,e){return Ae(t,"POST","/v1/accounts:signInWithIdp",Oe(t,e))}class Rn extends Tn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Rn(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):ye("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,s=pe(e,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Rn(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(t){return Pn(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Pn(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Pn(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=A(e)}return t}}const Mn={USER_NOT_FOUND:"user-not-found"};class On extends Tn{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new On({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new On({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Ae(t,"POST","/v1/accounts:signInWithPhoneNumber",Oe(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await Ae(t,"POST","/v1/accounts:signInWithPhoneNumber",Oe(t,e));if(n.temporaryProof)throw Ue(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Ae(t,"POST","/v1/accounts:signInWithPhoneNumber",Oe(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Mn)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}=t;return n||e||i||s?new On({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Dn{constructor(t){var e,n,i,s,r,o;const a=L(F(t)),l=null!==(e=a.apiKey)&&void 0!==e?e:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);we(l&&c&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=c,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=L(F(t)).link,n=e?L(F(e)).deep_link_id:null,i=L(F(t)).deep_link_id;return(i?L(F(i)).link:null)||i||n||e||t}(t);try{return new Dn(e)}catch(t){return null}}}class Nn{constructor(){this.providerId=Nn.PROVIDER_ID}static credential(t,e){return Sn._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Dn.parseLink(e);return we(n,"argument-error"),Sn._fromEmailAndCode(t,n.code,n.tenantId)}}Nn.PROVIDER_ID="password",Nn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Nn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class An{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Ln extends An{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Fn extends Ln{constructor(){super("facebook.com")}static credential(t){return Rn._fromParams({providerId:Fn.PROVIDER_ID,signInMethod:Fn.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Fn.credentialFromTaggedObject(t)}static credentialFromError(t){return Fn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Fn.credential(t.oauthAccessToken)}catch(t){return null}}}Fn.FACEBOOK_SIGN_IN_METHOD="facebook.com",Fn.PROVIDER_ID="facebook.com";class Un extends Ln{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Rn._fromParams({providerId:Un.PROVIDER_ID,signInMethod:Un.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Un.credentialFromTaggedObject(t)}static credentialFromError(t){return Un.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return Un.credential(e,n)}catch(t){return null}}}Un.GOOGLE_SIGN_IN_METHOD="google.com",Un.PROVIDER_ID="google.com";class jn extends Ln{constructor(){super("github.com")}static credential(t){return Rn._fromParams({providerId:jn.PROVIDER_ID,signInMethod:jn.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return jn.credentialFromTaggedObject(t)}static credentialFromError(t){return jn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return jn.credential(t.oauthAccessToken)}catch(t){return null}}}jn.GITHUB_SIGN_IN_METHOD="github.com",jn.PROVIDER_ID="github.com";class Bn extends Ln{constructor(){super("twitter.com")}static credential(t,e){return Rn._fromParams({providerId:Bn.PROVIDER_ID,signInMethod:Bn.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Bn.credentialFromTaggedObject(t)}static credentialFromError(t){return Bn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Bn.credential(e,n)}catch(t){return null}}}Bn.TWITTER_SIGN_IN_METHOD="twitter.com",Bn.PROVIDER_ID="twitter.com";class zn{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const s=await Ye._fromIdTokenResponse(t,n,i),r=Wn(n);return new zn({user:s,providerId:r,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=Wn(n);return new zn({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function Wn(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Vn extends k{constructor(t,e,n,i){var s;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Vn.prototype),this.customData={appName:t.name,tenantId:null!==(s=t.tenantId)&&void 0!==s?s:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new Vn(t,e,n,i)}}function Hn(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Vn._fromErrorAndOperation(t,n,e,i);throw n}))}new WeakMap;const qn="__sak";class $n{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(qn,"1"),this.storage.removeItem(qn),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Kn extends $n{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=y();return sn(t)||hn(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=un(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(t.newValue!==i)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const i=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},s=this.storage.getItem(n);!function(){const t=y();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||10!==document.documentMode||s===t.newValue||t.newValue===t.oldValue?i():setTimeout(i,10)}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Kn.type="LOCAL";const Yn=Kn;class Gn extends $n{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Gn.type="SESSION";const Xn=Gn;class Jn{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Jn(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:s}=e.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async t=>t(e.origin,s))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Qn(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Jn.receivers=[];class Zn{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const l=Qn("",20);i.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(c),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(e.data.response);break;default:clearTimeout(c),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:t,eventId:l,data:e},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function ti(){return window}function ei(){return void 0!==ti().WorkerGlobalScope&&"function"==typeof ti().importScripts}const ni="firebaseLocalStorageDb",ii="firebaseLocalStorage",si="fbase_key";class ri{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function oi(t,e){return t.transaction([ii],e?"readwrite":"readonly").objectStore(ii)}function ai(){const t=indexedDB.open(ni,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(ii,{keyPath:si})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(ii)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(ni);return new ri(t).toPromise()}(),e(await ai()))}))}))}async function li(t,e,n){const i=oi(t,!0).put({[si]:e,value:n});return new ri(i).toPromise()}function ci(t,e){const n=oi(t,!0).delete(e);return new ri(n).toPromise()}class hi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ai()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ei()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jn._getInstance(ei()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new Zn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await ai();return await li(t,qn,"1"),await ci(t,qn),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>li(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=oi(t,!1).get(e),i=await new ri(n).toPromise();return void 0===i?null:i.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>ci(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=oi(t,!1).getAll();return new ri(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:i,value:s}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}hi.type="LOCAL";const ui=hi;_n("rcb"),new Ee(3e4,6e4);class di{constructor(t){this.providerId=di.PROVIDER_ID,this.auth=xn(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var i;const s=await n.verify();try{let r;if(we("string"==typeof s,t,"argument-error"),we("recaptcha"===n.type,t,"argument-error"),r="string"==typeof e?{phoneNumber:e}:e,"session"in r){const e=r.session;if("phoneNumber"in r){we("enroll"===e.type,t,"internal-error");const n=await function(t,e){return De(t,"POST","/v2/accounts/mfaEnrollment:start",Oe(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{we("signin"===e.type,t,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;we(n,t,"missing-multi-factor-info");const o=await function(t,e){return De(t,"POST","/v2/accounts/mfaSignIn:start",Oe(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return De(t,"POST","/v1/accounts:sendVerificationCode",Oe(t,e))}(t,{phoneNumber:r.phoneNumber,recaptchaToken:s});return e}}finally{n._reset()}}(this.auth,t,V(e))}static credential(t,e){return On._fromVerification(t,e)}static credentialFromResult(t){const e=t;return di.credentialFromTaggedObject(e)}static credentialFromError(t){return di.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?On._fromTokenResponse(e,n):null}}di.PROVIDER_ID="phone",di.PHONE_SIGN_IN_METHOD="phone";class pi extends Tn{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Pn(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Pn(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Pn(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function fi(t){return async function(t,e,n=!1){const i="signIn",s=await Hn(t,i,e),r=await zn._fromIdTokenResponse(t,i,s);return n||await t._updateCurrentUser(r.user),r}(t.auth,new pi(t),t.bypassAuthState)}function gi(t){const{auth:e,user:n}=t;return we(n,e,"internal-error"),async function(t,e,n=!1){const{auth:i}=t,s="reauthenticate";try{const r=await We(t,Hn(i,s,e,t),n);we(r.idToken,i,"internal-error");const o=ze(r.idToken);we(o,i,"internal-error");const{sub:a}=o;return we(t.uid===a,i,"user-mismatch"),zn._forOperation(t,s,r)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&ye(i,"user-mismatch"),t}}(n,new pi(t),t.bypassAuthState)}async function mi(t){const{auth:e,user:n}=t;return we(n,e,"internal-error"),async function(t,e,n=!1){const i=await We(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return zn._forOperation(t,"link",i)}(n,new pi(t),t.bypassAuthState)}class _i{constructor(t,e,n,i,s=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=t;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return fi;case"linkViaPopup":case"linkViaRedirect":return mi;case"reauthViaPopup":case"reauthViaRedirect":return gi;default:ye(this.auth,"internal-error")}}resolve(t){ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const yi=new Ee(2e3,1e4);class vi extends _i{constructor(t,e,n,i,s){super(t,e,i,s),this.provider=n,this.authWindow=null,this.pollId=null,vi.currentPopupAction&&vi.currentPopupAction.cancel(),vi.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return we(t,this.auth,"internal-error"),t}async onExecution(){ke(1===this.filter.length,"Popup operations only handle one event");const t=Qn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(ve(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(ve(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,vi.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ve(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(t,yi.get())};t()}}vi.currentPopupAction=null;const bi=new Map;class wi extends _i{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=bi.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return Ze("pendingRedirect",t.config.apiKey,t.name)}(e),i=function(t){return Xe(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}bi.set(this.auth._key(),t)}return this.bypassAuthState||bi.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function xi(t,e){bi.set(t._key(),e)}async function ki(t,e,n=!1){const i=xn(t),s=function(t,e){return e?Xe(e):(we(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),r=new wi(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}class Ii{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ti(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Ti(t)){const i=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(ve(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ci(t))}saveEventToCache(t){this.cachedEventUids.add(Ci(t)),this.lastProcessedEventTime=Date.now()}}function Ci(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Ti({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const Ei=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Si=/^https?/;function Pi(t){const e=Ie(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);return""===s.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!Si.test(n))return!1;if(Ei.test(t))return i===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const Ri=new Ee(3e4,6e4);function Mi(){const t=ti().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Oi=null;function Di(t){return Oi=Oi||function(t){return new Promise(((e,n)=>{var i,s,r;function o(){Mi(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Mi(),n(ve(t,"network-request-failed"))},timeout:Ri.get()})}if(null===(s=null===(i=ti().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)e(gapi.iframes.getContext());else{if(!(null===(r=ti().gapi)||void 0===r?void 0:r.load)){const e=_n("iframefcb");return ti()[e]=()=>{gapi.load?o():n(ve(t,"network-request-failed"))},mn(`https://apis.google.com/js/api.js?onload=${e}`).catch((t=>n(t)))}o()}})).catch((t=>{throw Oi=null,t}))}(t),Oi}const Ni=new Ee(5e3,15e3),Ai={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Li=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Fi(t){const e=t.config;we(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Se(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:te},s=Li.get(t.config.apiHost);s&&(i.eid=s);const r=t._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${A(i).slice(1)}`}const Ui={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ji{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const Bi=encodeURIComponent("fac");async function zi(t,e,n,i,s,r){we(t.config.authDomain,t,"auth-domain-config-required"),we(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:te,eventId:s};if(e instanceof An){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",M(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(r||{}))o[t]=e}if(e instanceof Ln){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];const l=await t._getAppCheckToken(),c=l?`#${Bi}=${encodeURIComponent(l)}`:"";return`${function({config:t}){return t.emulator?Se(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${A(a).slice(1)}${c}`}const Wi="webStorageSupport",Vi=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xn,this._completeRedirectFn=ki,this._overrideRedirectResult=xi}async _openPopup(t,e,n,i){var s;return ke(null===(s=this.eventManagers[t._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(t,e,n,i=500,s=600){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l=Object.assign(Object.assign({},Ui),{width:i.toString(),height:s.toString(),top:r,left:o}),c=y().toLowerCase();n&&(a=rn(c)?"_blank":n),nn(c)&&(e=e||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=y()){var e;return hn(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==a)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",a),new ji(null);const u=window.open(e||"",a,h);we(u,t,"popup-blocked");try{u.focus()}catch(t){}return new ji(u)}(t,await zi(t,e,n,Ie(),i),Qn())}async _openRedirect(t,e,n,i){return await this._originValidation(t),s=await zi(t,e,n,Ie(),i),ti().location.href=s,new Promise((()=>{}));var s}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(ke(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Di(t),n=ti().gapi;return we(n,t,"internal-error"),e.open({where:document.body,url:Fi(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ai,dontclear:!0},(e=>new Promise((async(n,i)=>{await e.restyle({setHideOnLeave:!1});const s=ve(t,"network-request-failed"),r=ti().setTimeout((()=>{i(s)}),Ni.get());function o(){ti().clearTimeout(r),n(e)}e.ping(o).then(o,(()=>{i(s)}))}))))}(t),n=new Ii(t);return e.register("authEvent",(e=>(we(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Wi,{type:Wi},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[Wi];void 0!==s&&e(!!s),ye(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return De(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(Pi(t))return}catch(t){}ye(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return un()||sn()||hn()}};var Hi="@firebase/auth",qi="0.23.2";class $i{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ki=g("authIdTokenMaxAge")||300;let Yi=null;var Gi;Gi="Browser",Xt(new H("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;we(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:Gi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:dn(Gi)},l=new wn(n,i,s,a);return function(t,e){const n=(null==e?void 0:e.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Xe);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,null==e?void 0:e.popupRedirectResolver)}(l,e),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),Xt(new H("auth-internal",(t=>(t=>new $i(t))(xn(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),ie(Hi,qi,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Gi)),ie(Hi,qi,"esm2017");const Xi="@firebase/database",Ji="0.14.4";let Qi="";class Zi{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),E(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:T(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class ts{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return P(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const es=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Zi(e)}}catch(t){}return new ts},ns=es("localStorage"),is=es("sessionStorage"),ss=new tt("@firebase/database"),rs=function(){let t=1;return function(){return t++}}(),os=function(t){const n=function(t){const n=[];let i=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);if(r>=55296&&r<=56319){const n=r-55296;s++,e(s<t.length,"Surrogate pair missing trail surrogate."),r=65536+(n<<10)+(t.charCodeAt(s)-56320)}r<128?n[i++]=r:r<2048?(n[i++]=r>>6|192,n[i++]=63&r|128):r<65536?(n[i++]=r>>12|224,n[i++]=r>>6&63|128,n[i++]=63&r|128):(n[i++]=r>>18|240,n[i++]=r>>12&63|128,n[i++]=r>>6&63|128,n[i++]=63&r|128)}return n}(t),i=new U;i.update(n);const r=i.digest();return s.encodeByteArray(r)},as=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=as.apply(null,i):e+="object"==typeof i?E(i):i,e+=" "}return e};let ls=null,cs=!0;const hs=function(...t){if(!0===cs&&(cs=!1,null===ls&&!0===is.get("logging_enabled")&&(n=!0,e(!i||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(ss.logLevel=G.VERBOSE,ls=ss.log.bind(ss),i&&is.set("logging_enabled",!0)):"function"==typeof n?ls=n:(ls=null,is.remove("logging_enabled")))),ls){const e=as.apply(null,t);ls(e)}var n,i},us=function(t){return function(...e){hs(t,...e)}},ds=function(...t){const e="FIREBASE INTERNAL ERROR: "+as(...t);ss.error(e)},ps=function(...t){const e=`FIREBASE FATAL ERROR: ${as(...t)}`;throw ss.error(e),new Error(e)},fs=function(...t){const e="FIREBASE WARNING: "+as(...t);ss.warn(e)},gs=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},ms="[MIN_NAME]",_s="[MAX_NAME]",ys=function(t,e){if(t===e)return 0;if(t===ms||e===_s)return-1;if(e===ms||t===_s)return 1;{const n=Ts(t),i=Ts(e);return null!==n?null!==i?n-i==0?t.length-e.length:n-i:-1:null!==i?1:t<e?-1:1}},vs=function(t,e){return t===e?0:t<e?-1:1},bs=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+E(e))},ws=function(t){if("object"!=typeof t||null===t)return E(t);const e=[];for(const n in t)e.push(n);e.sort();let n="{";for(let i=0;i<e.length;i++)0!==i&&(n+=","),n+=E(e[i]),n+=":",n+=ws(t[e[i]]);return n+="}",n},xs=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function ks(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Is=function(t){e(!gs(t),"Invalid JSON number");let n,i,s,r,o;0===t?(i=0,s=0,n=1/t==-1/0?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(t)/Math.LN2),1023),i=r+1023,s=Math.round(t*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(t/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let t=parseInt(l.substr(o,8),2).toString(16);1===t.length&&(t="0"+t),c+=t}return c.toLowerCase()},Cs=new RegExp("^-?(0*)\\d{1,10}$"),Ts=function(t){if(Cs.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Es=function(t){try{t()}catch(t){setTimeout((()=>{const e=t.stack||"";throw fs("Exception was thrown by user callback.",e),t}),Math.floor(0))}},Ss=function(t,e){const n=setTimeout(t,e);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class Ps{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then((t=>this.appCheck=t))}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise(((e,n)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){fs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Rs{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(hs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,n)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',fs(t)}}class Ms{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}Ms.OWNER="owner";const Os="5",Ds=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ns="ac",As="websocket",Ls="long_polling";class Fs{constructor(t,e,n,i,s=!1,r="",o=!1,a=!1){this.secure=e,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ns.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&ns.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Us(t,n,i){let s;if(e("string"==typeof n,"typeof type must == string"),e("object"==typeof i,"typeof params must == object"),n===As)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(n!==Ls)throw new Error("Unknown connection type: "+n);s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(i.ns=t.namespace);const r=[];return ks(i,((t,e)=>{r.push(t+"="+e)})),s+r.join("&")}class js{constructor(){this.counters_={}}incrementCounter(t,e=1){P(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return c(this.counters_)}}const Bs={},zs={};function Ws(t){const e=t.toString();return Bs[e]||(Bs[e]=new js),Bs[e]}class Vs{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&Es((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Hs="start";class qs{constructor(t,e,n,i,s,r,o){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=us(t),this.stats_=Ws(e),this.urlFn=t=>(this.appCheckToken&&(t[Ns]=this.appCheckToken),Us(e,Ls,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Vs(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new $s(((...t)=>{const[e,n,i,s,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===Hs)this.id=n,this.password=i;else{if("close"!==e)throw new Error("Unrecognized command received: "+e);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,n]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,n)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[Hs]="t",t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v=Os,this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t[Ns]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Ds.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){qs.forceAllow_=!0}static forceDisallow(){qs.forceDisallow_=!0}static isAvailable(){return!(!qs.forceAllow_&&(qs.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=E(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=o(e),i=xs(n,1840);for(let t=0;t<i.length;t++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[t]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=E(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class $s{constructor(t,e,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=rs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=$s.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(t){hs("frame writing exception"),t.stack&&hs(t.stack),hs(t)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||hs("No IE domain setting required")}catch(e){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const t=this.pendingSegs.shift();n=n+"&seg"+i+"="+t.seg+"&ts"+i+"="+t.ts+"&d"+i+"="+t.d,i++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(t,(()=>{clearTimeout(i),n()}))}addTag(t,e){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{hs("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(t){}}),Math.floor(1))}}let Ks=null;"undefined"!=typeof MozWebSocket?Ks=MozWebSocket:"undefined"!=typeof WebSocket&&(Ks=WebSocket);class Ys{constructor(t,e,n,i,s,r,o){this.connId=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=us(this.connId),this.stats_=Ws(e),this.connURL=Ys.connectionURL_(e,r,o,i,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,i,s){const r={};return r.v=Os,"undefined"!=typeof location&&location.hostname&&Ds.test(location.hostname)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),i&&(r[Ns]=i),s&&(r.p=s),Us(t,As,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ns.set("previous_websocket_failure",!0);try{let t;0,this.mySock=new Ks(this.connURL,[],t)}catch(t){this.log_("Error instantiating WebSocket.");const e=t.message||t.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Ys.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Ks&&!Ys.forceDisallow_}static previouslyFailed(){return ns.isInMemoryStorage||!0===ns.get("previous_websocket_failure")}markConnectionHealthy(){ns.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=T(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(e(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=E(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=xs(e,16384);n.length>1&&this.sendString_(String(n.length));for(let t=0;t<n.length;t++)this.sendString_(n[t])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ys.responsesRequiredToBeHealthy=2,Ys.healthyTimeout=3e4;class Gs{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[qs,Ys]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const e=Ys&&Ys.isAvailable();let n=e&&!Ys.previouslyFailed();if(t.webSocketOnly&&(e||fs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Ys];else{const t=this.transports_=[];for(const e of Gs.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e);Gs.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Gs.globalTransportInitialized_=!1;class Xs{constructor(t,e,n,i,s,r,o,a,l,c){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=us("c:"+this.id+":"),this.transportManager_=new Gs(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,n)}),Math.floor(0));const i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ss((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=bs("t",t),n=bs("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=bs("t",t),n=bs("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=bs("t",t);if("d"in t){const n=t.d;if("h"===e){const t=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?ds("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ds("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Os!==n&&fs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),Ss((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ss((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ns.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Js{put(t,e,n,i){}merge(t,e,n,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}class Qs{constructor(t){this.allowedEvents_=t,this.listeners_={},e(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let t=0;t<n.length;t++)n[t].callback.apply(n[t].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const i=this.getInitialEvent(t);i&&e.apply(n,i)}off(t,e,n){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let t=0;t<i.length;t++)if(i[t].callback===e&&(!n||n===i[t].context))return void i.splice(t,1)}validateEventType_(t){e(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}class Zs extends Qs{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||v()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Zs}getInitialEvent(t){return e("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class tr{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function er(){return new tr("")}function nr(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function ir(t){return t.pieces_.length-t.pieceNum_}function sr(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new tr(t.pieces_,e)}function rr(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function or(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function ar(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new tr(e,0)}function lr(t,e){const n=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);if(e instanceof tr)for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new tr(n,0)}function cr(t){return t.pieceNum_>=t.pieces_.length}function hr(t,e){const n=nr(t),i=nr(e);if(null===n)return e;if(n===i)return hr(sr(t),sr(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function ur(t,e){const n=or(t,0),i=or(e,0);for(let t=0;t<n.length&&t<i.length;t++){const e=ys(n[t],i[t]);if(0!==e)return e}return n.length===i.length?0:n.length<i.length?-1:1}function dr(t,e){if(ir(t)!==ir(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function pr(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(ir(t)>ir(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class fr{constructor(t,e){this.errorPrefix_=e,this.parts_=or(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let t=0;t<this.parts_.length;t++)this.byteLength_+=W(this.parts_[t]);gr(this)}}function gr(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+mr(t))}function mr(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}class _r extends Qs{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}static getInstance(){return new _r}getInitialEvent(t){return e("visible"===t,"Unknown event type: "+t),[this.visible_]}}const yr=1e3;class vr extends Js{constructor(t,e,n,i,s,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=vr.nextPersistentConnectionId_++,this.log_=us("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yr,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");_r.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Zs.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,i){const s=++this.requestNumber_,r={r:s,a:t,b:n};this.log_(E(r)),e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();const e=new m,n={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:t=>{const n=t.d;"ok"===t.s?e.resolve(n):e.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),e.promise}listen(t,n,i,s){this.initConnection_();const r=t._queryIdentifier,o=t._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),e(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:t,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)}))}sendListen_(t){const e=t.query,n=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};t.tag&&(s.q=e._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;vr.warnOnListenWarnings_(r,e),(this.listens.get(n)&&this.listens.get(n).get(i))===t&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"==typeof t&&P(t,"w")){const n=R(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();fs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=S(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=S(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,(e=>{const n=e.s,i=e.d||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t.s,n=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)}))}unlisten(t,n){const i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),e(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,n)}sendUnlisten_(t,e,n,i){this.log_("Unlisten on "+t+" for "+e);const s={p:t};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,i){const s={p:e,d:n};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,(t=>{i&&setTimeout((()=>{i(t.s,t.d)}),Math.floor(0))}))}put(t,e,n,i){this.putInternal("p",t,e,n,i)}merge(t,e,n,i){this.putInternal("m",t,e,n,i)}putInternal(t,e,n,i,s){this.initConnection_();const r={p:e,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,(n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+E(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):ds("Unrecognized action received from server: "+E(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yr,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=yr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=yr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+vr.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(t){e(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(t)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?hs("getToken() completed but was canceled"):(hs("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,a=new Xs(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,(t=>{fs(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(t){this.log_("Failed to get token: "+t),o||(this.repoInfo_.nodeAdmin&&fs(t),l())}}}interrupt(t){hs("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){hs("Resuming connection for reason: "+t),delete this.interruptReasons_[t],M(this.interruptReasons_)&&(this.reconnectDelay_=yr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map((t=>ws(t))).join("$"):"default";const i=this.removeListen_(t,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const n=new tr(t).toString();let i;if(this.listens.has(n)){const t=this.listens.get(n);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(t,e){hs("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){hs("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";t["sdk."+e+"."+Qi.replace(/\./g,"-")]=1,v()?t["framework.cordova"]=1:b()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Zs.getInstance().currentlyOnline();return M(this.interruptReasons_)&&t}}vr.nextPersistentConnectionId_=0,vr.nextConnectionId_=0;class br{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new br(t,e)}}class wr{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new br(ms,t),i=new br(ms,e);return 0!==this.compare(n,i)}minPost(){return br.MIN}}let xr;class kr extends wr{static get __EMPTY_NODE(){return xr}static set __EMPTY_NODE(t){xr=t}compare(t,e){return ys(t.name,e.name)}isDefinedOn(t){throw n("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return br.MIN}maxPost(){return new br(_s,xr)}makePost(t,n){return e("string"==typeof t,"KeyIndex indexValue must always be a string."),new br(t,xr)}toString(){return".key"}}const Ir=new kr;class Cr{constructor(t,e,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class Tr{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Tr.RED,this.left=null!=i?i:Er.EMPTY_NODE,this.right=null!=s?s:Er.EMPTY_NODE}copy(t,e,n,i,s){return new Tr(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Er.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,i;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Er.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,Tr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,Tr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}Tr.RED=!0,Tr.BLACK=!1;class Er{constructor(t,e=Er.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new Er(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Tr.BLACK,null,null))}remove(t){return new Er(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Tr.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,i=null;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Cr(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Cr(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Cr(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Cr(this.root_,null,this.comparator_,!0,t)}}function Sr(t,e){return ys(t.name,e.name)}function Pr(t,e){return ys(t,e)}let Rr;Er.EMPTY_NODE=new class{copy(t,e,n,i,s){return this}insert(t,e,n){return new Tr(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Mr=function(t){return"number"==typeof t?"number:"+Is(t):"string:"+t},Or=function(t){if(t.isLeafNode()){const n=t.val();e("string"==typeof n||"number"==typeof n||"object"==typeof n&&P(n,".sv"),"Priority must be a string or number.")}else e(t===Rr||t.isEmpty(),"priority of unexpected type.");e(t===Rr||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Dr,Nr,Ar;class Lr{constructor(t,n=Lr.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,e(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Or(this.priorityNode_)}static set __childrenNodeConstructor(t){Dr=t}static get __childrenNodeConstructor(){return Dr}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new Lr(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:Lr.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return cr(t)?this:".priority"===nr(t)?this.priorityNode_:Lr.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:Lr.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,n){const i=nr(t);return null===i?n:n.isEmpty()&&".priority"!==i?this:(e(".priority"!==i||1===ir(t),".priority must be the last token in a path"),this.updateImmediateChild(i,Lr.__childrenNodeConstructor.EMPTY_NODE.updateChild(sr(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Mr(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?Is(this.value_):this.value_,this.lazyHash_=os(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===Lr.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof Lr.__childrenNodeConstructor?-1:(e(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const n=typeof t.value_,i=typeof this.value_,s=Lr.VALUE_TYPE_ORDER.indexOf(n),r=Lr.VALUE_TYPE_ORDER.indexOf(i);return e(s>=0,"Unknown leaf type: "+n),e(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}Lr.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Fr=new class extends wr{compare(t,e){const n=t.node.getPriority(),i=e.node.getPriority(),s=n.compareTo(i);return 0===s?ys(t.name,e.name):s}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return br.MIN}maxPost(){return new br(_s,new Lr("[PRIORITY-POST]",Ar))}makePost(t,e){const n=Nr(t);return new br(e,new Lr("[PRIORITY-POST]",n))}toString(){return".priority"}},Ur=Math.log(2);class jr{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ur,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Br=function(t,e,n,i){t.sort(e);const s=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=n?n(o):o,new Tr(a,o.node,Tr.BLACK,null,null);{const l=parseInt(r/2,10)+e,c=s(e,l),h=s(l+1,i);return o=t[l],a=n?n(o):o,new Tr(a,o.node,Tr.BLACK,c,h)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const c=s(r+1,a),h=t[r],u=n?n(h):h;l(new Tr(u,h.node,i,null,c))},l=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));n?a(i,Tr.BLACK):(a(i,Tr.BLACK),a(i,Tr.RED))}return r}(new jr(t.length));return new Er(i||e,r)};let zr;const Wr={};class Vr{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return e(Wr&&Fr,"ChildrenNode.ts has not been loaded"),zr=zr||new Vr({".priority":Wr},{".priority":Fr}),zr}get(t){const e=R(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Er?e:null}hasIndex(t){return P(this.indexSet_,t.toString())}addIndex(t,n){e(t!==Ir,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(br.Wrap);let o,a=r.getNext();for(;a;)s=s||t.isDefinedOn(a.node),i.push(a),a=r.getNext();o=s?Br(i,t.getCompare()):Wr;const l=t.toString(),c=Object.assign({},this.indexSet_);c[l]=t;const h=Object.assign({},this.indexes_);return h[l]=o,new Vr(h,c)}addToIndexes(t,n){const i=O(this.indexes_,((i,s)=>{const r=R(this.indexSet_,s);if(e(r,"Missing index implementation for "+s),i===Wr){if(r.isDefinedOn(t.node)){const e=[],i=n.getIterator(br.Wrap);let s=i.getNext();for(;s;)s.name!==t.name&&e.push(s),s=i.getNext();return e.push(t),Br(e,r.getCompare())}return Wr}{const e=n.get(t.name);let s=i;return e&&(s=s.remove(new br(t.name,e))),s.insert(t,t.node)}}));return new Vr(i,this.indexSet_)}removeFromIndexes(t,e){const n=O(this.indexes_,(n=>{if(n===Wr)return n;{const i=e.get(t.name);return i?n.remove(new br(t.name,i)):n}}));return new Vr(n,this.indexSet_)}}let Hr;class qr{constructor(t,n,i){this.children_=t,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Or(this.priorityNode_),this.children_.isEmpty()&&e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Hr||(Hr=new qr(new Er(Pr),null,Vr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Hr}updatePriority(t){return this.children_.isEmpty()?this:new qr(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Hr:e}}getChild(t){const e=nr(t);return null===e?this:this.getImmediateChild(e).getChild(sr(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,n){if(e(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);{const e=new br(t,n);let i,s;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(e,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(e,this.children_));const r=i.isEmpty()?Hr:this.priorityNode_;return new qr(i,r,s)}}updateChild(t,n){const i=nr(t);if(null===i)return n;{e(".priority"!==nr(t)||1===ir(t),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(sr(t),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,i=0,s=!0;if(this.forEachChild(Fr,((r,o)=>{e[r]=o.val(t),n++,s&&qr.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!t&&s&&i<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Mr(this.getPriority().val())+":"),this.forEachChild(Fr,((e,n)=>{const i=n.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":os(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new br(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new br(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new br(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(t=>t));{const n=this.children_.getIteratorFrom(t.name,br.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(t=>t));{const n=this.children_.getReverseIteratorFrom(t.name,br.Wrap);let i=n.peek();for(;null!=i&&e.compare(i,t)>0;)n.getNext(),i=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===$r?-1:0}withIndex(t){if(t===Ir||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new qr(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===Ir||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(Fr),n=e.getIterator(Fr);let i=t.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=t.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(t){return t===Ir?null:this.indexMap_.get(t.toString())}}qr.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const $r=new class extends qr{constructor(){super(new Er(Pr),qr.EMPTY_NODE,Vr.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return qr.EMPTY_NODE}isEmpty(){return!1}};function Kr(t,n=null){if(null===t)return qr.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(n=t[".priority"]),e(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Lr(t,Kr(n));if(t instanceof Array){let e=qr.EMPTY_NODE;return ks(t,((n,i)=>{if(P(t,n)&&"."!==n.substring(0,1)){const t=Kr(i);!t.isLeafNode()&&t.isEmpty()||(e=e.updateImmediateChild(n,t))}})),e.updatePriority(Kr(n))}{const e=[];let i=!1;if(ks(t,((t,n)=>{if("."!==t.substring(0,1)){const s=Kr(n);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),e.push(new br(t,s)))}})),0===e.length)return qr.EMPTY_NODE;const s=Br(e,Sr,(t=>t.name),Pr);if(i){const t=Br(e,Fr.getCompare());return new qr(s,Kr(n),new Vr({".priority":t},{".priority":Fr}))}return new qr(s,Kr(n),Vr.Default)}}Object.defineProperties(br,{MIN:{value:new br(ms,qr.EMPTY_NODE)},MAX:{value:new br(_s,$r)}}),kr.__EMPTY_NODE=qr.EMPTY_NODE,Lr.__childrenNodeConstructor=qr,Rr=$r,Ar=$r,function(t){Nr=t}(Kr);class Yr extends wr{constructor(t){super(),this.indexPath_=t,e(!cr(t)&&".priority"!==nr(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),i=this.extractChild(e.node),s=n.compareTo(i);return 0===s?ys(t.name,e.name):s}makePost(t,e){const n=Kr(t),i=qr.EMPTY_NODE.updateChild(this.indexPath_,n);return new br(e,i)}maxPost(){const t=qr.EMPTY_NODE.updateChild(this.indexPath_,$r);return new br(_s,t)}toString(){return or(this.indexPath_,0).join("/")}}const Gr=new class extends wr{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?ys(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return br.MIN}maxPost(){return br.MAX}makePost(t,e){const n=Kr(t);return new br(e,n)}toString(){return".value"}};function Xr(t){return{type:"value",snapshotNode:t}}function Jr(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Qr(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Zr(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}class to{constructor(t){this.index_=t}updateChild(t,n,i,s,r,o){e(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=t.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()?t:(null!=o&&(i.isEmpty()?t.hasChild(n)?o.trackChildChange(Qr(n,a)):e(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Jr(n,i)):o.trackChildChange(Zr(n,i,a))),t.isLeafNode()&&i.isEmpty()?t:t.updateImmediateChild(n,i).withIndex(this.index_))}updateFullNode(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Fr,((t,i)=>{e.hasChild(t)||n.trackChildChange(Qr(t,i))})),e.isLeafNode()||e.forEachChild(Fr,((e,i)=>{if(t.hasChild(e)){const s=t.getImmediateChild(e);s.equals(i)||n.trackChildChange(Zr(e,i,s))}else n.trackChildChange(Jr(e,i))}))),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?qr.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class eo{constructor(t){this.indexedFilter_=new to(t.getIndex()),this.index_=t.getIndex(),this.startPost_=eo.getStartPost_(t),this.endPost_=eo.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,i,s,r){return this.matches(new br(e,n))||(n=qr.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,i,s,r)}updateFullNode(t,e,n){e.isLeafNode()&&(e=qr.EMPTY_NODE);let i=e.withIndex(this.index_);i=i.updatePriority(qr.EMPTY_NODE);const s=this;return e.forEachChild(Fr,((t,e)=>{s.matches(new br(t,e))||(i=i.updateImmediateChild(t,qr.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class no{constructor(t){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const e=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?e<=0:e<0},this.withinEndPost=t=>{const e=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?e<=0:e<0},this.rangedFilter_=new eo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,i,s,r){return this.rangedFilter_.matches(new br(e,n))||(n=qr.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,i,s,r):this.fullLimitUpdateChild_(t,e,n,s,r)}updateFullNode(t,e,n){let i;if(e.isLeafNode()||e.isEmpty())i=qr.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let t;i=qr.EMPTY_NODE.withIndex(this.index_),t=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){const e=t.getNext();if(this.withinDirectionalStart(e)){if(!this.withinDirectionalEnd(e))break;i=i.updateImmediateChild(e.name,e.node),n++}}}else{let t;i=e.withIndex(this.index_),i=i.updatePriority(qr.EMPTY_NODE),t=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;t.hasNext();){const e=t.getNext();n<this.limit_&&this.withinDirectionalStart(e)&&this.withinDirectionalEnd(e)?n++:i=i.updateImmediateChild(e.name,qr.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,n,i,s,r){let o;if(this.reverse_){const t=this.index_.getCompare();o=(e,n)=>t(n,e)}else o=this.index_.getCompare();const a=t;e(a.numChildren()===this.limit_,"");const l=new br(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(n)){const t=a.getImmediateChild(n);let e=s.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===n||a.hasChild(e.name));)e=s.getChildAfterChild(this.index_,e,this.reverse_);const u=null==e?1:o(e,l);if(h&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(Zr(n,i,t)),a.updateImmediateChild(n,i);{null!=r&&r.trackChildChange(Qr(n,t));const i=a.updateImmediateChild(n,qr.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=r&&r.trackChildChange(Jr(e.name,e.node)),i.updateImmediateChild(e.name,e.node)):i}}return i.isEmpty()?t:h&&o(c,l)>=0?(null!=r&&(r.trackChildChange(Qr(c.name,c.node)),r.trackChildChange(Jr(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,qr.EMPTY_NODE)):t}}class io{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Fr}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ms}hasEnd(){return this.endSet_}getIndexEndValue(){return e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:_s}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Fr}copy(){const t=new io;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function so(t){const n={};if(t.isDefault())return n;let i;if(t.index_===Fr?i="$priority":t.index_===Gr?i="$value":t.index_===Ir?i="$key":(e(t.index_ instanceof Yr,"Unrecognized index type!"),i=t.index_.toString()),n.orderBy=E(i),t.startSet_){const e=t.startAfterSet_?"startAfter":"startAt";n[e]=E(t.indexStartValue_),t.startNameSet_&&(n[e]+=","+E(t.indexStartName_))}if(t.endSet_){const e=t.endBeforeSet_?"endBefore":"endAt";n[e]=E(t.indexEndValue_),t.endNameSet_&&(n[e]+=","+E(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_),n}function ro(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==Fr&&(e.i=t.index_.toString()),e}class oo extends Js{constructor(t,e,n,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=us("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,n){return void 0!==n?"tag$"+n:(e(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,n,i){const s=t._path.toString();this.log_("Listen called for "+s+" "+t._queryIdentifier);const r=oo.getListenId_(t,n),o={};this.listens_[r]=o;const a=so(t._queryParams);this.restRequest_(s+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(s,a,!1,n),R(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}}))}unlisten(t,e){const n=oo.getListenId_(t,e);delete this.listens_[n]}get(t){const e=so(t._queryParams),n=t._path.toString(),i=new m;return this.restRequest_(n+".json",e,((t,e)=>{let s=e;404===t&&(s=null,t=null),null===t?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(e.auth=i.accessToken),s&&s.token&&(e.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+A(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=T(o.responseText)}catch(t){fs("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&fs("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class ao{constructor(){this.rootNode_=qr.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function lo(){return{value:null,children:new Map}}function co(t,e,n){if(cr(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const i=nr(e);t.children.has(i)||t.children.set(i,lo()),co(t.children.get(i),e=sr(e),n)}}function ho(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(((t,n)=>{e(n,t)}))}(t,((t,i)=>{ho(i,new tr(e.toString()+"/"+t),n)}))}class uo{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&ks(this.last_,((t,n)=>{e[t]=e[t]-n})),this.last_=t,e}}class po{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new uo(t);const n=1e4+2e4*Math.random();Ss(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;ks(t,((t,i)=>{i>0&&P(this.statsToReport_,t)&&(e[t]=i,n=!0)})),n&&this.server_.reportStats(e),Ss(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var fo,go;function mo(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}(go=fo||(fo={}))[go.OVERWRITE=0]="OVERWRITE",go[go.MERGE=1]="MERGE",go[go.ACK_USER_WRITE=2]="ACK_USER_WRITE",go[go.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class _o{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=fo.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(cr(this.path)){if(null!=this.affectedTree.value)return e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new tr(t));return new _o(er(),e,this.revert)}}return e(nr(this.path)===t,"operationForChild called for unrelated child."),new _o(sr(this.path),this.affectedTree,this.revert)}}class yo{constructor(t,e){this.source=t,this.path=e,this.type=fo.LISTEN_COMPLETE}operationForChild(t){return cr(this.path)?new yo(this.source,er()):new yo(this.source,sr(this.path))}}class vo{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=fo.OVERWRITE}operationForChild(t){return cr(this.path)?new vo(this.source,er(),this.snap.getImmediateChild(t)):new vo(this.source,sr(this.path),this.snap)}}class bo{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=fo.MERGE}operationForChild(t){if(cr(this.path)){const e=this.children.subtree(new tr(t));return e.isEmpty()?null:e.value?new vo(this.source,er(),e.value):new bo(this.source,er(),e)}return e(nr(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new bo(this.source,sr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class wo{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(cr(t))return this.isFullyInitialized()&&!this.filtered_;const e=nr(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class xo{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function ko(t,e,i,s,r,o){const a=s.filter((t=>t.type===i));a.sort(((e,i)=>function(t,e,i){if(null==e.childName||null==i.childName)throw n("Should only compare child_ events.");const s=new br(e.childName,e.snapshotNode),r=new br(i.childName,i.snapshotNode);return t.index_.compare(s,r)}(t,e,i))),a.forEach((n=>{const i=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,o);r.forEach((s=>{s.respondsTo(n.type)&&e.push(s.createEvent(i,t.query_))}))}))}function Io(t,e){return{eventCache:t,serverCache:e}}function Co(t,e,n,i){return Io(new wo(e,n,i),t.serverCache)}function To(t,e,n,i){return Io(t.eventCache,new wo(e,n,i))}function Eo(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function So(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let Po;class Ro{constructor(t,e=(()=>(Po||(Po=new Er(vs)),Po))()){this.value=t,this.children=e}static fromObject(t){let e=new Ro(null);return ks(t,((t,n)=>{e=e.set(new tr(t),n)})),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:er(),value:this.value};if(cr(t))return null;{const n=nr(t),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(sr(t),e);return null!=s?{path:lr(new tr(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(cr(t))return this;{const e=nr(t),n=this.children.get(e);return null!==n?n.subtree(sr(t)):new Ro(null)}}set(t,e){if(cr(t))return new Ro(e,this.children);{const n=nr(t),i=(this.children.get(n)||new Ro(null)).set(sr(t),e),s=this.children.insert(n,i);return new Ro(this.value,s)}}remove(t){if(cr(t))return this.children.isEmpty()?new Ro(null):new Ro(null,this.children);{const e=nr(t),n=this.children.get(e);if(n){const i=n.remove(sr(t));let s;return s=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&s.isEmpty()?new Ro(null):new Ro(this.value,s)}return this}}get(t){if(cr(t))return this.value;{const e=nr(t),n=this.children.get(e);return n?n.get(sr(t)):null}}setTree(t,e){if(cr(t))return e;{const n=nr(t),i=(this.children.get(n)||new Ro(null)).setTree(sr(t),e);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new Ro(this.value,s)}}fold(t){return this.fold_(er(),t)}fold_(t,e){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(lr(t,i),e)})),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,er(),e)}findOnPath_(t,e,n){const i=!!this.value&&n(e,this.value);if(i)return i;if(cr(t))return null;{const i=nr(t),s=this.children.get(i);return s?s.findOnPath_(sr(t),lr(e,i),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,er(),e)}foreachOnPath_(t,e,n){if(cr(t))return this;{this.value&&n(e,this.value);const i=nr(t),s=this.children.get(i);return s?s.foreachOnPath_(sr(t),lr(e,i),n):new Ro(null)}}foreach(t){this.foreach_(er(),t)}foreach_(t,e){this.children.inorderTraversal(((n,i)=>{i.foreach_(lr(t,n),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,n)=>{n.value&&t(e,n.value)}))}}class Mo{constructor(t){this.writeTree_=t}static empty(){return new Mo(new Ro(null))}}function Oo(t,e,n){if(cr(e))return new Mo(new Ro(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=hr(s,e);return r=r.updateChild(o,n),new Mo(t.writeTree_.set(s,r))}{const i=new Ro(n),s=t.writeTree_.setTree(e,i);return new Mo(s)}}}function Do(t,e,n){let i=t;return ks(n,((t,n)=>{i=Oo(i,lr(e,t),n)})),i}function No(t,e){if(cr(e))return Mo.empty();{const n=t.writeTree_.setTree(e,new Ro(null));return new Mo(n)}}function Ao(t,e){return null!=Lo(t,e)}function Lo(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(hr(n.path,e)):null}function Fo(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Fr,((t,n)=>{e.push(new br(t,n))})):t.writeTree_.children.inorderTraversal(((t,n)=>{null!=n.value&&e.push(new br(t,n.value))})),e}function Uo(t,e){if(cr(e))return t;{const n=Lo(t,e);return new Mo(null!=n?new Ro(n):t.writeTree_.subtree(e))}}function jo(t){return t.writeTree_.isEmpty()}function Bo(t,e){return zo(er(),t.writeTree_,e)}function zo(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let s=null;return n.children.inorderTraversal(((n,r)=>{".priority"===n?(e(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=zo(lr(t,n),r,i)})),i.getChild(t).isEmpty()||null===s||(i=i.updateChild(lr(t,".priority"),s)),i}}function Wo(t,e){return Zo(e,t)}function Vo(t,e){if(t.snap)return pr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&pr(lr(t.path,n),e))return!0;return!1}function Ho(t){return t.visible}function qo(t,e,i){let s=Mo.empty();for(let r=0;r<t.length;++r){const o=t[r];if(e(o)){const t=o.path;let e;if(o.snap)pr(i,t)?(e=hr(i,t),s=Oo(s,e,o.snap)):pr(t,i)&&(e=hr(t,i),s=Oo(s,er(),o.snap.getChild(e)));else{if(!o.children)throw n("WriteRecord should have .snap or .children");if(pr(i,t))e=hr(i,t),s=Do(s,e,o.children);else if(pr(t,i))if(e=hr(t,i),cr(e))s=Do(s,er(),o.children);else{const t=R(o.children,nr(e));if(t){const n=t.getChild(sr(e));s=Oo(s,er(),n)}}}}}return s}function $o(t,e,n,i,s){if(i||s){const r=Uo(t.visibleWrites,e);if(!s&&jo(r))return n;if(s||null!=n||Ao(r,er())){const r=function(t){return(t.visible||s)&&(!i||!~i.indexOf(t.writeId))&&(pr(t.path,e)||pr(e,t.path))};return Bo(qo(t.allWrites,r,e),n||qr.EMPTY_NODE)}return null}{const i=Lo(t.visibleWrites,e);if(null!=i)return i;{const i=Uo(t.visibleWrites,e);return jo(i)?n:null!=n||Ao(i,er())?Bo(i,n||qr.EMPTY_NODE):null}}}function Ko(t,e,n,i){return $o(t.writeTree,t.treePath,e,n,i)}function Yo(t,e){return function(t,e,n){let i=qr.EMPTY_NODE;const s=Lo(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Fr,((t,e)=>{i=i.updateImmediateChild(t,e)})),i;if(n){const s=Uo(t.visibleWrites,e);return n.forEachChild(Fr,((t,e)=>{const n=Bo(Uo(s,new tr(t)),e);i=i.updateImmediateChild(t,n)})),Fo(s).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}return Fo(Uo(t.visibleWrites,e)).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}(t.writeTree,t.treePath,e)}function Go(t,n,i,s){return function(t,n,i,s,r){e(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=lr(n,i);if(Ao(t.visibleWrites,o))return null;{const e=Uo(t.visibleWrites,o);return jo(e)?r.getChild(i):Bo(e,r.getChild(i))}}(t.writeTree,t.treePath,n,i,s)}function Xo(t,e){return function(t,e){return Lo(t.visibleWrites,e)}(t.writeTree,lr(t.treePath,e))}function Jo(t,e,n){return function(t,e,n,i){const s=lr(e,n),r=Lo(t.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?Bo(Uo(t.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(t.writeTree,t.treePath,e,n)}function Qo(t,e){return Zo(lr(t.treePath,e),t.writeTree)}function Zo(t,e){return{treePath:t,writeTree:e}}class ta{constructor(){this.changeMap=new Map}trackChildChange(t){const i=t.type,s=t.childName;e("child_added"===i||"child_changed"===i||"child_removed"===i,"Only child changes supported for tracking"),e(".priority"!==s,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const e=r.type;if("child_added"===i&&"child_removed"===e)this.changeMap.set(s,Zr(s,t.snapshotNode,r.snapshotNode));else if("child_removed"===i&&"child_added"===e)this.changeMap.delete(s);else if("child_removed"===i&&"child_changed"===e)this.changeMap.set(s,Qr(s,r.oldSnap));else if("child_changed"===i&&"child_added"===e)this.changeMap.set(s,Jr(s,t.snapshotNode));else{if("child_changed"!==i||"child_changed"!==e)throw n("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(s,Zr(s,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(s,t)}getChanges(){return Array.from(this.changeMap.values())}}const ea=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}};class na{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new wo(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Jo(this.writes_,t,e)}}getChildAfterChild(t,e,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:So(this.viewCache_),s=function(t,e,n,i,s,r){return function(t,e,n,i,s,r,o){let a;const l=Uo(t.visibleWrites,e),c=Lo(l,er());if(null!=c)a=c;else{if(null==n)return[];a=Bo(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let l=n.getNext();for(;l&&t.length<s;)0!==e(l,i)&&t.push(l),l=n.getNext();return t}}(t.writeTree,t.treePath,e,n,i,s,r)}(this.writes_,i,e,1,n,t);return 0===s.length?null:s[0]}}function ia(t,n,i,s,r,o){const a=n.eventCache;if(null!=Xo(s,i))return n;{let l,c;if(cr(i))if(e(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const e=So(n),i=Yo(s,e instanceof qr?e:qr.EMPTY_NODE);l=t.filter.updateFullNode(n.eventCache.getNode(),i,o)}else{const e=Ko(s,So(n));l=t.filter.updateFullNode(n.eventCache.getNode(),e,o)}else{const h=nr(i);if(".priority"===h){e(1===ir(i),"Can't have a priority with additional path components");const r=a.getNode();c=n.serverCache.getNode();const o=Go(s,i,r,c);l=null!=o?t.filter.updatePriority(r,o):a.getNode()}else{const e=sr(i);let u;if(a.isCompleteForChild(h)){c=n.serverCache.getNode();const t=Go(s,i,a.getNode(),c);u=null!=t?a.getNode().getImmediateChild(h).updateChild(e,t):a.getNode().getImmediateChild(h)}else u=Jo(s,h,n.serverCache);l=null!=u?t.filter.updateChild(a.getNode(),h,u,e,r,o):a.getNode()}}return Co(n,l,a.isFullyInitialized()||cr(i),t.filter.filtersNodes())}}function sa(t,e,n,i,s,r,o,a){const l=e.serverCache;let c;const h=o?t.filter:t.filter.getIndexedFilter();if(cr(n))c=h.updateFullNode(l.getNode(),i,null);else if(h.filtersNodes()&&!l.isFiltered()){const t=l.getNode().updateChild(n,i);c=h.updateFullNode(l.getNode(),t,null)}else{const t=nr(n);if(!l.isCompleteForPath(n)&&ir(n)>1)return e;const s=sr(n),r=l.getNode().getImmediateChild(t).updateChild(s,i);c=".priority"===t?h.updatePriority(l.getNode(),r):h.updateChild(l.getNode(),t,r,s,ea,null)}const u=To(e,c,l.isFullyInitialized()||cr(n),h.filtersNodes());return ia(t,u,n,s,new na(s,u,r),a)}function ra(t,e,n,i,s,r,o){const a=e.eventCache;let l,c;const h=new na(s,e,r);if(cr(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Co(e,c,!0,t.filter.filtersNodes());else{const s=nr(n);if(".priority"===s)c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Co(e,c,a.isFullyInitialized(),a.isFiltered());else{const r=sr(n),c=a.getNode().getImmediateChild(s);let u;if(cr(r))u=i;else{const t=h.getCompleteChild(s);u=null!=t?".priority"===rr(r)&&t.getChild(ar(r)).isEmpty()?t:t.updateChild(r,i):qr.EMPTY_NODE}l=c.equals(u)?e:Co(e,t.filter.updateChild(a.getNode(),s,u,r,h,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return l}function oa(t,e){return t.eventCache.isCompleteForChild(e)}function aa(t,e,n){return n.foreach(((t,n)=>{e=e.updateChild(t,n)})),e}function la(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l,c=e;l=cr(n)?i:new Ro(null).setTree(n,i);const h=e.serverCache.getNode();return l.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const l=aa(0,e.serverCache.getNode().getImmediateChild(n),i);c=sa(t,c,new tr(n),l,s,r,o,a)}})),l.children.inorderTraversal(((n,i)=>{const l=!e.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!l){const l=aa(0,e.serverCache.getNode().getImmediateChild(n),i);c=sa(t,c,new tr(n),l,s,r,o,a)}})),c}class ca{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new to(n.getIndex()),s=(r=n).loadsAllData()?new to(r.getIndex()):r.hasLimit()?new no(r):new eo(r);var r;this.processor_=function(t){return{filter:t}}(s);const o=e.serverCache,a=e.eventCache,l=i.updateFullNode(qr.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(qr.EMPTY_NODE,a.getNode(),null),h=new wo(l,o.isFullyInitialized(),i.filtersNodes()),u=new wo(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Io(u,h),this.eventGenerator_=new xo(this.query_)}get query(){return this.query_}}function ha(t,e){const n=So(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!cr(e)&&!n.getImmediateChild(nr(e)).isEmpty())?n.getChild(e):null}function ua(t){return 0===t.eventRegistrations_.length}function da(t,n,i){const s=[];if(i){e(null==n,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach((t=>{const e=t.createCancelEvent(i,r);e&&s.push(e)}))}if(n){let e=[];for(let i=0;i<t.eventRegistrations_.length;++i){const s=t.eventRegistrations_[i];if(s.matches(n)){if(n.hasAnyCallback()){e=e.concat(t.eventRegistrations_.slice(i+1));break}}else e.push(s)}t.eventRegistrations_=e}else t.eventRegistrations_=[];return s}function pa(t,i,s,r){i.type===fo.MERGE&&null!==i.source.queryId&&(e(So(t.viewCache_),"We should always have a full cache before handling merges"),e(Eo(t.viewCache_),"Missing event cache, even though we have a server cache"));const o=t.viewCache_,a=function(t,i,s,r,o){const a=new ta;let l,c;if(s.type===fo.OVERWRITE){const n=s;n.source.fromUser?l=ra(t,i,n.path,n.snap,r,o,a):(e(n.source.fromServer,"Unknown source."),c=n.source.tagged||i.serverCache.isFiltered()&&!cr(n.path),l=sa(t,i,n.path,n.snap,r,o,c,a))}else if(s.type===fo.MERGE){const n=s;n.source.fromUser?l=function(t,e,n,i,s,r,o){let a=e;return i.foreach(((i,l)=>{const c=lr(n,i);oa(e,nr(c))&&(a=ra(t,a,c,l,s,r,o))})),i.foreach(((i,l)=>{const c=lr(n,i);oa(e,nr(c))||(a=ra(t,a,c,l,s,r,o))})),a}(t,i,n.path,n.children,r,o,a):(e(n.source.fromServer,"Unknown source."),c=n.source.tagged||i.serverCache.isFiltered(),l=la(t,i,n.path,n.children,r,o,c,a))}else if(s.type===fo.ACK_USER_WRITE){const n=s;l=n.revert?function(t,n,i,s,r,o){let a;if(null!=Xo(s,i))return n;{const l=new na(s,n,r),c=n.eventCache.getNode();let h;if(cr(i)||".priority"===nr(i)){let i;if(n.serverCache.isFullyInitialized())i=Ko(s,So(n));else{const t=n.serverCache.getNode();e(t instanceof qr,"serverChildren would be complete if leaf node"),i=Yo(s,t)}h=t.filter.updateFullNode(c,i,o)}else{const e=nr(i);let r=Jo(s,e,n.serverCache);null==r&&n.serverCache.isCompleteForChild(e)&&(r=c.getImmediateChild(e)),h=null!=r?t.filter.updateChild(c,e,r,sr(i),l,o):n.eventCache.getNode().hasChild(e)?t.filter.updateChild(c,e,qr.EMPTY_NODE,sr(i),l,o):c,h.isEmpty()&&n.serverCache.isFullyInitialized()&&(a=Ko(s,So(n)),a.isLeafNode()&&(h=t.filter.updateFullNode(h,a,o)))}return a=n.serverCache.isFullyInitialized()||null!=Xo(s,er()),Co(n,h,a,t.filter.filtersNodes())}}(t,i,n.path,r,o,a):function(t,e,n,i,s,r,o){if(null!=Xo(s,n))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=i.value){if(cr(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return sa(t,e,n,l.getNode().getChild(n),s,r,a,o);if(cr(n)){let i=new Ro(null);return l.getNode().forEachChild(Ir,((t,e)=>{i=i.set(new tr(t),e)})),la(t,e,n,i,s,r,a,o)}return e}{let c=new Ro(null);return i.foreach(((t,e)=>{const i=lr(n,t);l.isCompleteForPath(i)&&(c=c.set(t,l.getNode().getChild(i)))})),la(t,e,n,c,s,r,a,o)}}(t,i,n.path,n.affectedTree,r,o,a)}else{if(s.type!==fo.LISTEN_COMPLETE)throw n("Unknown operation type: "+s.type);l=function(t,e,n,i,s){const r=e.serverCache;return ia(t,To(e,r.getNode(),r.isFullyInitialized()||cr(n),r.isFiltered()),n,i,ea,s)}(t,i,s.path,r,a)}const h=a.getChanges();return function(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Eo(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Xr(Eo(e)))}}(i,l,h),{viewCache:l,changes:h}}(t.processor_,o,i,s,r);var l,c;return l=t.processor_,c=a.viewCache,e(c.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),e(c.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed"),e(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=a.viewCache,fa(t,a.changes,a.viewCache.eventCache.getNode(),null)}function fa(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return function(t,e,n,i){const s=[],r=[];return e.forEach((e=>{var n;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push((n=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:n}))})),ko(t,s,"child_removed",e,i,n),ko(t,s,"child_added",e,i,n),ko(t,s,"child_moved",r,i,n),ko(t,s,"child_changed",e,i,n),ko(t,s,"value",e,i,n),s}(t.eventGenerator_,e,n,s)}let ga,ma;class _a{constructor(){this.views=new Map}}function ya(t,n,i,s){const r=n.source.queryId;if(null!==r){const o=t.views.get(r);return e(null!=o,"SyncTree gave us an op for an invalid query."),pa(o,n,i,s)}{let e=[];for(const r of t.views.values())e=e.concat(pa(r,n,i,s));return e}}function va(t,e,n,i,s){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let t=Ko(n,s?i:null),r=!1;t?r=!0:i instanceof qr?(t=Yo(n,i),r=!1):(t=qr.EMPTY_NODE,r=!1);const o=Io(new wo(t,r,!1),new wo(i,s,!1));return new ca(e,o)}return o}function ba(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function wa(t,e){let n=null;for(const i of t.views.values())n=n||ha(i,e);return n}function xa(t,e){if(e._queryParams.loadsAllData())return Ca(t);{const n=e._queryIdentifier;return t.views.get(n)}}function ka(t,e){return null!=xa(t,e)}function Ia(t){return null!=Ca(t)}function Ca(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Ta=1;class Ea{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Ro(null),this.pendingWriteTree_={visibleWrites:Mo.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Sa(t,n,i,s,r){return function(t,n,i,s,r){e(s>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),t.allWrites.push({path:n,snap:i,writeId:s,visible:r}),r&&(t.visibleWrites=Oo(t.visibleWrites,n,i)),t.lastWriteId=s}(t.pendingWriteTree_,n,i,s,r),r?Aa(t,new vo({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,i)):[]}function Pa(t,n,i=!1){const s=function(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}(t.pendingWriteTree_,n);if(function(t,n){const i=t.allWrites.findIndex((t=>t.writeId===n));e(i>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[i];t.allWrites.splice(i,1);let r=s.visible,o=!1,a=t.allWrites.length-1;for(;r&&a>=0;){const e=t.allWrites[a];e.visible&&(a>=i&&Vo(e,s.path)?r=!1:pr(s.path,e.path)&&(o=!0)),a--}return!!r&&(o?(function(t){t.visibleWrites=qo(t.allWrites,Ho,er()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0):(s.snap?t.visibleWrites=No(t.visibleWrites,s.path):ks(s.children,(e=>{t.visibleWrites=No(t.visibleWrites,lr(s.path,e))})),!0))}(t.pendingWriteTree_,n)){let e=new Ro(null);return null!=s.snap?e=e.set(er(),!0):ks(s.children,(t=>{e=e.set(new tr(t),!0)})),Aa(t,new _o(s.path,e,i))}return[]}function Ra(t,e,n){return Aa(t,new vo({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function Ma(t,n,i,s,r=!1){const o=n._path,a=t.syncPointTree_.get(o);let l=[];if(a&&("default"===n._queryIdentifier||ka(a,n))){const c=function(t,n,i,s){const r=n._queryIdentifier,o=[];let a=[];const l=Ia(t);if("default"===r)for(const[e,n]of t.views.entries())a=a.concat(da(n,i,s)),ua(n)&&(t.views.delete(e),n.query._queryParams.loadsAllData()||o.push(n.query));else{const e=t.views.get(r);e&&(a=a.concat(da(e,i,s)),ua(e)&&(t.views.delete(r),e.query._queryParams.loadsAllData()||o.push(e.query)))}return l&&!Ia(t)&&o.push(new(e(ga,"Reference.ts has not been loaded"),ga)(n._repo,n._path)),{removed:o,events:a}}(a,n,i,s);0===a.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(o));const h=c.removed;if(l=c.events,!r){const e=-1!==h.findIndex((t=>t._queryParams.loadsAllData())),i=t.syncPointTree_.findOnPath(o,((t,e)=>Ia(e)));if(e&&!i){const e=t.syncPointTree_.subtree(o);if(!e.isEmpty()){const n=function(t){return t.fold(((t,e,n)=>{if(e&&Ia(e))return[Ca(e)];{let t=[];return e&&(t=ba(e)),ks(n,((e,n)=>{t=t.concat(n)})),t}}))}(e);for(let e=0;e<n.length;++e){const i=n[e],s=i.query,r=Ua(t,i);t.listenProvider_.startListening(Ha(s),ja(t,s),r.hashFn,r.onComplete)}}}if(!i&&h.length>0&&!s)if(e){const e=null;t.listenProvider_.stopListening(Ha(n),e)}else h.forEach((e=>{const n=t.queryToTagMap.get(Ba(e));t.listenProvider_.stopListening(Ha(e),n)}))}!function(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const e=Ba(i),n=t.queryToTagMap.get(e);t.queryToTagMap.delete(e),t.tagToQueryMap.delete(n)}}}(t,h)}return l}function Oa(t,e,n,i){const s=za(t,i);if(null!=s){const i=Wa(s),r=i.path,o=i.queryId,a=hr(r,e);return Va(t,r,new vo(mo(o),a,n))}return[]}function Da(t,n,i,s=!1){const r=n._path;let o=null,a=!1;t.syncPointTree_.foreachOnPath(r,((t,e)=>{const n=hr(t,r);o=o||wa(e,n),a=a||Ia(e)}));let l,c=t.syncPointTree_.get(r);c?(a=a||Ia(c),o=o||wa(c,er())):(c=new _a,t.syncPointTree_=t.syncPointTree_.set(r,c)),null!=o?l=!0:(l=!1,o=qr.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild(((t,e)=>{const n=wa(e,er());n&&(o=o.updateImmediateChild(t,n))})));const h=ka(c,n);if(!h&&!n._queryParams.loadsAllData()){const i=Ba(n);e(!t.queryToTagMap.has(i),"View does not exist, but we have a tag");const s=Ta++;t.queryToTagMap.set(i,s),t.tagToQueryMap.set(s,i)}let u=function(t,e,n,i,s,r){const o=va(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),function(t,e){t.eventRegistrations_.push(e)}(o,n),function(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Fr,((t,e)=>{i.push(Jr(t,e))})),n.isFullyInitialized()&&i.push(Xr(n.getNode())),fa(t,i,n.getNode(),e)}(o,n)}(c,n,i,Wo(t.pendingWriteTree_,r),o,l);if(!h&&!a&&!s){const i=xa(c,n);u=u.concat(function(t,n,i){const s=n._path,r=ja(t,n),o=Ua(t,i),a=t.listenProvider_.startListening(Ha(n),r,o.hashFn,o.onComplete),l=t.syncPointTree_.subtree(s);if(r)e(!Ia(l.value),"If we're adding a query, it shouldn't be shadowed");else{const e=l.fold(((t,e,n)=>{if(!cr(t)&&e&&Ia(e))return[Ca(e).query];{let t=[];return e&&(t=t.concat(ba(e).map((t=>t.query)))),ks(n,((e,n)=>{t=t.concat(n)})),t}}));for(let n=0;n<e.length;++n){const i=e[n];t.listenProvider_.stopListening(Ha(i),ja(t,i))}}return a}(t,n,i))}return u}function Na(t,e,n){const i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,((t,n)=>{const i=wa(n,hr(t,e));if(i)return i}));return $o(i,e,s,n,!0)}function Aa(t,e){return La(e,t.syncPointTree_,null,Wo(t.pendingWriteTree_,er()))}function La(t,e,n,i){if(cr(t.path))return Fa(t,e,n,i);{const s=e.get(er());null==n&&null!=s&&(n=wa(s,er()));let r=[];const o=nr(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const t=n?n.getImmediateChild(o):null,e=Qo(i,o);r=r.concat(La(a,l,t,e))}return s&&(r=r.concat(ya(s,t,i,n))),r}}function Fa(t,e,n,i){const s=e.get(er());null==n&&null!=s&&(n=wa(s,er()));let r=[];return e.children.inorderTraversal(((e,s)=>{const o=n?n.getImmediateChild(e):null,a=Qo(i,e),l=t.operationForChild(e);l&&(r=r.concat(Fa(l,s,o,a)))})),s&&(r=r.concat(ya(s,t,i,n))),r}function Ua(t,e){const n=e.query,i=ja(t,n);return{hashFn:()=>{const t=function(t){return t.viewCache_.serverCache.getNode()}(e)||qr.EMPTY_NODE;return t.hash()},onComplete:e=>{if("ok"===e)return i?function(t,e,n){const i=za(t,n);if(i){const n=Wa(i),s=n.path,r=n.queryId,o=hr(s,e);return Va(t,s,new yo(mo(r),o))}return[]}(t,n._path,i):function(t,e){return Aa(t,new yo({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(t,n._path);{const i=function(t,e){let n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}(e,n);return Ma(t,n,null,i)}}}}function ja(t,e){const n=Ba(e);return t.queryToTagMap.get(n)}function Ba(t){return t._path.toString()+"$"+t._queryIdentifier}function za(t,e){return t.tagToQueryMap.get(e)}function Wa(t){const n=t.indexOf("$");return e(-1!==n&&n<t.length-1,"Bad queryKey."),{queryId:t.substr(n+1),path:new tr(t.substr(0,n))}}function Va(t,n,i){const s=t.syncPointTree_.get(n);return e(s,"Missing sync point for query tag that we're tracking"),ya(s,i,Wo(t.pendingWriteTree_,n),null)}function Ha(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(e(ma,"Reference.ts has not been loaded"),ma)(t._repo,t._path):t}class qa{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new qa(e)}node(){return this.node_}}class $a{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=lr(this.path_,t);return new $a(this.syncTree_,e)}node(){return Na(this.syncTree_,this.path_)}}const Ka=function(t,n,i){return t&&"object"==typeof t?(e(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?Ya(t[".sv"],n,i):"object"==typeof t[".sv"]?Ga(t[".sv"],n):void e(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Ya=function(t,n,i){if("timestamp"===t)return i.timestamp;e(!1,"Unexpected server value: "+t)},Ga=function(t,n,i){t.hasOwnProperty("increment")||e(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;"number"!=typeof s&&e(!1,"Unexpected increment value: "+s);const r=n.node();if(e(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},Xa=function(t,e,n,i){return Qa(e,new $a(n,t),i)},Ja=function(t,e,n){return Qa(t,new qa(e),n)};function Qa(t,e,n){const i=t.getPriority().val(),s=Ka(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const i=t,r=Ka(i.getValue(),e,n);return r!==i.getValue()||s!==i.getPriority().val()?new Lr(r,Kr(s)):t}{const i=t;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new Lr(s))),i.forEachChild(Fr,((t,i)=>{const s=Qa(i,e.getImmediateChild(t),n);s!==i&&(r=r.updateImmediateChild(t,s))})),r}}class Za{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function tl(t,e){let n=e instanceof tr?e:new tr(e),i=t,s=nr(n);for(;null!==s;){const t=R(i.node.children,s)||{children:{},childCount:0};i=new Za(s,i,t),n=sr(n),s=nr(n)}return i}function el(t){return t.node.value}function nl(t,e){t.node.value=e,al(t)}function il(t){return t.node.childCount>0}function sl(t,e){ks(t.node.children,((n,i)=>{e(new Za(n,t,i))}))}function rl(t,e,n,i){n&&!i&&e(t),sl(t,(t=>{rl(t,e,!0,i)})),n&&i&&e(t)}function ol(t){return new tr(null===t.parent?t.name:ol(t.parent)+"/"+t.name)}function al(t){null!==t.parent&&function(t,e,n){const i=function(t){return void 0===el(t)&&!il(t)}(n),s=P(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,al(t)):i||s||(t.node.children[e]=n.node,t.node.childCount++,al(t))}(t.parent,t.name,t)}const ll=/[\[\].#$\/\u0000-\u001F\u007F]/,cl=/[\[\].#$\u0000-\u001F\u007F]/,hl=10485760,ul=function(t){return"string"==typeof t&&0!==t.length&&!ll.test(t)},dl=function(t){return"string"==typeof t&&0!==t.length&&!cl.test(t)},pl=function(t,e,n){const i=n instanceof tr?new fr(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+mr(i));if("function"==typeof e)throw new Error(t+"contains a function "+mr(i)+" with contents = "+e.toString());if(gs(e))throw new Error(t+"contains "+e.toString()+" "+mr(i));if("string"==typeof e&&e.length>hl/3&&W(e)>hl)throw new Error(t+"contains a string greater than "+hl+" utf8 bytes "+mr(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let n=!1,s=!1;if(ks(e,((e,r)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!ul(e)))throw new Error(t+" contains an invalid key ("+e+") "+mr(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=W(e),gr(t)}(i,e),pl(t,r,i),function(t){const e=t.parts_.pop();t.byteLength_-=W(e),t.parts_.length>0&&(t.byteLength_-=1)}(i)})),n&&s)throw new Error(t+' contains ".value" child '+mr(i)+" in addition to actual children.")}},fl=function(t,e,n,i){if(i&&void 0===e)return;const s=z(t,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];ks(e,((t,e)=>{const i=new tr(t);if(pl(s,e,lr(n,i)),".priority"===rr(i)&&!(null===(o=e)||"string"==typeof o||"number"==typeof o&&!gs(o)||o&&"object"==typeof o&&P(o,".sv")))throw new Error(s+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");var o;r.push(i)})),function(t,e){let n,i;for(n=0;n<e.length;n++){i=e[n];const s=or(i);for(let e=0;e<s.length;e++)if(".priority"===s[e]&&e===s.length-1);else if(!ul(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(ur);let s=null;for(n=0;n<e.length;n++){if(i=e[n],null!==s&&pr(s,i))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},gl=function(t,e,n,i){if(!(i&&void 0===n||dl(n)))throw new Error(z(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class ml{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _l(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null===n||dr(r,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function yl(t,e,n){_l(t,n),bl(t,(t=>dr(t,e)))}function vl(t,e,n){_l(t,n),bl(t,(t=>pr(t,e)||pr(e,t)))}function bl(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];s&&(e(s.path)?(wl(t.eventLists_[i]),t.eventLists_[i]=null):n=!1)}n&&(t.eventLists_=[]),t.recursionDepth_--}function wl(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const i=n.getEventRunner();ls&&hs("event: "+n.toString()),Es(i)}}}class xl{constructor(t,e,n,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ml,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=lo(),this.transactionQueueTree_=new Za,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function kl(t,e,n){if(t.stats_=Ws(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new oo(t.repoInfo_,((e,n,i,s)=>{Tl(t,e,n,i,s)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>El(t,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{E(n)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}t.persistentConnection_=new vr(t.repoInfo_,e,((e,n,i,s)=>{Tl(t,e,n,i,s)}),(e=>{El(t,e)}),(e=>{!function(t,e){ks(e,((e,n)=>{Sl(t,e,n)}))}(t,e)}),t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=function(e){const n=e.toString();return zs[n]||(zs[n]=new po(t.stats_,t.server_)),zs[n]}(t.repoInfo_),t.infoData_=new ao,t.infoSyncTree_=new Ea({startListening:(e,n,i,s)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=Ra(t.infoSyncTree_,e._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),Sl(t,"connected",!1),t.serverSyncTree_=new Ea({startListening:(e,n,i,s)=>(t.server_.listen(e,i,n,((n,i)=>{const r=s(n,i);vl(t.eventQueue_,e._path,r)})),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function Il(t){const e=t.infoData_.getNode(new tr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Cl(t){return(e=(e={timestamp:Il(t)})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e}function Tl(t,e,n,i,s){t.dataUpdateCount++;const r=new tr(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const e=O(n,(t=>Kr(t)));o=function(t,e,n,i){const s=za(t,i);if(s){const i=Wa(s),r=i.path,o=i.queryId,a=hr(r,e),l=Ro.fromObject(n);return Va(t,r,new bo(mo(o),a,l))}return[]}(t.serverSyncTree_,r,e,s)}else{const e=Kr(n);o=Oa(t.serverSyncTree_,r,e,s)}else if(i){const e=O(n,(t=>Kr(t)));o=function(t,e,n){const i=Ro.fromObject(n);return Aa(t,new bo({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(t.serverSyncTree_,r,e)}else{const e=Kr(n);o=Ra(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=Al(t,r)),vl(t.eventQueue_,a,o)}function El(t,e){Sl(t,"connected",e),!1===e&&function(t){Ml(t,"onDisconnectEvents");const e=Cl(t),n=lo();ho(t.onDisconnect_,er(),((i,s)=>{const r=Xa(i,s,t.serverSyncTree_,e);co(n,i,r)}));let i=[];ho(n,er(),((e,n)=>{i=i.concat(Ra(t.serverSyncTree_,e,n));const s=Bl(t,e);Al(t,s)})),t.onDisconnect_=lo(),vl(t.eventQueue_,er(),i)}(t)}function Sl(t,e,n){const i=new tr("/.info/"+e),s=Kr(n);t.infoData_.updateSnapshot(i,s);const r=Ra(t.infoSyncTree_,i,s);vl(t.eventQueue_,i,r)}function Pl(t){return t.nextWriteId_++}function Rl(t,e,n){let i;i=".info"===nr(e._path)?Ma(t.infoSyncTree_,e,n):Ma(t.serverSyncTree_,e,n),yl(t.eventQueue_,e._path,i)}function Ml(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),hs(n,...e)}function Ol(t,e,n,i){e&&Es((()=>{if("ok"===n)e(null);else{const t=(n||"error").toUpperCase();let s=t;i&&(s+=": "+i);const r=new Error(s);r.code=t,e(r)}}))}function Dl(t,e,n){return Na(t.serverSyncTree_,e,n)||qr.EMPTY_NODE}function Nl(t,n=t.transactionQueueTree_){if(n||jl(t,n),el(n)){const i=Fl(t,n);e(i.length>0,"Sending zero length transaction queue"),i.every((t=>0===t.status))&&function(t,n,i){const s=i.map((t=>t.currentWriteId)),r=Dl(t,n,s);let o=r;const a=r.hash();for(let t=0;t<i.length;t++){const s=i[t];e(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=hr(n,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const l=o.val(!0),c=n;t.server_.put(c.toString(),l,(e=>{Ml(t,"transaction put response",{path:c.toString(),status:e});let s=[];if("ok"===e){const e=[];for(let n=0;n<i.length;n++)i[n].status=2,s=s.concat(Pa(t.serverSyncTree_,i[n].currentWriteId)),i[n].onComplete&&e.push((()=>i[n].onComplete(null,!0,i[n].currentOutputSnapshotResolved))),i[n].unwatcher();jl(t,tl(t.transactionQueueTree_,n)),Nl(t,t.transactionQueueTree_),vl(t.eventQueue_,n,s);for(let t=0;t<e.length;t++)Es(e[t])}else{if("datastale"===e)for(let t=0;t<i.length;t++)3===i[t].status?i[t].status=4:i[t].status=0;else{fs("transaction at "+c.toString()+" failed: "+e);for(let t=0;t<i.length;t++)i[t].status=4,i[t].abortReason=e}Al(t,n)}}),a)}(t,ol(n),i)}else il(n)&&sl(n,(e=>{Nl(t,e)}))}function Al(t,n){const i=Ll(t,n),s=ol(i);return function(t,n,i){if(0===n.length)return;const s=[];let r=[];const o=n.filter((t=>0===t.status)).map((t=>t.currentWriteId));for(let l=0;l<n.length;l++){const c=n[l],h=hr(i,c.path);let u,d=!1;if(e(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)d=!0,u=c.abortReason,r=r.concat(Pa(t.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)d=!0,u="maxretry",r=r.concat(Pa(t.serverSyncTree_,c.currentWriteId,!0));else{const e=Dl(t,c.path,o);c.currentInputSnapshot=e;const i=n[l].update(e.val());if(void 0!==i){pl("transaction failed: Data returned ",i,c.path);let n=Kr(i);"object"==typeof i&&null!=i&&P(i,".priority")||(n=n.updatePriority(e.getPriority()));const s=c.currentWriteId,a=Cl(t),l=Ja(n,e,a);c.currentOutputSnapshotRaw=n,c.currentOutputSnapshotResolved=l,c.currentWriteId=Pl(t),o.splice(o.indexOf(s),1),r=r.concat(Sa(t.serverSyncTree_,c.path,l,c.currentWriteId,c.applyLocally)),r=r.concat(Pa(t.serverSyncTree_,s,!0))}else d=!0,u="nodata",r=r.concat(Pa(t.serverSyncTree_,c.currentWriteId,!0))}vl(t.eventQueue_,i,r),r=[],d&&(n[l].status=2,a=n[l].unwatcher,setTimeout(a,Math.floor(0)),n[l].onComplete&&("nodata"===u?s.push((()=>n[l].onComplete(null,!1,n[l].currentInputSnapshot))):s.push((()=>n[l].onComplete(new Error(u),!1,null)))))}var a;jl(t,t.transactionQueueTree_);for(let t=0;t<s.length;t++)Es(s[t]);Nl(t,t.transactionQueueTree_)}(t,Fl(t,i),s),s}function Ll(t,e){let n,i=t.transactionQueueTree_;for(n=nr(e);null!==n&&void 0===el(i);)i=tl(i,n),n=nr(e=sr(e));return i}function Fl(t,e){const n=[];return Ul(t,e,n),n.sort(((t,e)=>t.order-e.order)),n}function Ul(t,e,n){const i=el(e);if(i)for(let t=0;t<i.length;t++)n.push(i[t]);sl(e,(e=>{Ul(t,e,n)}))}function jl(t,e){const n=el(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,nl(e,n.length>0?n:void 0)}sl(e,(e=>{jl(t,e)}))}function Bl(t,e){const n=ol(Ll(t,e)),i=tl(t.transactionQueueTree_,e);return function(t,e){let n=t.parent;for(;null!==n;){if(e(n))return!0;n=n.parent}}(i,(e=>{zl(t,e)})),zl(t,i),rl(i,(e=>{zl(t,e)})),n}function zl(t,n){const i=el(n);if(i){const s=[];let r=[],o=-1;for(let n=0;n<i.length;n++)3===i[n].status||(1===i[n].status?(e(o===n-1,"All SENT items should be at beginning of queue."),o=n,i[n].status=3,i[n].abortReason="set"):(e(0===i[n].status,"Unexpected transaction status in abort"),i[n].unwatcher(),r=r.concat(Pa(t.serverSyncTree_,i[n].currentWriteId,!0)),i[n].onComplete&&s.push(i[n].onComplete.bind(null,new Error("set"),!1,null))));-1===o?nl(n,void 0):i.length=o+1,vl(t.eventQueue_,ol(n),r);for(let t=0;t<s.length;t++)Es(s[t])}}const Wl=function(t,e){const n=Vl(t),i=n.namespace;"firebase.com"===n.domain&&ps(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||ps("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&fs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Fs(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new tr(n.pathString)}},Vl=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",l=443;if("string"==typeof t){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let h=t.indexOf("/");-1===h&&(h=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(h,u)),h<u&&(s=function(t){let e="";const n=t.split("/");for(let t=0;t<n.length;t++)if(n[t].length>0){let i=n[t];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,u)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):fs(`Invalid query segment '${n}' in query '${t}'`)}return e}(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(e.substring(c+1),10)):c=e.length;const p=e.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),n=e.substring(t+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class Hl{constructor(t,e,n,i){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=i}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+E(this.snapshot.exportVal())}}class ql{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class $l{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return e(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class Kl{constructor(t,e,n,i){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=i}get key(){return cr(this._path)?null:rr(this._path)}get ref(){return new Yl(this._repo,this._path)}get _queryIdentifier(){const t=ro(this._queryParams),e=ws(t);return"{}"===e?"default":e}get _queryObject(){return ro(this._queryParams)}isEqual(t){if(!((t=V(t))instanceof Kl))return!1;const e=this._repo===t._repo,n=dr(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)}}class Yl extends Kl{constructor(t,e){super(t,e,new io,!1)}get parent(){const t=ar(this._path);return null===t?null:new Yl(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Gl{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new tr(t),n=Jl(this.ref,t);return new Gl(this._node.getChild(e),n,Fr)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((e,n)=>t(new Gl(n,Jl(this.ref,e),Fr))))}hasChild(t){const e=new tr(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Xl(t,e){return(t=V(t))._checkNotDeleted("ref"),void 0!==e?Jl(t._root,e):t._root}function Jl(t,e){var n;return null===nr((t=V(t))._path)?((n=e)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),gl("child","path",n,false)):gl("child","path",e,!1),new Yl(t._repo,lr(t._path,e))}function Ql(t,e){(function(t,e){if(".info"===nr(e))throw new Error(t+" failed = Can't modify data under /.info/")})("set",(t=V(t))._path),function(t,e,n,i){i&&void 0===e||pl(z(t,"value"),e,n)}("set",e,t._path,!1);const n=new m;return function(t,e,n,i,s){Ml(t,"set",{path:e.toString(),value:n,priority:i});const r=Cl(t),o=Kr(n,i),a=Na(t.serverSyncTree_,e),l=Ja(o,a,r),c=Pl(t),h=Sa(t.serverSyncTree_,e,l,c,!0);_l(t.eventQueue_,h),t.server_.put(e.toString(),o.val(!0),((n,i)=>{const r="ok"===n;r||fs("set at "+e+" failed: "+n);const o=Pa(t.serverSyncTree_,c,!r);vl(t.eventQueue_,e,o),Ol(0,s,n,i)}));const u=Bl(t,e);Al(t,u),vl(t.eventQueue_,u,[])}(t._repo,t._path,e,null,n.wrapCallback((()=>{}))),n.promise}function Zl(t,n){fl("update",n,t._path,!1);const i=new m;return function(t,n,i,s){Ml(t,"update",{path:n.toString(),value:i});let r=!0;const o=Cl(t),a={};if(ks(i,((e,i)=>{r=!1,a[e]=Xa(lr(n,e),Kr(i),t.serverSyncTree_,o)})),r)hs("update() called with empty data.  Don't do anything."),Ol(0,s,"ok",void 0);else{const r=Pl(t),o=function(t,n,i,s){!function(t,n,i,s){e(s>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:n,children:i,writeId:s,visible:!0}),t.visibleWrites=Do(t.visibleWrites,n,i),t.lastWriteId=s}(t.pendingWriteTree_,n,i,s);const r=Ro.fromObject(i);return Aa(t,new bo({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,r))}(t.serverSyncTree_,n,a,r);_l(t.eventQueue_,o),t.server_.merge(n.toString(),i,((e,i)=>{const o="ok"===e;o||fs("update at "+n+" failed: "+e);const a=Pa(t.serverSyncTree_,r,!o),l=a.length>0?Al(t,n):n;vl(t.eventQueue_,l,a),Ol(0,s,e,i)})),ks(i,(e=>{const i=Bl(t,lr(n,e));Al(t,i)})),vl(t.eventQueue_,n,[])}}(t._repo,t._path,n,i.wrapCallback((()=>{}))),i.promise}function tc(t){t=V(t);const e=new $l((()=>{})),n=new ec(e);return function(t,e,n){const i=function(t,e){const n=e._path;let i=null;t.syncPointTree_.foreachOnPath(n,((t,e)=>{const s=hr(t,n);i=i||wa(e,s)}));let s=t.syncPointTree_.get(n);s?i=i||wa(s,er()):(s=new _a,t.syncPointTree_=t.syncPointTree_.set(n,s));const r=null!=i,o=r?new wo(i,!0,!1):null;return Eo(va(s,e,Wo(t.pendingWriteTree_,e._path),r?o.getNode():qr.EMPTY_NODE,r).viewCache_)}(t.serverSyncTree_,e);return null!=i?Promise.resolve(i):t.server_.get(e).then((i=>{const s=Kr(i).withIndex(e._queryParams.getIndex());let r;if(Da(t.serverSyncTree_,e,n,!0),e._queryParams.loadsAllData())r=Ra(t.serverSyncTree_,e._path,s);else{const n=ja(t.serverSyncTree_,e);r=Oa(t.serverSyncTree_,e._path,s,n)}return vl(t.eventQueue_,e._path,r),Ma(t.serverSyncTree_,e,n,null,!0),s}),(n=>(Ml(t,"get for query "+E(e)+" failed: "+n),Promise.reject(new Error(n)))))}(t._repo,t,n).then((e=>new Gl(e,new Yl(t._repo,t._path),t._queryParams.getIndex())))}class ec{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const n=e._queryParams.getIndex();return new Hl("value",this,new Gl(t.snapshotNode,new Yl(e._repo,e._path),n))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ql(this,t,e):null}matches(t){return t instanceof ec&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class nc{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ql(this,t,e):null}createEvent(t,n){e(null!=t.childName,"Child events should have a childName.");const i=Jl(new Yl(n._repo,n._path),t.childName),s=n._queryParams.getIndex();return new Hl(t.type,this,new Gl(t.snapshotNode,i,s),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof nc&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function ic(t,e,n,i){return function(t,e,n,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const e=n,i=(n,i)=>{Rl(t._repo,t,a),e(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new $l(n,r||void 0),a="value"===e?new ec(o):new nc(e,o);return function(t,e,n){let i;i=".info"===nr(e._path)?Da(t.infoSyncTree_,e,n):Da(t.serverSyncTree_,e,n),yl(t.eventQueue_,e._path,i)}(t._repo,t,a),()=>Rl(t._repo,t,a)}(t,"value",e,n,i)}!function(t){e(!ga,"__referenceConstructor has already been defined"),ga=t}(Yl),function(t){e(!ma,"__referenceConstructor has already been defined"),ma=t}(Yl);const sc={};function rc(t,e,n,i,s){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||ps("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),hs("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=Wl(r,s),c=l.repoInfo;"undefined"!=typeof process&&(a="MISSING_ENV_VAR".FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r=`http://${a}?ns=${c.namespace}`,l=Wl(r,s),c=l.repoInfo):o=!l.repoInfo.secure;const h=s&&o?new Ms(Ms.OWNER):new Rs(t.name,t.options,e);(function(t,e){const n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!ul(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),dl(t)}(n))throw new Error(z(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",l),cr(l.path)||ps("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(t,e,n,i){let s=sc[e.name];s||(s={},sc[e.name]=s);let r=s[t.toURLString()];return r&&ps("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new xl(t,false,n,i),s[t.toURLString()]=r,r}(c,t,h,new Ps(t.name,n));return new oc(u,t)}class oc{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kl(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Yl(this._repo,er())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(t,e){const n=sc[e];n&&n[t.key]===t||ps(`Database ${e}(${t.repoInfo_}) has already been deleted.`),function(t){t.persistentConnection_&&t.persistentConnection_.interrupt("repo_interrupt")}(t),delete n[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&ps("Cannot call "+t+" on a deleted database.")}}const ac={".sv":"timestamp"};function lc(){return ac}vr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},vr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)},Qi=te,Xt(new H("database",((t,{instanceIdentifier:e})=>rc(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e)),"PUBLIC").setMultipleInstances(!0)),ie(Xi,Ji,void 0),ie(Xi,Ji,"esm2017");const cc="firebasestorage.googleapis.com",hc="storageBucket";class uc extends k{constructor(t,e,n=0){super(fc(t),`Firebase Storage: ${e} (${fc(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,uc.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return fc(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var dc,pc;function fc(t){return"storage/"+t}function gc(){return new uc(dc.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function mc(t){return new uc(dc.INVALID_ARGUMENT,t)}function _c(){return new uc(dc.APP_DELETED,"The Firebase app was deleted.")}function yc(t,e){return new uc(dc.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function vc(t){throw new uc(dc.INTERNAL_ERROR,"Internal error: "+t)}!function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(dc||(dc={}));class bc{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=bc.makeFromUrl(t,e)}catch(e){return new bc(t,"")}if(""===n.path)return n;throw i=t,new uc(dc.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(t,e){let n=null;const i="([A-Za-z0-9.\\-_]+)",s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${e===cc?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let e=0;e<a.length;e++){const i=a[e],s=i.regex.exec(t);if(s){const t=s[i.indices.bucket];let e=s[i.indices.path];e||(e=""),n=new bc(t,e),i.postModify(n);break}}if(null==n)throw function(t){return new uc(dc.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return n}}class wc{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function xc(t){return"string"==typeof t||t instanceof String}function kc(t){return Ic()&&t instanceof Blob}function Ic(){return"undefined"!=typeof Blob&&!function(){var e;const n=null===(e=u())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()}function Cc(t,e,n,i){if(i<e)throw mc(`Invalid value for '${t}'. Expected ${e} or greater.`);if(i>n)throw mc(`Invalid value for '${t}'. Expected ${n} or less.`)}function Tc(t,e,n){let i=e;return null==n&&(i=`https://${e}`),`${n}://${i}/v0${t}`}function Ec(t){const e=encodeURIComponent;let n="?";for(const i in t)t.hasOwnProperty(i)&&(n=n+(e(i)+"=")+e(t[i])+"&");return n=n.slice(0,-1),n}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(pc||(pc={}));class Sc{constructor(t,e,n,i,s,r,o,a,l,c,h,u=!0){this.url_=t,this.method_=e,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{const n=this.resolve_,i=this.reject_,s=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(s,s.getResponse());void 0!==t?n(t):n()}catch(t){i(t)}else if(null!==s){const t=gc();t.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,t)):i(t)}else e.canceled?i(this.appDelete_?_c():new uc(dc.CANCELED,"User canceled the upload/download.")):i(new uc(dc.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new Pc(!1,null,!0)):this.backoffId_=function(t,e,n){let i=1,s=null,r=null,o=!1,a=0;function l(){return 2===a}let c=!1;function h(...t){c||(c=!0,e.apply(null,t))}function u(e){s=setTimeout((()=>{s=null,t(p,l())}),e)}function d(){r&&clearTimeout(r)}function p(t,...e){if(c)return void d();if(t)return d(),void h.call(null,t,...e);if(l()||o)return d(),void h.call(null,t,...e);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),u(n)}let f=!1;function g(t){f||(f=!0,d(),c||(null!==s?(t||(a=2),clearTimeout(s),u(0)):t||(a=1)))}return u(0),r=setTimeout((()=>{o=!0,g(!0)}),n),g}(((t,e)=>{if(e)return void t(!1,new Pc(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const e=n.getErrorCode()===pc.NO_ERROR,s=n.getStatus();if(!e||function(t,e){const n=t>=500&&t<600,i=-1!==[408,429].indexOf(t),s=-1!==e.indexOf(t);return n||i||s}(s,this.additionalRetryCodes_)&&this.retry){const e=n.getErrorCode()===pc.ABORT;return void t(!1,new Pc(!1,null,e))}const r=-1!==this.successCodes_.indexOf(s);t(!0,new Pc(r,n))}))}),t,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Pc{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function Rc(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Mc(...t){const e=Rc();if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(Ic())return new Blob(t);throw new uc(dc.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const Oc="base64",Dc="base64url",Nc="data_url";class Ac{constructor(t,e){this.data=t,this.contentType=e||null}}function Lc(t){const e=[];for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<=127?e.push(i):i<=2047?e.push(192|i>>6,128|63&i):55296==(64512&i)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(i=65536|(1023&i)<<10|1023&t.charCodeAt(++n),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)):e.push(239,191,189):56320==(64512&i)?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(e)}function Fc(t,e){switch(t){case Oc:{const n=-1!==e.indexOf("-"),i=-1!==e.indexOf("_");if(n||i)throw yc(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Dc:{const n=-1!==e.indexOf("+"),i=-1!==e.indexOf("/");if(n||i)throw yc(t,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(t){if("undefined"==typeof atob)throw new uc(dc.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(t)}(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw yc(t,"Invalid character found")}const i=new Uint8Array(n.length);for(let t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i}class Uc{constructor(t){this.base64=!1,this.contentType=null;const e=t.match(/^data:([^,]+)?,/);if(null===e)throw yc(Nc,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=e[1]||null;var i,s;null!=n&&(this.base64=(s=";base64",(i=n).length>=7&&i.substring(i.length-7)===s),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=t.substring(t.indexOf(",")+1)}}class jc{constructor(t,e){let n=0,i="";kc(t)?(this.data_=t,n=t.size,i=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(t,e){if(kc(this.data_)){const r=(n=this.data_,i=t,s=e,n.webkitSlice?n.webkitSlice(i,s):n.mozSlice?n.mozSlice(i,s):n.slice?n.slice(i,s):null);return null===r?null:new jc(r)}var n,i,s;{const n=new Uint8Array(this.data_.buffer,t,e-t);return new jc(n,!0)}}static getBlob(...t){if(Ic()){const e=t.map((t=>t instanceof jc?t.data_:t));return new jc(Mc.apply(null,e))}{const e=t.map((t=>xc(t)?function(t,e){switch(t){case"raw":return new Ac(Lc(e));case Oc:case Dc:return new Ac(Fc(t,e));case Nc:return new Ac(function(t){const e=new Uc(t);return e.base64?Fc(Oc,e.rest):function(t){let e;try{e=decodeURIComponent(t)}catch(t){throw yc(Nc,"Malformed data URL.")}return Lc(e)}(e.rest)}(e),new Uc(e).contentType)}throw gc()}("raw",t).data:t.data_));let n=0;e.forEach((t=>{n+=t.byteLength}));const i=new Uint8Array(n);let s=0;return e.forEach((t=>{for(let e=0;e<t.length;e++)i[s++]=t[e]})),new jc(i,!0)}}uploadData(){return this.data_}}function Bc(t){let e;try{e=JSON.parse(t)}catch(t){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e;var n}function zc(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Wc(t,e){return e}class Vc{constructor(t,e,n,i){this.server=t,this.local=e||t,this.writable=!!n,this.xform=i||Wc}}let Hc=null;function qc(){if(Hc)return Hc;const t=[];t.push(new Vc("bucket")),t.push(new Vc("generation")),t.push(new Vc("metageneration")),t.push(new Vc("name","fullPath",!0));const e=new Vc("name");e.xform=function(t,e){return function(t){return!xc(t)||t.length<2?t:zc(t)}(e)},t.push(e);const n=new Vc("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new Vc("timeCreated")),t.push(new Vc("updated")),t.push(new Vc("md5Hash",null,!0)),t.push(new Vc("cacheControl",null,!0)),t.push(new Vc("contentDisposition",null,!0)),t.push(new Vc("contentEncoding",null,!0)),t.push(new Vc("contentLanguage",null,!0)),t.push(new Vc("contentType",null,!0)),t.push(new Vc("metadata","customMetadata",!0)),Hc=t,Hc}function $c(t,e,n){const i=Bc(e);return null===i?null:function(t,e,n){const i={type:"file"},s=n.length;for(let t=0;t<s;t++){const s=n[t];i[s.local]=s.xform(i,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){const n=t.bucket,i=t.fullPath,s=new bc(n,i);return e._makeStorageReference(s)}})}(i,t),i}(t,i,n)}class Kc{constructor(t,e,n,i){this.url=t,this.method=e,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Yc(t){if(!t)throw gc()}function Gc(t){return function(e,n){let i;var s,r;return 401===e.getStatus()?i=e.getErrorText().includes("Firebase App Check token is invalid")?new uc(dc.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new uc(dc.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=t.bucket,i=new uc(dc.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(s=t.path,i=new uc(dc.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):i=n,i.status=e.getStatus(),i.serverResponse=n.serverResponse,i}}function Xc(t,e,n,i,s){const r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;const l=function(t,e,n){const i=Object.assign({},n);return i.fullPath=t.path,i.size=e.size(),i.contentType||(i.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),i}(e,i,s),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(t,e){const n={},i=e.length;for(let s=0;s<i;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}(l,n)+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",h="\r\n--"+a+"--",u=jc.getBlob(c,i,h);if(null===u)throw new uc(dc.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const d={name:l.fullPath},p=Tc(r,t.host,t._protocol),f=t.maxUploadRetryTime,g=new Kc(p,"POST",function(t,e){return function(n,i){const s=$c(t,i,e);return Yc(null!==s),s}}(t,n),f);return g.urlParams=d,g.headers=o,g.body=u.uploadData(),g.errorHandler=Gc(e),g}class Jc{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=pc.NO_ERROR,this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=pc.ABORT,t()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=pc.NETWORK_ERROR,t()})),this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,n,i){if(this.sent_)throw vc("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==i)for(const t in i)i.hasOwnProperty(t)&&this.xhr_.setRequestHeader(t,i[t].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw vc("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw vc("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw vc("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw vc("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}class Qc extends Jc{initXhr(){this.xhr_.responseType="text"}}function Zc(){return new Qc}class th{constructor(t,e){this._service=t,this._location=e instanceof bc?e:bc.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new th(t,e)}get root(){const t=new bc(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return zc(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new bc(this._location.bucket,t);return new th(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new uc(dc.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function eh(t){t._throwIfRoot("getDownloadURL");const e=function(t,e,n){const i=Tc(e.fullServerUrl(),t.host,t._protocol),s=t.maxOperationRetryTime,r=new Kc(i,"GET",function(t,e){return function(n,i){const s=$c(t,i,e);return Yc(null!==s),function(t,e,n,i){const s=Bc(e);if(null===s)return null;if(!xc(s.downloadTokens))return null;const r=s.downloadTokens;if(0===r.length)return null;const o=encodeURIComponent;return r.split(",").map((e=>{const s=t.bucket,r=t.fullPath;return Tc("/b/"+o(s)+"/o/"+o(r),n,i)+Ec({alt:"media",token:e})}))[0]}(s,i,t.host,t._protocol)}}(t,n),s);return r.errorHandler=function(t){const e=Gc(t);return function(n,i){let s=e(n,i);var r;return 404===n.getStatus()&&(r=t.path,s=new uc(dc.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")),s.serverResponse=i.serverResponse,s}}(e),r}(t.storage,t._location,qc());return t.storage.makeRequestWithTokens(e,Zc).then((t=>{if(null===t)throw new uc(dc.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t}))}function nh(t,e){if(t instanceof rh){const n=t;if(null==n._bucket)throw new uc(dc.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+hc+"' property when initializing the app?");const i=new th(n,n._bucket);return null!=e?nh(i,e):i}return void 0!==e?function(t,e){const n=function(t,e){const n=e.split("/").filter((t=>t.length>0)).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),i=new bc(t._location.bucket,n);return new th(t.storage,i)}(t,e):t}function ih(t,e){if(e&&/^[A-Za-z]+:\/\//.test(e)){if(t instanceof rh)return new th(t,e);throw mc("To use ref(service, url), the first argument must be a Storage instance.")}return nh(t,e)}function sh(t,e){const n=null==e?void 0:e[hc];return null==n?null:bc.makeFromBucketSpec(n,t)}class rh{constructor(t,e,n,i,s){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=cc,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?bc.makeFromBucketSpec(i,this._host):sh(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=bc.makeFromBucketSpec(this._url,t):this._bucket=sh(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){Cc("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){Cc("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new th(this,t)}_makeRequest(t,e,n,i,s=!0){if(this._deleted)return new wc(_c());{const r=function(t,e,n,i,s,r,o=!0){const a=Ec(t.urlParams),l=t.url+a,c=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(c,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(c,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,r),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(c,i),new Sc(l,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o)}(t,this._appId,n,i,e,this._firebaseVersion,s);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(t,e){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,i).getPromise()}}const oh="@firebase/storage",ah="0.11.2",lh="storage";function ch(t,e,n){return function(t,e,n){t._throwIfRoot("uploadBytes");const i=Xc(t.storage,t._location,qc(),new jc(e,!0),n);return t.storage.makeRequestWithTokens(i,Zc).then((e=>({metadata:e,ref:t})))}(t=V(t),e,n)}function hh(t){return eh(t=V(t))}let uh,dh;Xt(new H(lh,(function(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new rh(n,i,s,e,te)}),"PUBLIC").setMultipleInstances(!0)),ie(oh,ah,""),ie(oh,ah,"esm2017");const ph=new WeakMap,fh=new WeakMap,gh=new WeakMap,mh=new WeakMap,_h=new WeakMap;let yh={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return fh.get(t);if("objectStoreNames"===e)return t.objectStoreNames||gh.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return bh(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function vh(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(dh||(dh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(wh(this),t),bh(ph.get(this))}:function(...t){return bh(e.apply(wh(this),t))}:function(t,...n){const i=e.call(wh(this),t,...n);return gh.set(i,t.sort?t.sort():[t]),bh(i)}:(t instanceof IDBTransaction&&function(t){if(fh.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));fh.set(t,e)}(t),n=t,(uh||(uh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,yh):t);var e,n}function bh(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(bh(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&ph.set(e,t)})).catch((()=>{})),_h.set(e,t),e}(t);if(mh.has(t))return mh.get(t);const e=vh(t);return e!==t&&(mh.set(t,e),_h.set(e,t)),e}const wh=t=>_h.get(t),xh=["get","getKey","getAll","getAllKeys","count"],kh=["put","add","delete","clear"],Ih=new Map;function Ch(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Ih.get(e))return Ih.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=kh.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!xh.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return Ih.set(e,r),r}yh=(t=>({...t,get:(e,n,i)=>Ch(e,n)||t.get(e,n,i),has:(e,n)=>!!Ch(e,n)||t.has(e,n)}))(yh);const Th="@firebase/installations",Eh="0.6.4",Sh=`w:${Eh}`,Ph="FIS_v2",Rh=new I("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Mh(t){return t instanceof k&&t.code.includes("request-failed")}function Oh({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function Dh(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Nh(t,e){const n=(await e.json()).error;return Rh.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Ah({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Lh(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Fh(t){return new Promise((e=>{setTimeout(e,t)}))}const Uh=/^[cdef][\w-]{21}$/;function jh(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return Uh.test(e)?e:""}catch(t){return""}}function Bh(t){return`${t.appName}!${t.appId}`}const zh=new Map;function Wh(t,e){const n=Bh(t);Vh(n,e),function(t,e){const n=(!Hh&&"BroadcastChannel"in self&&(Hh=new BroadcastChannel("[Firebase] FID Change"),Hh.onmessage=t=>{Vh(t.data.key,t.data.fid)}),Hh);n&&n.postMessage({key:t,fid:e}),0===zh.size&&Hh&&(Hh.close(),Hh=null)}(n,e)}function Vh(t,e){const n=zh.get(t);if(n)for(const t of n)t(e)}let Hh=null;const qh="firebase-installations-store";let $h=null;function Kh(){return $h||($h=function(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=bh(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(bh(o.result),t.oldVersion,t.newVersion,bh(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(qh)}})),$h}async function Yh(t,e){const n=Bh(t),i=(await Kh()).transaction(qh,"readwrite"),s=i.objectStore(qh),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||Wh(t,e.fid),e}async function Gh(t){const e=Bh(t),n=(await Kh()).transaction(qh,"readwrite");await n.objectStore(qh).delete(e),await n.done}async function Xh(t,e){const n=Bh(t),i=(await Kh()).transaction(qh,"readwrite"),s=i.objectStore(qh),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||Wh(t,o.fid),o}async function Jh(t){let e;const n=await Xh(t.appConfig,(n=>{const i=function(t){return tu(t||{fid:jh(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Rh.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Oh(t),s=Ah(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:Ph,appId:t.appId,sdkVersion:Sh},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Lh((()=>fetch(i,a)));if(l.ok){const t=await l.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Dh(t.authToken)}}throw await Nh("Create Installation",l)}(t,e);return Yh(t.appConfig,n)}catch(n){throw Mh(n)&&409===n.customData.serverCode?await Gh(t.appConfig):await Yh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Qh(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Qh(t){let e=await Zh(t.appConfig);for(;1===e.registrationStatus;)await Fh(100),e=await Zh(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Jh(t);return n||e}return e}function Zh(t){return Xh(t,(t=>{if(!t)throw Rh.create("installation-not-found");return tu(t)}))}function tu(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function eu({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Oh(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=Ah(t);return n.append("Authorization",function(t){return`${Ph} ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:Sh,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Lh((()=>fetch(i,a)));if(l.ok)return Dh(await l.json());throw await Nh("Generate Auth Token",l)}async function nu(t,e=!1){let n;const i=await Xh(t.appConfig,(i=>{if(!su(i))throw Rh.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await iu(t.appConfig);for(;1===n.authToken.requestStatus;)await Fh(100),n=await iu(t.appConfig);const i=n.authToken;return 0===i.requestStatus?nu(t,e):i}(t,e),i;{if(!navigator.onLine)throw Rh.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await eu(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Yh(t.appConfig,i),n}catch(n){if(!Mh(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Yh(t.appConfig,n)}else await Gh(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function iu(t){return Xh(t,(t=>{if(!su(t))throw Rh.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function su(t){return void 0!==t&&2===t.registrationStatus}function ru(t){return Rh.create("missing-app-config-values",{valueName:t})}const ou="installations";let au,lu;Xt(new H(ou,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw ru("App Configuration");if(!t.name)throw ru("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw ru(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Jt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Xt(new H("installations-internal",(t=>{const e=Jt(t.getProvider("app").getImmediate(),ou).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await Jh(e);return i?i.catch(console.error):nu(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Jh(t);e&&await e}(n),(await nu(n,e)).token}(e,t)}}),"PRIVATE")),ie(Th,Eh),ie(Th,Eh,"esm2017");const cu=new WeakMap,hu=new WeakMap,uu=new WeakMap,du=new WeakMap,pu=new WeakMap;let fu={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return hu.get(t);if("objectStoreNames"===e)return t.objectStoreNames||uu.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return mu(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function gu(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(lu||(lu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(_u(this),t),mu(cu.get(this))}:function(...t){return mu(e.apply(_u(this),t))}:function(t,...n){const i=e.call(_u(this),t,...n);return uu.set(i,t.sort?t.sort():[t]),mu(i)}:(t instanceof IDBTransaction&&function(t){if(hu.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));hu.set(t,e)}(t),n=t,(au||(au=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,fu):t);var e,n}function mu(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(mu(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&cu.set(e,t)})).catch((()=>{})),pu.set(e,t),e}(t);if(du.has(t))return du.get(t);const e=gu(t);return e!==t&&(du.set(t,e),pu.set(e,t)),e}const _u=t=>pu.get(t);function yu(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=mu(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(mu(o.result),t.oldVersion,t.newVersion,mu(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}function vu(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",(()=>e())),mu(n).then((()=>{}))}const bu=["get","getKey","getAll","getAllKeys","count"],wu=["put","add","delete","clear"],xu=new Map;function ku(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(xu.get(e))return xu.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=wu.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!bu.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return xu.set(e,r),r}fu=(t=>({...t,get:(e,n,i)=>ku(e,n)||t.get(e,n,i),has:(e,n)=>!!ku(e,n)||t.has(e,n)}))(fu);const Iu="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Cu="google.c.a.c_id";var Tu,Eu;function Su(t){const e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Pu(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),i=new Uint8Array(n.length);for(let t=0;t<n.length;++t)i[t]=n.charCodeAt(t);return i}!function(t){t[t.DATA_MESSAGE=1]="DATA_MESSAGE",t[t.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(Tu||(Tu={})),function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"}(Eu||(Eu={}));const Ru="fcm_token_details_db",Mu="fcm_token_object_Store",Ou="firebase-messaging-store";let Du=null;function Nu(){return Du||(Du=yu("firebase-messaging-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(Ou)}})),Du}async function Au(t){const e=Fu(t),n=await Nu(),i=await n.transaction(Ou).objectStore(Ou).get(e);if(i)return i;{const e=await async function(t){if("databases"in indexedDB){const t=(await indexedDB.databases()).map((t=>t.name));if(!t.includes(Ru))return null}let e=null;return(await yu(Ru,5,{upgrade:async(n,i,s,r)=>{var o;if(i<2)return;if(!n.objectStoreNames.contains(Mu))return;const a=r.objectStore(Mu),l=await a.index("fcmSenderId").get(t);if(await a.clear(),l)if(2===i){const t=l;if(!t.auth||!t.p256dh||!t.endpoint)return;e={token:t.fcmToken,createTime:null!==(o=t.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:t.auth,p256dh:t.p256dh,endpoint:t.endpoint,swScope:t.swScope,vapidKey:"string"==typeof t.vapidKey?t.vapidKey:Su(t.vapidKey)}}}else if(3===i){const t=l;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:Su(t.auth),p256dh:Su(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:Su(t.vapidKey)}}}else if(4===i){const t=l;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:Su(t.auth),p256dh:Su(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:Su(t.vapidKey)}}}}})).close(),await vu(Ru),await vu("fcm_vapid_details_db"),await vu("undefined"),function(t){if(!t||!t.subscriptionOptions)return!1;const{subscriptionOptions:e}=t;return"number"==typeof t.createTime&&t.createTime>0&&"string"==typeof t.token&&t.token.length>0&&"string"==typeof e.auth&&e.auth.length>0&&"string"==typeof e.p256dh&&e.p256dh.length>0&&"string"==typeof e.endpoint&&e.endpoint.length>0&&"string"==typeof e.swScope&&e.swScope.length>0&&"string"==typeof e.vapidKey&&e.vapidKey.length>0}(e)?e:null}(t.appConfig.senderId);if(e)return await Lu(t,e),e}}async function Lu(t,e){const n=Fu(t),i=(await Nu()).transaction(Ou,"readwrite");return await i.objectStore(Ou).put(e,n),await i.done,e}function Fu({appConfig:t}){return t.appId}const Uu=new I("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function ju(t,e){const n={method:"DELETE",headers:await zu(t)};try{const i=await fetch(`${Bu(t.appConfig)}/${e}`,n),s=await i.json();if(s.error){const t=s.error.message;throw Uu.create("token-unsubscribe-failed",{errorInfo:t})}}catch(t){throw Uu.create("token-unsubscribe-failed",{errorInfo:null==t?void 0:t.toString()})}}function Bu({projectId:t}){return`https://fcmregistrations.googleapis.com/v1/projects/${t}/registrations`}async function zu({appConfig:t,installations:e}){const n=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function Wu({p256dh:t,auth:e,endpoint:n,vapidKey:i}){const s={web:{endpoint:n,auth:e,p256dh:t}};return i!==Iu&&(s.web.applicationPubKey=i),s}async function Vu(t){const e=await async function(t,e){const n=await t.pushManager.getSubscription();return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Pu(e)})}(t.swRegistration,t.vapidKey),n={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:Su(e.getKey("auth")),p256dh:Su(e.getKey("p256dh"))},i=await Au(t.firebaseDependencies);if(i){if(function(t,e){const n=e.vapidKey===t.vapidKey,i=e.endpoint===t.endpoint,s=e.auth===t.auth,r=e.p256dh===t.p256dh;return n&&i&&s&&r}(i.subscriptionOptions,n))return Date.now()>=i.createTime+6048e5?async function(t,e){try{const n=await async function(t,e){const n=await zu(t),i=Wu(e.subscriptionOptions),s={method:"PATCH",headers:n,body:JSON.stringify(i)};let r;try{const n=await fetch(`${Bu(t.appConfig)}/${e.token}`,s);r=await n.json()}catch(t){throw Uu.create("token-update-failed",{errorInfo:null==t?void 0:t.toString()})}if(r.error){const t=r.error.message;throw Uu.create("token-update-failed",{errorInfo:t})}if(!r.token)throw Uu.create("token-update-no-token");return r.token}(t.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await Lu(t.firebaseDependencies,i),n}catch(e){throw await async function(t){const e=await Au(t.firebaseDependencies);e&&(await ju(t.firebaseDependencies,e.token),await async function(t){const e=Fu(t),n=(await Nu()).transaction(Ou,"readwrite");await n.objectStore(Ou).delete(e),await n.done}(t.firebaseDependencies));const n=await t.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}(t),e}}(t,{token:i.token,createTime:Date.now(),subscriptionOptions:n}):i.token;try{await ju(t.firebaseDependencies,i.token)}catch(t){console.warn(t)}return Hu(t.firebaseDependencies,n)}return Hu(t.firebaseDependencies,n)}async function Hu(t,e){const n=await async function(t,e){const n=await zu(t),i=Wu(e),s={method:"POST",headers:n,body:JSON.stringify(i)};let r;try{const e=await fetch(Bu(t.appConfig),s);r=await e.json()}catch(t){throw Uu.create("token-subscribe-failed",{errorInfo:null==t?void 0:t.toString()})}if(r.error){const t=r.error.message;throw Uu.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw Uu.create("token-subscribe-no-token");return r.token}(t,e),i={token:n,createTime:Date.now(),subscriptionOptions:e};return await Lu(t,i),i.token}function qu(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return function(t,e){if(!e.notification)return;t.notification={};const n=e.notification.title;n&&(t.notification.title=n);const i=e.notification.body;i&&(t.notification.body=i);const s=e.notification.image;s&&(t.notification.image=s);const r=e.notification.icon;r&&(t.notification.icon=r)}(e,t),function(t,e){e.data&&(t.data=e.data)}(e,t),function(t,e){var n,i,s,r,o;if(!e.fcmOptions&&!(null===(n=e.notification)||void 0===n?void 0:n.click_action))return;t.fcmOptions={};const a=null!==(s=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==s?s:null===(r=e.notification)||void 0===r?void 0:r.click_action;a&&(t.fcmOptions.link=a);const l=null===(o=e.fcmOptions)||void 0===o?void 0:o.analytics_label;l&&(t.fcmOptions.analyticsLabel=l)}(e,t),e}function $u(t,e){const n=[];for(let i=0;i<t.length;i++)n.push(t.charAt(i)),i<e.length&&n.push(e.charAt(i));return n.join("")}function Ku(t){return Uu.create("missing-app-config-values",{valueName:t})}$u("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),$u("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Yu{constructor(t,e,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const i=function(t){if(!t||!t.options)throw Ku("App Configuration Object");if(!t.name)throw Ku("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:n}=t;for(const t of e)if(!n[t])throw Ku(t);return{appName:t.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(t);this.firebaseDependencies={app:t,appConfig:i,installations:e,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Gu(t,e){if(!navigator)throw Uu.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw Uu.create("permission-blocked");return await async function(t,e){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=Iu)}(t,null==e?void 0:e.vapidKey),await async function(t,e){if(e||t.swRegistration||await async function(t){try{t.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),t.swRegistration.update().catch((()=>{}))}catch(t){throw Uu.create("failed-service-worker-registration",{browserErrorMessage:null==t?void 0:t.message})}}(t),e||!t.swRegistration){if(!(e instanceof ServiceWorkerRegistration))throw Uu.create("invalid-sw-registration");t.swRegistration=e}}(t,null==e?void 0:e.serviceWorkerRegistration),Vu(t)}async function Xu(t,e){const n=e.data;if(!n.isFirebaseMessaging)return;t.onMessageHandler&&n.messageType===Eu.PUSH_RECEIVED&&("function"==typeof t.onMessageHandler?t.onMessageHandler(qu(n)):t.onMessageHandler.next(qu(n)));const i=n.data;var s;"object"==typeof(s=i)&&s&&Cu in s&&"1"===i["google.c.a.e"]&&await async function(t,e,n){const i=function(t){switch(t){case Eu.NOTIFICATION_CLICKED:return"notification_open";case Eu.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(e);(await t.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:n[Cu],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}(t,n.messageType,i)}const Ju="@firebase/messaging",Qu="0.12.4";function Zu(){}Xt(new H("messaging",(t=>{const e=new Yu(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(t=>Xu(e,t))),e}),"PUBLIC")),Xt(new H("messaging-internal",(t=>{const e=t.getProvider("messaging").getImmediate();return{getToken:t=>Gu(e,t)}}),"PRIVATE")),ie(Ju,Qu),ie(Ju,Qu,"esm2017");const td=function(){let t=0;return function(){return t++}}();function ed(t){return null==t}function nd(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function id(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const sd=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function rd(t,e){return sd(t)?t:e}function od(t,e){return void 0===t?e:t}const ad=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function ld(t,e,n){if(t&&"function"==typeof t.call)return t.apply(n,e)}function cd(t,e,n,i){let s,r,o;if(nd(t))if(r=t.length,i)for(s=r-1;s>=0;s--)e.call(n,t[s],s);else for(s=0;s<r;s++)e.call(n,t[s],s);else if(id(t))for(o=Object.keys(t),r=o.length,s=0;s<r;s++)e.call(n,t[o[s]],o[s])}function hd(t,e){let n,i,s,r;if(!t||!e||t.length!==e.length)return!1;for(n=0,i=t.length;n<i;++n)if(s=t[n],r=e[n],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function ud(t){if(nd(t))return t.map(ud);if(id(t)){const e=Object.create(null),n=Object.keys(t),i=n.length;let s=0;for(;s<i;++s)e[n[s]]=ud(t[n[s]]);return e}return t}function dd(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function pd(t,e,n,i){if(!dd(t))return;const s=e[t],r=n[t];id(s)&&id(r)?fd(s,r,i):e[t]=ud(r)}function fd(t,e,n){const i=nd(e)?e:[e],s=i.length;if(!id(t))return t;const r=(n=n||{}).merger||pd;for(let o=0;o<s;++o){if(!id(e=i[o]))continue;const s=Object.keys(e);for(let i=0,o=s.length;i<o;++i)r(s[i],t,e,n)}return t}function gd(t,e){return fd(t,e,{merger:md})}function md(t,e,n){if(!dd(t))return;const i=e[t],s=n[t];id(i)&&id(s)?gd(i,s):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=ud(s))}const _d={"":t=>t,x:t=>t.x,y:t=>t.y};function yd(t,e){const n=_d[e]||(_d[e]=function(t){const e=function(t){const e=t.split("."),n=[];let i="";for(const t of e)i+=t,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(t);return t=>{for(const n of e){if(""===n)break;t=t&&t[n]}return t}}(e));return n(t)}function vd(t){return t.charAt(0).toUpperCase()+t.slice(1)}const bd=t=>void 0!==t,wd=t=>"function"==typeof t,xd=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0},kd=Math.PI,Id=2*kd,Cd=Id+kd,Td=Number.POSITIVE_INFINITY,Ed=kd/180,Sd=kd/2,Pd=kd/4,Rd=2*kd/3,Md=Math.log10,Od=Math.sign;function Dd(t){const e=Math.round(t);t=Ad(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(Md(t))),i=t/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function Nd(t){return!isNaN(parseFloat(t))&&isFinite(t)}function Ad(t,e,n){return Math.abs(t-e)<n}function Ld(t,e,n){let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i][n],isNaN(r)||(e.min=Math.min(e.min,r),e.max=Math.max(e.max,r))}function Fd(t){return t*(kd/180)}function Ud(t){return t*(180/kd)}function jd(t){if(!sd(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function Bd(t,e){const n=e.x-t.x,i=e.y-t.y,s=Math.sqrt(n*n+i*i);let r=Math.atan2(i,n);return r<-.5*kd&&(r+=Id),{angle:r,distance:s}}function zd(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Wd(t,e){return(t-e+Cd)%Id-kd}function Vd(t){return(t%Id+Id)%Id}function Hd(t,e,n,i){const s=Vd(t),r=Vd(e),o=Vd(n),a=Vd(r-s),l=Vd(o-s),c=Vd(s-r),h=Vd(s-o);return s===r||s===o||i&&r===o||a>l&&c<h}function qd(t,e,n){return Math.max(e,Math.min(n,t))}function $d(t,e,n,i=1e-6){return t>=Math.min(e,n)-i&&t<=Math.max(e,n)+i}function Kd(t,e,n){n=n||(n=>t[n]<e);let i,s=t.length-1,r=0;for(;s-r>1;)i=r+s>>1,n(i)?r=i:s=i;return{lo:r,hi:s}}const Yd=(t,e,n,i)=>Kd(t,n,i?i=>t[i][e]<=n:i=>t[i][e]<n),Gd=(t,e,n)=>Kd(t,n,(i=>t[i][e]>=n)),Xd=["push","pop","shift","splice","unshift"];function Jd(t,e){const n=t._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(e);-1!==s&&i.splice(s,1),i.length>0||(Xd.forEach((e=>{delete t[e]})),delete t._chartjs)}function Qd(t){const e=new Set;let n,i;for(n=0,i=t.length;n<i;++n)e.add(t[n]);return e.size===i?t:Array.from(e)}const Zd="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function tp(t,e,n){const i=n||(t=>Array.prototype.slice.call(t));let s=!1,r=[];return function(...n){r=i(n),s||(s=!0,Zd.call(window,(()=>{s=!1,t.apply(e,r)})))}}const ep=t=>"start"===t?"left":"end"===t?"right":"center",np=(t,e,n)=>"start"===t?e:"end"===t?n:(e+n)/2;function ip(t,e,n){const i=e.length;let s=0,r=i;if(t._sorted){const{iScale:o,_parsed:a}=t,l=o.axis,{min:c,max:h,minDefined:u,maxDefined:d}=o.getUserBounds();u&&(s=qd(Math.min(Yd(a,o.axis,c).lo,n?i:Yd(e,l,o.getPixelForValue(c)).lo),0,i-1)),r=d?qd(Math.max(Yd(a,o.axis,h,!0).hi+1,n?0:Yd(e,l,o.getPixelForValue(h),!0).hi+1),s,i)-s:i-s}return{start:s,count:r}}function sp(t){const{xScale:e,yScale:n,_scaleRanges:i}=t,s={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!i)return t._scaleRanges=s,!0;const r=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),r}const rp=t=>0===t||1===t,op=(t,e,n)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*Id/n),ap=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*Id/n)+1,lp={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*Sd),easeOutSine:t=>Math.sin(t*Sd),easeInOutSine:t=>-.5*(Math.cos(kd*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>rp(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>rp(t)?t:op(t,.075,.3),easeOutElastic:t=>rp(t)?t:ap(t,.075,.3),easeInOutElastic(t){const e=.1125;return rp(t)?t:t<.5?.5*op(2*t,e,.45):.5+.5*ap(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-lp.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375},easeInOutBounce:t=>t<.5?.5*lp.easeInBounce(2*t):.5*lp.easeOutBounce(2*t-1)+.5};function cp(t){return t+.5|0}const hp=(t,e,n)=>Math.max(Math.min(t,n),e);function up(t){return hp(cp(2.55*t),0,255)}function dp(t){return hp(cp(255*t),0,255)}function pp(t){return hp(cp(t/2.55)/100,0,1)}function fp(t){return hp(cp(100*t),0,100)}const gp={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},mp=[..."0123456789ABCDEF"],_p=t=>mp[15&t],yp=t=>mp[(240&t)>>4]+mp[15&t],vp=t=>(240&t)>>4==(15&t);const bp=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function wp(t,e,n){const i=e*Math.min(n,1-n),s=(e,s=(e+t/30)%12)=>n-i*Math.max(Math.min(s-3,9-s,1),-1);return[s(0),s(8),s(4)]}function xp(t,e,n){const i=(i,s=(i+t/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function kp(t,e,n){const i=wp(t,1,.5);let s;for(e+n>1&&(s=1/(e+n),e*=s,n*=s),s=0;s<3;s++)i[s]*=1-e-n,i[s]+=e;return i}function Ip(t){const e=t.r/255,n=t.g/255,i=t.b/255,s=Math.max(e,n,i),r=Math.min(e,n,i),o=(s+r)/2;let a,l,c;return s!==r&&(c=s-r,l=o>.5?c/(2-s-r):c/(s+r),a=function(t,e,n,i,s){return t===s?(e-n)/i+(e<n?6:0):e===s?(n-t)/i+2:(t-e)/i+4}(e,n,i,c,s),a=60*a+.5),[0|a,l||0,o]}function Cp(t,e,n,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,i)).map(dp)}function Tp(t,e,n){return Cp(wp,t,e,n)}function Ep(t){return(t%360+360)%360}const Sp={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Pp={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Rp;const Mp=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,Op=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Dp=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Np(t,e,n){if(t){let i=Ip(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*n,0===e?360:1)),i=Tp(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function Ap(t,e){return t?Object.assign(e||{},t):t}function Lp(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=dp(t[3]))):(e=Ap(t,{r:0,g:0,b:0,a:1})).a=dp(e.a),e}function Fp(t){return"r"===t.charAt(0)?function(t){const e=Mp.exec(t);let n,i,s,r=255;if(e){if(e[7]!==n){const t=+e[7];r=e[8]?up(t):hp(255*t,0,255)}return n=+e[1],i=+e[3],s=+e[5],n=255&(e[2]?up(n):hp(n,0,255)),i=255&(e[4]?up(i):hp(i,0,255)),s=255&(e[6]?up(s):hp(s,0,255)),{r:n,g:i,b:s,a:r}}}(t):function(t){const e=bp.exec(t);let n,i=255;if(!e)return;e[5]!==n&&(i=e[6]?up(+e[5]):dp(+e[5]));const s=Ep(+e[2]),r=+e[3]/100,o=+e[4]/100;return n="hwb"===e[1]?function(t,e,n){return Cp(kp,t,e,n)}(s,r,o):"hsv"===e[1]?function(t,e,n){return Cp(xp,t,e,n)}(s,r,o):Tp(s,r,o),{r:n[0],g:n[1],b:n[2],a:i}}(t)}class Up{constructor(t){if(t instanceof Up)return t;const e=typeof t;let n;var i,s,r;"object"===e?n=Lp(t):"string"===e&&(r=(i=t).length,"#"===i[0]&&(4===r||5===r?s={r:255&17*gp[i[1]],g:255&17*gp[i[2]],b:255&17*gp[i[3]],a:5===r?17*gp[i[4]]:255}:7!==r&&9!==r||(s={r:gp[i[1]]<<4|gp[i[2]],g:gp[i[3]]<<4|gp[i[4]],b:gp[i[5]]<<4|gp[i[6]],a:9===r?gp[i[7]]<<4|gp[i[8]]:255})),n=s||function(t){Rp||(Rp=function(){const t={},e=Object.keys(Pp),n=Object.keys(Sp);let i,s,r,o,a;for(i=0;i<e.length;i++){for(o=a=e[i],s=0;s<n.length;s++)r=n[s],a=a.replace(r,Sp[r]);r=parseInt(Pp[o],16),t[a]=[r>>16&255,r>>8&255,255&r]}return t}(),Rp.transparent=[0,0,0,0]);const e=Rp[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}(t)||Fp(t)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var t=Ap(this._rgb);return t&&(t.a=pp(t.a)),t}set rgb(t){this._rgb=Lp(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${pp(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?(t=this._rgb,e=(t=>vp(t.r)&&vp(t.g)&&vp(t.b)&&vp(t.a))(t)?_p:yp,t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0):void 0;var t,e}hslString(){return this._valid?function(t){if(!t)return;const e=Ip(t),n=e[0],i=fp(e[1]),s=fp(e[2]);return t.a<255?`hsla(${n}, ${i}%, ${s}%, ${pp(t.a)})`:`hsl(${n}, ${i}%, ${s}%)`}(this._rgb):void 0}mix(t,e){if(t){const n=this.rgb,i=t.rgb;let s;const r=e===s?.5:e,o=2*r-1,a=n.a-i.a,l=((o*a==-1?o:(o+a)/(1+o*a))+1)/2;s=1-l,n.r=255&l*n.r+s*i.r+.5,n.g=255&l*n.g+s*i.g+.5,n.b=255&l*n.b+s*i.b+.5,n.a=r*n.a+(1-r)*i.a,this.rgb=n}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,n){const i=Dp(pp(t.r)),s=Dp(pp(t.g)),r=Dp(pp(t.b));return{r:dp(Op(i+n*(Dp(pp(e.r))-i))),g:dp(Op(s+n*(Dp(pp(e.g))-s))),b:dp(Op(r+n*(Dp(pp(e.b))-r))),a:t.a+n*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Up(this.rgb)}alpha(t){return this._rgb.a=dp(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=cp(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Np(this._rgb,2,t),this}darken(t){return Np(this._rgb,2,-t),this}saturate(t){return Np(this._rgb,1,t),this}desaturate(t){return Np(this._rgb,1,-t),this}rotate(t){return function(t,e){var n=Ip(t);n[0]=Ep(n[0]+e),n=Tp(n),t.r=n[0],t.g=n[1],t.b=n[2]}(this._rgb,t),this}}function jp(t){return new Up(t)}function Bp(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function zp(t){return Bp(t)?t:jp(t)}function Wp(t){return Bp(t)?t:jp(t).saturate(.5).darken(.1).hexString()}const Vp=Object.create(null),Hp=Object.create(null);function qp(t,e){if(!e)return t;const n=e.split(".");for(let e=0,i=n.length;e<i;++e){const i=n[e];t=t[i]||(t[i]=Object.create(null))}return t}function $p(t,e,n){return"string"==typeof e?fd(qp(t,e),n):fd(qp(t,""),e)}var Kp=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>Wp(e.backgroundColor),this.hoverBorderColor=(t,e)=>Wp(e.borderColor),this.hoverColor=(t,e)=>Wp(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return $p(this,t,e)}get(t){return qp(this,t)}describe(t,e){return $p(Hp,t,e)}override(t,e){return $p(Vp,t,e)}route(t,e,n,i){const s=qp(this,t),r=qp(this,n),o="_"+e;Object.defineProperties(s,{[o]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[o],e=r[i];return id(t)?Object.assign({},e,t):od(t,e)},set(t){this[o]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function Yp(t,e,n,i,s){let r=e[s];return r||(r=e[s]=t.measureText(s).width,n.push(s)),r>i&&(i=r),i}function Gp(t,e,n,i){let s=(i=i||{}).data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(s=i.data={},r=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let o=0;const a=n.length;let l,c,h,u,d;for(l=0;l<a;l++)if(u=n[l],null!=u&&!0!==nd(u))o=Yp(t,s,r,o,u);else if(nd(u))for(c=0,h=u.length;c<h;c++)d=u[c],null==d||nd(d)||(o=Yp(t,s,r,o,d));t.restore();const p=r.length/2;if(p>n.length){for(l=0;l<p;l++)delete s[r[l]];r.splice(0,p)}return o}function Xp(t,e,n){const i=t.currentDevicePixelRatio,s=0!==n?Math.max(n/2,.5):0;return Math.round((e-s)*i)/i+s}function Jp(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Qp(t,e,n,i){Zp(t,e,n,i,null)}function Zp(t,e,n,i,s){let r,o,a,l,c,h;const u=e.pointStyle,d=e.rotation,p=e.radius;let f=(d||0)*Ed;if(u&&"object"==typeof u&&(r=u.toString(),"[object HTMLImageElement]"===r||"[object HTMLCanvasElement]"===r))return t.save(),t.translate(n,i),t.rotate(f),t.drawImage(u,-u.width/2,-u.height/2,u.width,u.height),void t.restore();if(!(isNaN(p)||p<=0)){switch(t.beginPath(),u){default:s?t.ellipse(n,i,s/2,p,0,0,Id):t.arc(n,i,p,0,Id),t.closePath();break;case"triangle":t.moveTo(n+Math.sin(f)*p,i-Math.cos(f)*p),f+=Rd,t.lineTo(n+Math.sin(f)*p,i-Math.cos(f)*p),f+=Rd,t.lineTo(n+Math.sin(f)*p,i-Math.cos(f)*p),t.closePath();break;case"rectRounded":c=.516*p,l=p-c,o=Math.cos(f+Pd)*l,a=Math.sin(f+Pd)*l,t.arc(n-o,i-a,c,f-kd,f-Sd),t.arc(n+a,i-o,c,f-Sd,f),t.arc(n+o,i+a,c,f,f+Sd),t.arc(n-a,i+o,c,f+Sd,f+kd),t.closePath();break;case"rect":if(!d){l=Math.SQRT1_2*p,h=s?s/2:l,t.rect(n-h,i-l,2*h,2*l);break}f+=Pd;case"rectRot":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,i-a),t.lineTo(n+a,i-o),t.lineTo(n+o,i+a),t.lineTo(n-a,i+o),t.closePath();break;case"crossRot":f+=Pd;case"cross":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o);break;case"star":o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o),f+=Pd,o=Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a),t.moveTo(n+a,i-o),t.lineTo(n-a,i+o);break;case"line":o=s?s/2:Math.cos(f)*p,a=Math.sin(f)*p,t.moveTo(n-o,i-a),t.lineTo(n+o,i+a);break;case"dash":t.moveTo(n,i),t.lineTo(n+Math.cos(f)*p,i+Math.sin(f)*p)}t.fill(),e.borderWidth>0&&t.stroke()}}function tf(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function ef(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function nf(t){t.restore()}function sf(t,e,n,i,s){if(!e)return t.lineTo(n.x,n.y);if("middle"===s){const i=(e.x+n.x)/2;t.lineTo(i,e.y),t.lineTo(i,n.y)}else"after"===s!=!!i?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function rf(t,e,n,i){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function of(t,e,n,i,s,r={}){const o=nd(e)?e:[e],a=r.strokeWidth>0&&""!==r.strokeColor;let l,c;for(t.save(),t.font=s.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),ed(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,r),l=0;l<o.length;++l)c=o[l],a&&(r.strokeColor&&(t.strokeStyle=r.strokeColor),ed(r.strokeWidth)||(t.lineWidth=r.strokeWidth),t.strokeText(c,n,i,r.maxWidth)),t.fillText(c,n,i,r.maxWidth),af(t,n,i,c,r),i+=s.lineHeight;t.restore()}function af(t,e,n,i,s){if(s.strikethrough||s.underline){const r=t.measureText(i),o=e-r.actualBoundingBoxLeft,a=e+r.actualBoundingBoxRight,l=n-r.actualBoundingBoxAscent,c=n+r.actualBoundingBoxDescent,h=s.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=s.decorationWidth||2,t.moveTo(o,h),t.lineTo(a,h),t.stroke()}}function lf(t,e){const{x:n,y:i,w:s,h:r,radius:o}=e;t.arc(n+o.topLeft,i+o.topLeft,o.topLeft,-Sd,kd,!0),t.lineTo(n,i+r-o.bottomLeft),t.arc(n+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,kd,Sd,!0),t.lineTo(n+s-o.bottomRight,i+r),t.arc(n+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,Sd,0,!0),t.lineTo(n+s,i+o.topRight),t.arc(n+s-o.topRight,i+o.topRight,o.topRight,0,-Sd,!0),t.lineTo(n+o.topLeft,i)}const cf=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),hf=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function uf(t,e){const n=(""+t).match(cf);if(!n||"normal"===n[1])return 1.2*e;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100}return e*t}function df(t,e){const n={},i=id(e),s=i?Object.keys(e):e,r=id(t)?i?n=>od(t[n],t[e[n]]):e=>t[e]:()=>t;for(const t of s)n[t]=+r(t)||0;return n}function pf(t){return df(t,{top:"y",right:"x",bottom:"y",left:"x"})}function ff(t){return df(t,["topLeft","topRight","bottomLeft","bottomRight"])}function gf(t){const e=pf(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function mf(t,e){t=t||{},e=e||Kp.font;let n=od(t.size,e.size);"string"==typeof n&&(n=parseInt(n,10));let i=od(t.style,e.style);i&&!(""+i).match(hf)&&(console.warn('Invalid font style specified: "'+i+'"'),i="");const s={family:od(t.family,e.family),lineHeight:uf(od(t.lineHeight,e.lineHeight),n),size:n,style:i,weight:od(t.weight,e.weight),string:""};return s.string=function(t){return!t||ed(t.size)||ed(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}(s),s}function _f(t,e,n,i){let s,r,o,a=!0;for(s=0,r=t.length;s<r;++s)if(o=t[s],void 0!==o&&(void 0!==e&&"function"==typeof o&&(o=o(e),a=!1),void 0!==n&&nd(o)&&(o=o[n%o.length],a=!1),void 0!==o))return i&&!a&&(i.cacheable=!1),o}function yf(t,e){return Object.assign(Object.create(t),e)}function vf(t,e=[""],n=t,i,s=()=>t[0]){bd(i)||(i=Rf("_fallback",t));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:n,_fallback:i,_getTarget:s,override:s=>vf([s,...t],e,n,i)};return new Proxy(r,{deleteProperty:(e,n)=>(delete e[n],delete e._keys,delete t[0][n],!0),get:(n,i)=>If(n,i,(()=>function(t,e,n,i){let s;for(const r of e)if(s=Rf(xf(r,t),n),bd(s))return kf(t,s)?Sf(n,i,t,s):s}(i,e,t,n))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>Mf(t).includes(e),ownKeys:t=>Mf(t),set(t,e,n){const i=t._storage||(t._storage=s());return t[e]=i[e]=n,delete t._keys,!0}})}function bf(t,e,n,i){const s={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:wf(t,i),setContext:e=>bf(t,e,n,i),override:s=>bf(t.override(s),e,n,i)};return new Proxy(s,{deleteProperty:(e,n)=>(delete e[n],delete t[n],!0),get:(t,e,n)=>If(t,e,(()=>function(t,e,n){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=t;let a=i[e];return wd(a)&&o.isScriptable(e)&&(a=function(t,e,n,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);return a.add(t),e=e(r,o||i),a.delete(t),kf(t,e)&&(e=Sf(s._scopes,s,t,e)),e}(e,a,t,n)),nd(a)&&a.length&&(a=function(t,e,n,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=n;if(bd(r.index)&&i(t))e=e[r.index%e.length];else if(id(e[0])){const n=e,i=s._scopes.filter((t=>t!==n));e=[];for(const l of n){const n=Sf(i,s,t,l);e.push(bf(n,r,o&&o[t],a))}}return e}(e,a,t,o.isIndexable)),kf(e,a)&&(a=bf(a,s,r&&r[e],o)),a}(t,e,n))),getOwnPropertyDescriptor:(e,n)=>e._descriptors.allKeys?Reflect.has(t,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,n),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,n)=>Reflect.has(t,n),ownKeys:()=>Reflect.ownKeys(t),set:(e,n,i)=>(t[n]=i,delete e[n],!0)})}function wf(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:i=e.indexable,_allKeys:s=e.allKeys}=t;return{allKeys:s,scriptable:n,indexable:i,isScriptable:wd(n)?n:()=>n,isIndexable:wd(i)?i:()=>i}}const xf=(t,e)=>t?t+vd(e):e,kf=(t,e)=>id(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function If(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const i=n();return t[e]=i,i}function Cf(t,e,n){return wd(t)?t(e,n):t}const Tf=(t,e)=>!0===t?e:"string"==typeof t?yd(e,t):void 0;function Ef(t,e,n,i,s){for(const r of e){const e=Tf(n,r);if(e){t.add(e);const r=Cf(e._fallback,n,s);if(bd(r)&&r!==n&&r!==i)return r}else if(!1===e&&bd(i)&&n!==i)return null}return!1}function Sf(t,e,n,i){const s=e._rootScopes,r=Cf(e._fallback,n,i),o=[...t,...s],a=new Set;a.add(i);let l=Pf(a,o,n,r||n,i);return null!==l&&(!bd(r)||r===n||(l=Pf(a,o,r,l,i),null!==l))&&vf(Array.from(a),[""],s,r,(()=>function(t,e,n){const i=t._getTarget();e in i||(i[e]={});const s=i[e];return nd(s)&&id(n)?n:s}(e,n,i)))}function Pf(t,e,n,i,s){for(;n;)n=Ef(t,e,n,i,s);return n}function Rf(t,e){for(const n of e){if(!n)continue;const e=n[t];if(bd(e))return e}}function Mf(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const n of t)for(const t of Object.keys(n).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function Of(t,e,n,i){const{iScale:s}=t,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,h;for(a=0,l=i;a<l;++a)c=a+n,h=e[c],o[a]={r:s.parse(yd(h,r),c)};return o}const Df=Number.EPSILON||1e-14,Nf=(t,e)=>e<t.length&&!t[e].skip&&t[e],Af=t=>"x"===t?"y":"x";function Lf(t,e,n,i){const s=t.skip?e:t,r=e,o=n.skip?e:n,a=zd(r,s),l=zd(o,r);let c=a/(a+l),h=l/(a+l);c=isNaN(c)?0:c,h=isNaN(h)?0:h;const u=i*c,d=i*h;return{previous:{x:r.x-u*(o.x-s.x),y:r.y-u*(o.y-s.y)},next:{x:r.x+d*(o.x-s.x),y:r.y+d*(o.y-s.y)}}}function Ff(t,e,n){return Math.max(Math.min(t,n),e)}function Uf(t,e,n,i,s){let r,o,a,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)!function(t,e="x"){const n=Af(e),i=t.length,s=Array(i).fill(0),r=Array(i);let o,a,l,c=Nf(t,0);for(o=0;o<i;++o)if(a=l,l=c,c=Nf(t,o+1),l){if(c){const t=c[e]-l[e];s[o]=0!==t?(c[n]-l[n])/t:0}r[o]=a?c?Od(s[o-1])!==Od(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}!function(t,e,n){const i=t.length;let s,r,o,a,l,c=Nf(t,0);for(let h=0;h<i-1;++h)l=c,c=Nf(t,h+1),l&&c&&(Ad(e[h],0,Df)?n[h]=n[h+1]=0:(s=n[h]/e[h],r=n[h+1]/e[h],a=Math.pow(s,2)+Math.pow(r,2),a<=9||(o=3/Math.sqrt(a),n[h]=s*o*e[h],n[h+1]=r*o*e[h])))}(t,s,r),function(t,e,n="x"){const i=Af(n),s=t.length;let r,o,a,l=Nf(t,0);for(let c=0;c<s;++c){if(o=a,a=l,l=Nf(t,c+1),!a)continue;const s=a[n],h=a[i];o&&(r=(s-o[n])/3,a[`cp1${n}`]=s-r,a[`cp1${i}`]=h-r*e[c]),l&&(r=(l[n]-s)/3,a[`cp2${n}`]=s+r,a[`cp2${i}`]=h+r*e[c])}}(t,r,e)}(t,s);else{let n=i?t[t.length-1]:t[0];for(r=0,o=t.length;r<o;++r)a=t[r],l=Lf(n,a,t[Math.min(r+1,o-(i?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,n=a}e.capBezierPoints&&function(t,e){let n,i,s,r,o,a=tf(t[0],e);for(n=0,i=t.length;n<i;++n)o=r,r=a,a=n<i-1&&tf(t[n+1],e),r&&(s=t[n],o&&(s.cp1x=Ff(s.cp1x,e.left,e.right),s.cp1y=Ff(s.cp1y,e.top,e.bottom)),a&&(s.cp2x=Ff(s.cp2x,e.left,e.right),s.cp2y=Ff(s.cp2y,e.top,e.bottom)))}(t,n)}function jf(){return"undefined"!=typeof window&&"undefined"!=typeof document}function Bf(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function zf(t,e,n){let i;return"string"==typeof t?(i=parseInt(t,10),-1!==t.indexOf("%")&&(i=i/100*e.parentNode[n])):i=t,i}const Wf=t=>window.getComputedStyle(t,null),Vf=["top","right","bottom","left"];function Hf(t,e,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const r=Vf[s];i[r]=parseFloat(t[e+"-"+r+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function qf(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:i}=e,s=Wf(n),r="border-box"===s.boxSizing,o=Hf(s,"padding"),a=Hf(s,"border","width"),{x:l,y:c,box:h}=function(t,e){const n=t.touches,i=n&&n.length?n[0]:t,{offsetX:s,offsetY:r}=i;let o,a,l=!1;if(((t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot))(s,r,t.target))o=s,a=r;else{const t=e.getBoundingClientRect();o=i.clientX-t.left,a=i.clientY-t.top,l=!0}return{x:o,y:a,box:l}}(t,n),u=o.left+(h&&a.left),d=o.top+(h&&a.top);let{width:p,height:f}=e;return r&&(p-=o.width+a.width,f-=o.height+a.height),{x:Math.round((l-u)/p*n.width/i),y:Math.round((c-d)/f*n.height/i)}}const $f=t=>Math.round(10*t)/10;function Kf(t,e,n){const i=e||1,s=Math.floor(t.height*i),r=Math.floor(t.width*i);t.height=s/i,t.width=r/i;const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==i||o.height!==s||o.width!==r)&&(t.currentDevicePixelRatio=i,o.height=s,o.width=r,t.ctx.setTransform(i,0,0,i,0,0),!0)}const Yf=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function Gf(t,e){const n=function(t,e){return Wf(t).getPropertyValue(e)}(t,e),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Xf(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function Jf(t,e,n,i){return{x:t.x+n*(e.x-t.x),y:"middle"===i?n<.5?t.y:e.y:"after"===i?n<1?t.y:e.y:n>0?e.y:t.y}}function Qf(t,e,n,i){const s={x:t.cp2x,y:t.cp2y},r={x:e.cp1x,y:e.cp1y},o=Xf(t,s,n),a=Xf(s,r,n),l=Xf(r,e,n),c=Xf(o,a,n),h=Xf(a,l,n);return Xf(c,h,n)}const Zf=new Map;function tg(t,e,n){return function(t,e){e=e||{};const n=t+JSON.stringify(e);let i=Zf.get(n);return i||(i=new Intl.NumberFormat(t,e),Zf.set(n,i)),i}(e,n).format(t)}function eg(t,e,n){return t?function(t,e){return{x:n=>t+t+e-n,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,n):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function ng(t,e){let n,i;"ltr"!==e&&"rtl"!==e||(n=t.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=i)}function ig(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function sg(t){return"angle"===t?{between:Hd,compare:Wd,normalize:Vd}:{between:$d,compare:(t,e)=>t-e,normalize:t=>t}}function rg({start:t,end:e,count:n,loop:i,style:s}){return{start:t%n,end:e%n,loop:i&&(e-t+1)%n==0,style:s}}function og(t,e,n){if(!n)return[t];const{property:i,start:s,end:r}=n,o=e.length,{compare:a,between:l,normalize:c}=sg(i),{start:h,end:u,loop:d,style:p}=function(t,e,n){const{property:i,start:s,end:r}=n,{between:o,normalize:a}=sg(i),l=e.length;let c,h,{start:u,end:d,loop:p}=t;if(p){for(u+=l,d+=l,c=0,h=l;c<h&&o(a(e[u%l][i]),s,r);++c)u--,d--;u%=l,d%=l}return d<u&&(d+=l),{start:u,end:d,loop:p,style:t.style}}(t,e,n),f=[];let g,m,_,y=!1,v=null;for(let t=h,n=h;t<=u;++t)m=e[t%o],m.skip||(g=c(m[i]),g!==_&&(y=l(g,s,r),null===v&&(y||l(s,_,g)&&0!==a(s,_))&&(v=0===a(g,s)?t:n),null!==v&&(!y||0===a(r,g)||l(r,_,g))&&(f.push(rg({start:v,end:t,loop:d,count:o,style:p})),v=null),n=t,_=g));return null!==v&&f.push(rg({start:v,end:u,loop:d,count:o,style:p})),f}function ag(t,e){const n=[],i=t.segments;for(let s=0;s<i.length;s++){const r=og(i[s],t.points,e);r.length&&n.push(...r)}return n}function lg(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function cg(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var hg=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,n,i){const s=e.listeners[i],r=e.duration;s.forEach((i=>i({chart:t,initial:e.initial,numSteps:r,currentStep:Math.min(n-e.start,r)})))}_refresh(){this._request||(this._running=!0,this._request=Zd.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((n,i)=>{if(!n.running||!n.items.length)return;const s=n.items;let r,o=s.length-1,a=!1;for(;o>=0;--o)r=s[o],r._active?(r._total>n.duration&&(n.duration=r._total),r.tick(t),a=!0):(s[o]=s[s.length-1],s.pop());a&&(i.draw(),this._notify(i,n,t,"progress")),s.length||(n.running=!1,this._notify(i,n,t,"complete"),n.initial=!1),e+=s.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let n=e.get(t);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,n)),n}listen(t,e,n){this._getAnims(t).listeners[e].push(n)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const n=e.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};const ug="transparent",dg={boolean:(t,e,n)=>n>.5?e:t,color(t,e,n){const i=zp(t||ug),s=i.valid&&zp(e||ug);return s&&s.valid?s.mix(i,n).hexString():e},number:(t,e,n)=>t+(e-t)*n};class pg{constructor(t,e,n,i){const s=e[n];i=_f([t.to,i,s,t.from]);const r=_f([t.from,s,i]);this._active=!0,this._fn=t.fn||dg[t.type||typeof r],this._easing=lp[t.easing]||lp.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=n,this._from=r,this._to=i,this._promises=void 0}active(){return this._active}update(t,e,n){if(this._active){this._notify(!1);const i=this._target[this._prop],s=n-this._start,r=this._duration-s;this._start=n,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=_f([t.to,e,i,t.from]),this._from=_f([t.from,i,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,n=this._duration,i=this._prop,s=this._from,r=this._loop,o=this._to;let a;if(this._active=s!==o&&(r||e<n),!this._active)return this._target[i]=o,void this._notify(!0);e<0?this._target[i]=s:(a=e/n%2,a=r&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[i]=this._fn(s,o,a))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,n)=>{t.push({res:e,rej:n})}))}_notify(t){const e=t?"res":"rej",n=this._promises||[];for(let t=0;t<n.length;t++)n[t][e]()}}Kp.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const fg=Object.keys(Kp.animation);Kp.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),Kp.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),Kp.describe("animations",{_fallback:"animation"}),Kp.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class gg{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!id(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((n=>{const i=t[n];if(!id(i))return;const s={};for(const t of fg)s[t]=i[t];(nd(i.properties)&&i.properties||[n]).forEach((t=>{t!==n&&e.has(t)||e.set(t,s)}))}))}_animateOptions(t,e){const n=e.options,i=function(t,e){if(!e)return;let n=t.options;if(n)return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n;t.options=e}(t,n);if(!i)return[];const s=this._createAnimations(i,n);return n.$shared&&function(t,e){const n=[],i=Object.keys(e);for(let e=0;e<i.length;e++){const s=t[i[e]];s&&s.active()&&n.push(s.wait())}return Promise.all(n)}(t.options.$animations,n).then((()=>{t.options=n}),(()=>{})),s}_createAnimations(t,e){const n=this._properties,i=[],s=t.$animations||(t.$animations={}),r=Object.keys(e),o=Date.now();let a;for(a=r.length-1;a>=0;--a){const l=r[a];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(t,e));continue}const c=e[l];let h=s[l];const u=n.get(l);if(h){if(u&&h.active()){h.update(u,c,o);continue}h.cancel()}u&&u.duration?(s[l]=h=new pg(u,t,l,c),i.push(h)):t[l]=c}return i}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const n=this._createAnimations(t,e);return n.length?(hg.add(this._chart,n),!0):void 0}}function mg(t,e){const n=t&&t.options||{},i=n.reverse,s=void 0===n.min?e:0,r=void 0===n.max?e:0;return{start:i?r:s,end:i?s:r}}function _g(t,e){const n=[],i=t._getSortedDatasetMetas(e);let s,r;for(s=0,r=i.length;s<r;++s)n.push(i[s].index);return n}function yg(t,e,n,i={}){const s=t.keys,r="single"===i.mode;let o,a,l,c;if(null!==e){for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===n){if(i.all)continue;break}c=t.values[l],sd(c)&&(r||0===e||Od(e)===Od(c))&&(e+=c)}return e}}function vg(t,e){const n=t&&t.options.stacked;return n||void 0===n&&void 0!==e.stack}function bg(t,e,n){const i=t[e]||(t[e]={});return i[n]||(i[n]={})}function wg(t,e,n,i){for(const s of e.getMatchingVisibleMetas(i).reverse()){const e=t[s.index];if(n&&e>0||!n&&e<0)return s.index}return null}function xg(t,e){const{chart:n,_cachedMeta:i}=t,s=n._stacks||(n._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,h=function(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}(r,o,i),u=e.length;let d;for(let t=0;t<u;++t){const n=e[t],{[l]:r,[c]:u}=n;d=(n._stacks||(n._stacks={}))[c]=bg(s,h,r),d[a]=u,d._top=wg(d,o,!0,i.type),d._bottom=wg(d,o,!1,i.type)}}function kg(t,e){const n=t.scales;return Object.keys(n).filter((t=>n[t].axis===e)).shift()}function Ig(t,e){const n=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[i]||void 0===e[i][n])return;delete e[i][n]}}}const Cg=t=>"reset"===t||"none"===t,Tg=(t,e)=>e?t:Object.assign({},t);class Eg{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=vg(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&Ig(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,n=this.getDataset(),i=(t,e,n,i)=>"x"===t?e:"r"===t?i:n,s=e.xAxisID=od(n.xAxisID,kg(t,"x")),r=e.yAxisID=od(n.yAxisID,kg(t,"y")),o=e.rAxisID=od(n.rAxisID,kg(t,"r")),a=e.indexAxis,l=e.iAxisID=i(a,s,r,o),c=e.vAxisID=i(a,r,s,o);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(r),e.rScale=this.getScaleForId(o),e.iScale=this.getScaleForId(l),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Jd(this._data,this),t._stacked&&Ig(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),n=this._data;if(id(e))this._data=function(t){const e=Object.keys(t),n=new Array(e.length);let i,s,r;for(i=0,s=e.length;i<s;++i)r=e[i],n[i]={x:r,y:t[r]};return n}(e);else if(n!==e){if(n){Jd(n,this);const t=this._cachedMeta;Ig(t),t._parsed=[]}e&&Object.isExtensible(e)&&((i=e)._chartjs?i._chartjs.listeners.push(this):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),Xd.forEach((t=>{const e="_onData"+vd(t),n=i[t];Object.defineProperty(i,t,{configurable:!0,enumerable:!1,value(...t){const s=n.apply(this,t);return i._chartjs.listeners.forEach((n=>{"function"==typeof n[e]&&n[e](...t)})),s}})})))),this._syncList=[],this._data=e}var i}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const s=e._stacked;e._stacked=vg(e.vScale,e),e.stack!==n.stack&&(i=!0,Ig(e),e.stack=n.stack),this._resyncElements(t),(i||s!==e._stacked)&&xg(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),n=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:n,_data:i}=this,{iScale:s,_stacked:r}=n,o=s.axis;let a,l,c,h=0===t&&e===i.length||n._sorted,u=t>0&&n._parsed[t-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=nd(i[t])?this.parseArrayData(n,i,t,e):id(i[t])?this.parseObjectData(n,i,t,e):this.parsePrimitiveData(n,i,t,e);const s=()=>null===l[o]||u&&l[o]<u[o];for(a=0;a<e;++a)n._parsed[a+t]=l=c[a],h&&(s()&&(h=!1),u=l);n._sorted=h}r&&xg(this,c)}parsePrimitiveData(t,e,n,i){const{iScale:s,vScale:r}=t,o=s.axis,a=r.axis,l=s.getLabels(),c=s===r,h=new Array(i);let u,d,p;for(u=0,d=i;u<d;++u)p=u+n,h[u]={[o]:c||s.parse(l[p],p),[a]:r.parse(e[p],p)};return h}parseArrayData(t,e,n,i){const{xScale:s,yScale:r}=t,o=new Array(i);let a,l,c,h;for(a=0,l=i;a<l;++a)c=a+n,h=e[c],o[a]={x:s.parse(h[0],c),y:r.parse(h[1],c)};return o}parseObjectData(t,e,n,i){const{xScale:s,yScale:r}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(i);let c,h,u,d;for(c=0,h=i;c<h;++c)u=c+n,d=e[u],l[c]={x:s.parse(yd(d,o),u),y:r.parse(yd(d,a),u)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,n){const i=this.chart,s=this._cachedMeta,r=e[t.axis];return yg({keys:_g(i,!0),values:e._stacks[t.axis]},r,s.index,{mode:n})}updateRangeFromParsed(t,e,n,i){const s=n[e.axis];let r=null===s?NaN:s;const o=i&&n._stacks[e.axis];i&&o&&(i.values=o,r=yg(i,s,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,e){const n=this._cachedMeta,i=n._parsed,s=n._sorted&&t===n.iScale,r=i.length,o=this._getOtherScale(t),a=((t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:_g(n,!0),values:null})(e,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:h}=function(t){const{min:e,max:n,minDefined:i,maxDefined:s}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}(o);let u,d;function p(){d=i[u];const e=d[o.axis];return!sd(d[t.axis])||c>e||h<e}for(u=0;u<r&&(p()||(this.updateRangeFromParsed(l,t,d,a),!s));++u);if(s)for(u=r-1;u>=0;--u)if(!p()){this.updateRangeFromParsed(l,t,d,a);break}return l}getAllParsedValues(t){const e=this._cachedMeta._parsed,n=[];let i,s,r;for(i=0,s=e.length;i<s;++i)r=e[i][t.axis],sd(r)&&n.push(r);return n}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,n=e.iScale,i=e.vScale,s=this.getParsed(t);return{label:n?""+n.getLabelForValue(s[n.axis]):"",value:i?""+i.getLabelForValue(s[i.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,n,i,s;return id(t)?(e=t.top,n=t.right,i=t.bottom,s=t.left):e=n=i=s=t,{top:e,right:n,bottom:i,left:s,disabled:!1===t}}(od(this.options.clip,function(t,e,n){if(!1===n)return!1;const i=mg(t,n),s=mg(e,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,n=this._cachedMeta,i=n.data||[],s=e.chartArea,r=[],o=this._drawStart||0,a=this._drawCount||i.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(t,s,o,a),c=o;c<o+a;++c){const e=i[c];e.hidden||(e.active&&l?r.push(e):e.draw(t,s))}for(c=0;c<r.length;++c)r[c].draw(t,s)}getStyle(t,e){const n=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(t||0,n)}getContext(t,e,n){const i=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];s=e.$context||(e.$context=function(t,e,n){return yf(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),s.parsed=this.getParsed(t),s.raw=i.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=function(t,e){return yf(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=i,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=n,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",n){const i="active"===e,s=this._cachedDataOpts,r=t+"-"+e,o=s[r],a=this.enableOptionSharing&&bd(n);if(o)return Tg(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,t),h=i?[`${t}Hover`,"hover",t,""]:[t,""],u=l.getOptionScopes(this.getDataset(),c),d=Object.keys(Kp.elements[t]),p=l.resolveNamedOptions(u,d,(()=>this.getContext(n,i)),h);return p.$shared&&(p.$shared=a,s[r]=Object.freeze(Tg(p,a))),p}_resolveAnimations(t,e,n){const i=this.chart,s=this._cachedDataOpts,r=`animation-${e}`,o=s[r];if(o)return o;let a;if(!1!==i.options.animation){const i=this.chart.config,s=i.datasetAnimationScopeKeys(this._type,e),r=i.getOptionScopes(this.getDataset(),s);a=i.createResolver(r,this.getContext(t,n,e))}const l=new gg(i,a&&a.animations);return a&&a._cacheable&&(s[r]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Cg(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const n=this.resolveDataElementOptions(t,e),i=this._sharedOptions,s=this.getSharedOptions(n),r=this.includeOptions(e,s)||s!==i;return this.updateSharedOptions(s,e,n),{sharedOptions:s,includeOptions:r}}updateElement(t,e,n,i){Cg(i)?Object.assign(t,n):this._resolveAnimations(e,i).update(t,n)}updateSharedOptions(t,e,n){t&&!Cg(e)&&this._resolveAnimations(void 0,e).update(t,n)}_setStyle(t,e,n,i){t.active=i;const s=this.getStyle(e,i);this._resolveAnimations(e,n,i).update(t,{options:!i&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,n){this._setStyle(t,n,"active",!1)}setHoverStyle(t,e,n){this._setStyle(t,n,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,n=this._cachedMeta.data;for(const[t,e,n]of this._syncList)this[t](e,n);this._syncList=[];const i=n.length,s=e.length,r=Math.min(s,i);r&&this.parse(0,r),s>i?this._insertElements(i,s-i,t):s<i&&this._removeElements(s,i-s)}_insertElements(t,e,n=!0){const i=this._cachedMeta,s=i.data,r=t+e;let o;const a=t=>{for(t.length+=e,o=t.length-1;o>=r;o--)t[o]=t[o-e]};for(a(s),o=t;o<r;++o)s[o]=new this.dataElementType;this._parsing&&a(i._parsed),this.parse(t,e),n&&this.updateElements(s,t,e,"reset")}updateElements(t,e,n,i){}_removeElements(t,e){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(t,e);n._stacked&&Ig(n,i)}n.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,n,i]=t;this[e](n,i)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const n=arguments.length-2;n&&this._sync(["_insertElements",t,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Sg(t){const e=t.iScale,n=function(t,e){if(!t._cache.$bar){const n=t.getMatchingVisibleMetas(e);let i=[];for(let e=0,s=n.length;e<s;e++)i=i.concat(n[e].controller.getAllParsedValues(t));t._cache.$bar=Qd(i.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let i,s,r,o,a=e._length;const l=()=>{32767!==r&&-32768!==r&&(bd(o)&&(a=Math.min(a,Math.abs(r-o)||a)),o=r)};for(i=0,s=n.length;i<s;++i)r=e.getPixelForValue(n[i]),l();for(o=void 0,i=0,s=e.ticks.length;i<s;++i)r=e.getPixelForTick(i),l();return a}function Pg(t,e,n,i){return nd(t)?function(t,e,n,i){const s=n.parse(t[0],i),r=n.parse(t[1],i),o=Math.min(s,r),a=Math.max(s,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),e[n.axis]=c,e._custom={barStart:l,barEnd:c,start:s,end:r,min:o,max:a}}(t,e,n,i):e[n.axis]=n.parse(t,i),e}function Rg(t,e,n,i){const s=t.iScale,r=t.vScale,o=s.getLabels(),a=s===r,l=[];let c,h,u,d;for(c=n,h=n+i;c<h;++c)d=e[c],u={},u[s.axis]=a||s.parse(o[c],c),l.push(Pg(d,u,r,c));return l}function Mg(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function Og(t,e,n,i){let s=e.borderSkipped;const r={};if(!s)return void(t.borderSkipped=r);if(!0===s)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:l,top:c,bottom:h}=function(t){let e,n,i,s,r;return t.horizontal?(e=t.base>t.x,n="left",i="right"):(e=t.base<t.y,n="bottom",i="top"),e?(s="end",r="start"):(s="start",r="end"),{start:n,end:i,reverse:e,top:s,bottom:r}}(t);"middle"===s&&n&&(t.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=h:(r[Dg(h,o,a,l)]=!0,s=c)),r[Dg(s,o,a,l)]=!0,t.borderSkipped=r}function Dg(t,e,n,i){var s,r,o;return i?(o=n,t=Ng(t=(s=t)===(r=e)?o:s===o?r:s,n,e)):t=Ng(t,e,n),t}function Ng(t,e,n){return"start"===t?e:"end"===t?n:t}function Ag(t,{inflateAmount:e},n){t.inflateAmount="auto"===e?1===n?.33:0:e}Eg.defaults={},Eg.prototype.datasetElementType=null,Eg.prototype.dataElementType=null;class Lg extends Eg{parsePrimitiveData(t,e,n,i){return Rg(t,e,n,i)}parseArrayData(t,e,n,i){return Rg(t,e,n,i)}parseObjectData(t,e,n,i){const{iScale:s,vScale:r}=t,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===s.axis?o:a,c="x"===r.axis?o:a,h=[];let u,d,p,f;for(u=n,d=n+i;u<d;++u)f=e[u],p={},p[s.axis]=s.parse(yd(f,l),u),h.push(Pg(yd(f,c),p,r,u));return h}updateRangeFromParsed(t,e,n,i){super.updateRangeFromParsed(t,e,n,i);const s=n._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:n,vScale:i}=e,s=this.getParsed(t),r=s._custom,o=Mg(r)?"["+r.start+", "+r.end+"]":""+i.getLabelForValue(s[i.axis]);return{label:""+n.getLabelForValue(s[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,n,i){const s="reset"===i,{index:r,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,i);for(let d=e;d<e+n;d++){const e=this.getParsed(d),n=s||ed(e[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(d),p=this._calculateBarIndexPixels(d,c),f=(e._stacks||{})[o.axis],g={horizontal:l,base:n.base,enableBorderRadius:!f||Mg(e._custom)||r===f._top||r===f._bottom,x:l?n.head:p.center,y:l?p.center:n.head,height:l?p.size:Math.abs(n.size),width:l?Math.abs(n.size):p.size};u&&(g.options=h||this.resolveDataElementOptions(d,t[d].active?"active":i));const m=g.options||t[d].options;Og(g,m,f,r),Ag(g,m,c.ratio),this.updateElement(t[d],d,g,i)}}_getStacks(t,e){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),s=n.options.stacked,r=[],o=t=>{const n=t.controller.getParsed(e),i=n&&n[t.vScale.axis];if(ed(i)||isNaN(i))return!0};for(const n of i)if((void 0===e||!o(n))&&((!1===s||-1===r.indexOf(n.stack)||void 0===s&&void 0===n.stack)&&r.push(n.stack),n.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,n){const i=this._getStacks(t,n),s=void 0!==e?i.indexOf(e):-1;return-1===s?i.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,n=e.iScale,i=[];let s,r;for(s=0,r=e.data.length;s<r;++s)i.push(n.getPixelForValue(this.getParsed(s)[n.axis],s));const o=t.barThickness;return{min:o||Sg(e),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:t.grouped,ratio:o?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:n},options:{base:i,minBarLength:s}}=this,r=i||0,o=this.getParsed(t),a=o._custom,l=Mg(a);let c,h,u=o[e.axis],d=0,p=n?this.applyStack(e,o,n):u;p!==u&&(d=p-u,p=u),l&&(u=a.barStart,p=a.barEnd-a.barStart,0!==u&&Od(u)!==Od(a.barEnd)&&(d=0),d+=u);const f=ed(i)||l?d:i;let g=e.getPixelForValue(f);if(c=this.chart.getDataVisibility(t)?e.getPixelForValue(d+p):g,h=c-g,Math.abs(h)<s){h=function(t,e,n){return 0!==t?Od(t):(e.isHorizontal()?1:-1)*(e.min>=n?1:-1)}(h,e,r)*s,u===r&&(g-=h/2);const t=e.getPixelForDecimal(0),n=e.getPixelForDecimal(1),i=Math.min(t,n),o=Math.max(t,n);g=Math.max(Math.min(g,o),i),c=g+h}if(g===e.getPixelForValue(r)){const t=Od(h)*e.getLineWidthForValue(r)/2;g+=t,h-=t}return{size:h,base:g,head:c,center:c+h/2}}_calculateBarIndexPixels(t,e){const n=e.scale,i=this.options,s=i.skipNull,r=od(i.maxBarThickness,1/0);let o,a;if(e.grouped){const n=s?this._getStackCount(t):e.stackCount,l="flex"===i.barThickness?function(t,e,n,i){const s=e.pixels,r=s[t];let o=t>0?s[t-1]:null,a=t<s.length-1?s[t+1]:null;const l=n.categoryPercentage;null===o&&(o=r-(null===a?e.end-e.start:a-r)),null===a&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:n.barPercentage,start:c}}(t,e,i,n):function(t,e,n,i){const s=n.barThickness;let r,o;return ed(s)?(r=e.min*n.categoryPercentage,o=n.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:e.pixels[t]-r/2}}(t,e,i,n),c=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0);o=l.start+l.chunk*c+l.chunk/2,a=Math.min(r,l.chunk*l.ratio)}else o=n.getPixelForValue(this.getParsed(t)[n.axis],t),a=Math.min(r,e.min*e.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const t=this._cachedMeta,e=t.vScale,n=t.data,i=n.length;let s=0;for(;s<i;++s)null!==this.getParsed(s)[e.axis]&&n[s].draw(this._ctx)}}Lg.id="bar",Lg.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},Lg.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Fg extends Eg{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,n,i){const s=super.parsePrimitiveData(t,e,n,i);for(let t=0;t<s.length;t++)s[t]._custom=this.resolveDataElementOptions(t+n).radius;return s}parseArrayData(t,e,n,i){const s=super.parseArrayData(t,e,n,i);for(let t=0;t<s.length;t++){const i=e[n+t];s[t]._custom=od(i[2],this.resolveDataElementOptions(t+n).radius)}return s}parseObjectData(t,e,n,i){const s=super.parseObjectData(t,e,n,i);for(let t=0;t<s.length;t++){const i=e[n+t];s[t]._custom=od(i&&i.r&&+i.r,this.resolveDataElementOptions(t+n).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:n,yScale:i}=e,s=this.getParsed(t),r=n.getLabelForValue(s.x),o=i.getLabelForValue(s.y),a=s._custom;return{label:e.label,value:"("+r+", "+o+(a?", "+a:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,n,i){const s="reset"===i,{iScale:r,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(e,i),c=r.axis,h=o.axis;for(let u=e;u<e+n;u++){const e=t[u],n=!s&&this.getParsed(u),d={},p=d[c]=s?r.getPixelForDecimal(.5):r.getPixelForValue(n[c]),f=d[h]=s?o.getBasePixel():o.getPixelForValue(n[h]);d.skip=isNaN(p)||isNaN(f),l&&(d.options=a||this.resolveDataElementOptions(u,e.active?"active":i),s&&(d.options.radius=0)),this.updateElement(e,u,d,i)}}resolveDataElementOptions(t,e){const n=this.getParsed(t);let i=super.resolveDataElementOptions(t,e);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const s=i.radius;return"active"!==e&&(i.radius=0),i.radius+=od(n&&n._custom,s),i}}Fg.id="bubble",Fg.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Fg.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class Ug extends Eg{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let s,r,o=t=>+n[t];if(id(n[t])){const{key:t="value"}=this._parsing;o=e=>+yd(n[e],t)}for(s=t,r=t+e;s<r;++s)i._parsed[s]=o(s)}}_getRotation(){return Fd(this.options.rotation-90)}_getCircumference(){return Fd(this.options.circumference)}_getRotationExtents(){let t=Id,e=-Id;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)){const i=this.chart.getDatasetMeta(n).controller,s=i._getRotation(),r=i._getCircumference();t=Math.min(t,s),e=Math.max(e,s+r)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:n}=e,i=this._cachedMeta,s=i.data,r=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-r)/2,0),a=Math.min((c=o,"string"==typeof(l=this.options.cutout)&&l.endsWith("%")?parseFloat(l)/100:l/c),1);var l,c;const h=this._getRingWeight(this.index),{circumference:u,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:f,offsetX:g,offsetY:m}=function(t,e,n){let i=1,s=1,r=0,o=0;if(e<Id){const a=t,l=a+e,c=Math.cos(a),h=Math.sin(a),u=Math.cos(l),d=Math.sin(l),p=(t,e,i)=>Hd(t,a,l,!0)?1:Math.max(e,e*n,i,i*n),f=(t,e,i)=>Hd(t,a,l,!0)?-1:Math.min(e,e*n,i,i*n),g=p(0,c,u),m=p(Sd,h,d),_=f(kd,c,u),y=f(kd+Sd,h,d);i=(g-_)/2,s=(m-y)/2,r=-(g+_)/2,o=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}(d,u,a),_=(n.width-r)/p,y=(n.height-r)/f,v=Math.max(Math.min(_,y)/2,0),b=ad(this.options.radius,v),w=(b-Math.max(b*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=g*b,this.offsetY=m*b,i.total=this.calculateTotal(),this.outerRadius=b-w*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-w*h,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const n=this.options,i=this._cachedMeta,s=this._getCircumference();return e&&n.animation.animateRotate||!this.chart.getDataVisibility(t)||null===i._parsed[t]||i.data[t].hidden?0:this.calculateCircumference(i._parsed[t]*s/Id)}updateElements(t,e,n,i){const s="reset"===i,r=this.chart,o=r.chartArea,a=r.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,h=s&&a.animateScale,u=h?0:this.innerRadius,d=h?0:this.outerRadius,{sharedOptions:p,includeOptions:f}=this._getSharedOptions(e,i);let g,m=this._getRotation();for(g=0;g<e;++g)m+=this._circumference(g,s);for(g=e;g<e+n;++g){const e=this._circumference(g,s),n=t[g],r={x:l+this.offsetX,y:c+this.offsetY,startAngle:m,endAngle:m+e,circumference:e,outerRadius:d,innerRadius:u};f&&(r.options=p||this.resolveDataElementOptions(g,n.active?"active":i)),m+=e,this.updateElement(n,g,r,i)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let n,i=0;for(n=0;n<e.length;n++){const s=t._parsed[n];null===s||isNaN(s)||!this.chart.getDataVisibility(n)||e[n].hidden||(i+=Math.abs(s))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?Id*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],s=tg(e._parsed[t],n.options.locale);return{label:i[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const n=this.chart;let i,s,r,o,a;if(!t)for(i=0,s=n.data.datasets.length;i<s;++i)if(n.isDatasetVisible(i)){r=n.getDatasetMeta(i),t=r.data,o=r.controller;break}if(!t)return 0;for(i=0,s=t.length;i<s;++i)a=o.resolveDataElementOptions(i),"inner"!==a.borderAlign&&(e=Math.max(e,a.borderWidth||0,a.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let n=0,i=t.length;n<i;++n){const t=this.resolveDataElementOptions(n);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let n=0;n<t;++n)this.chart.isDatasetVisible(n)&&(e+=this._getRingWeight(n));return e}_getRingWeight(t){return Math.max(od(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}Ug.id="doughnut",Ug.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},Ug.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},Ug.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,i)=>{const s=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const n=": "+t.formattedValue;return nd(e)?(e=e.slice(),e[0]+=n):e+=n,e}}}}};class jg extends Eg{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:n,data:i=[],_dataset:s}=e,r=this.chart._animationsDisabled;let{start:o,count:a}=ip(e,i,r);this._drawStart=o,this._drawCount=a,sp(e)&&(o=0,a=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!s._decimated,n.points=i;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!r,options:l},t),this.updateElements(i,o,a,t)}updateElements(t,e,n,i){const s="reset"===i,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:h}=this._getSharedOptions(e,i),u=r.axis,d=o.axis,{spanGaps:p,segment:f}=this.options,g=Nd(p)?p:Number.POSITIVE_INFINITY,m=this.chart._animationsDisabled||s||"none"===i;let _=e>0&&this.getParsed(e-1);for(let p=e;p<e+n;++p){const e=t[p],n=this.getParsed(p),y=m?e:{},v=ed(n[d]),b=y[u]=r.getPixelForValue(n[u],p),w=y[d]=s||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[d],p);y.skip=isNaN(b)||isNaN(w)||v,y.stop=p>0&&Math.abs(n[u]-_[u])>g,f&&(y.parsed=n,y.raw=l.data[p]),h&&(y.options=c||this.resolveDataElementOptions(p,e.active?"active":i)),m||this.updateElement(e,p,y,i),_=n}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,n=e.options&&e.options.borderWidth||0,i=t.data||[];if(!i.length)return n;const s=i[0].size(this.resolveDataElementOptions(0)),r=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,s,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}jg.id="line",jg.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},jg.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class Bg extends Eg{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,n=this.chart,i=n.data.labels||[],s=tg(e._parsed[t].r,n.options.locale);return{label:i[t]||"",value:s}}parseObjectData(t,e,n,i){return Of.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<e.min&&(e.min=i),i>e.max&&(e.max=i))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,n=t.options,i=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(i/2,0),r=(s-Math.max(n.cutoutPercentage?s/100*n.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,n,i){const s="reset"===i,r=this.chart,o=r.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,h=a.getIndexAngle(0)-.5*kd;let u,d=h;const p=360/this.countVisibleElements();for(u=0;u<e;++u)d+=this._computeAngle(u,i,p);for(u=e;u<e+n;u++){const e=t[u];let n=d,f=d+this._computeAngle(u,i,p),g=r.getDataVisibility(u)?a.getDistanceFromCenterForValue(this.getParsed(u).r):0;d=f,s&&(o.animateScale&&(g=0),o.animateRotate&&(n=f=h));const m={x:l,y:c,innerRadius:0,outerRadius:g,startAngle:n,endAngle:f,options:this.resolveDataElementOptions(u,e.active?"active":i)};this.updateElement(e,u,m,i)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++})),e}_computeAngle(t,e,n){return this.chart.getDataVisibility(t)?Fd(this.resolveDataElementOptions(t,e).angle||n):0}}Bg.id="polarArea",Bg.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},Bg.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:n}}=t.legend.options;return e.labels.map(((e,i)=>{const s=t.getDatasetMeta(0).controller.getStyle(i);return{text:e,fillStyle:s.backgroundColor,strokeStyle:s.borderColor,lineWidth:s.borderWidth,pointStyle:n,hidden:!t.getDataVisibility(i),index:i}}))}return[]}},onClick(t,e,n){n.chart.toggleDataVisibility(e.index),n.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class zg extends Ug{}zg.id="pie",zg.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Wg extends Eg{getLabelAndValue(t){const e=this._cachedMeta.vScale,n=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(n[e.axis])}}parseObjectData(t,e,n,i){return Of.bind(this)(t,e,n,i)}update(t){const e=this._cachedMeta,n=e.dataset,i=e.data||[],s=e.iScale.getLabels();if(n.points=i,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===i.length,options:e};this.updateElement(n,void 0,r,t)}this.updateElements(i,0,i.length,t)}updateElements(t,e,n,i){const s=this._cachedMeta.rScale,r="reset"===i;for(let o=e;o<e+n;o++){const e=t[o],n=this.resolveDataElementOptions(o,e.active?"active":i),a=s.getPointPositionForValue(o,this.getParsed(o).r),l=r?s.xCenter:a.x,c=r?s.yCenter:a.y,h={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(e,o,h,i)}}}Wg.id="radar",Wg.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},Wg.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class Vg{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}hasValue(){return Nd(this.x)&&Nd(this.y)}getProps(t,e){const n=this.$animations;if(!e||!n)return this;const i={};return t.forEach((t=>{i[t]=n[t]&&n[t].active()?n[t]._to:this[t]})),i}}Vg.defaults={},Vg.defaultRoutes=void 0;const Hg={values:t=>nd(t)?t:""+t,numeric(t,e,n){if(0===t)return"0";const i=this.chart.options.locale;let s,r=t;if(n.length>1){const e=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(e<1e-4||e>1e15)&&(s="scientific"),r=function(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}(t,n)}const o=Md(Math.abs(r)),a=Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),tg(t,i,l)},logarithmic(t,e,n){if(0===t)return"0";const i=t/Math.pow(10,Math.floor(Md(t)));return 1===i||2===i||5===i?Hg.numeric.call(this,t,e,n):""}};var qg={formatters:Hg};function $g(t,e,n,i,s){const r=od(i,0),o=Math.min(od(s,t.length),t.length);let a,l,c,h=0;for(n=Math.ceil(n),s&&(a=s-i,n=a/Math.floor(a/n)),c=r;c<0;)h++,c=Math.round(r+h*n);for(l=Math.max(r,0);l<o;l++)l===c&&(e.push(t[l]),h++,c=Math.round(r+h*n))}Kp.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:qg.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),Kp.route("scale.ticks","color","","color"),Kp.route("scale.grid","color","","borderColor"),Kp.route("scale.grid","borderColor","","borderColor"),Kp.route("scale.title","color","","color"),Kp.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),Kp.describe("scales",{_fallback:"scale"}),Kp.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const Kg=(t,e,n)=>"top"===e||"left"===e?t[e]+n:t[e]-n;function Yg(t,e){const n=[],i=t.length/e,s=t.length;let r=0;for(;r<s;r+=i)n.push(t[Math.floor(r)]);return n}function Gg(t,e,n){const i=t.ticks.length,s=Math.min(e,i-1),r=t._startPixel,o=t._endPixel,a=1e-6;let l,c=t.getPixelForTick(s);if(!(n&&(l=1===i?Math.max(c-r,o-c):0===e?(t.getPixelForTick(1)-c)/2:(c-t.getPixelForTick(s-1))/2,c+=s<e?l:-l,c<r-a||c>o+a)))return c}function Xg(t){return t.drawTicks?t.tickLength:0}function Jg(t,e){if(!t.display)return 0;const n=mf(t.font,e),i=gf(t.padding);return(nd(t.text)?t.text.length:1)*n.lineHeight+i.height}function Qg(t,e,n){let i=ep(t);return(n&&"right"!==e||!n&&"right"===e)&&(i=(t=>"left"===t?"right":"right"===t?"left":t)(i)),i}class Zg extends Vg{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:n,_suggestedMax:i}=this;return t=rd(t,Number.POSITIVE_INFINITY),e=rd(e,Number.NEGATIVE_INFINITY),n=rd(n,Number.POSITIVE_INFINITY),i=rd(i,Number.NEGATIVE_INFINITY),{min:rd(t,n),max:rd(e,i),minDefined:sd(t),maxDefined:sd(e)}}getMinMax(t){let e,{min:n,max:i,minDefined:s,maxDefined:r}=this.getUserBounds();if(s&&r)return{min:n,max:i};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)e=o[a].controller.getMinMax(this,t),s||(n=Math.min(n,e.min)),r||(i=Math.max(i,e.max));return n=r&&n>i?i:n,i=s&&n>i?n:i,{min:rd(n,rd(i,n)),max:rd(i,rd(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ld(this.options.beforeUpdate,[this])}update(t,e,n){const{beginAtZero:i,grace:s,ticks:r}=this.options,o=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(t,e,n){const{min:i,max:s}=t,r=ad(e,(s-i)/2),o=(t,e)=>n&&0===t?0:t+e;return{min:o(i,-Math.abs(r)),max:o(s,r)}}(this,s,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?Yg(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||"auto"===r.source)&&(this.ticks=function(t,e){const n=t.options.ticks,i=n.maxTicksLimit||function(t){const e=t.options.offset,n=t._tickSize(),i=t._length/n+(e?0:1),s=t._maxLength/n;return Math.floor(Math.min(i,s))}(t),s=n.major.enabled?function(t){const e=[];let n,i;for(n=0,i=t.length;n<i;n++)t[n].major&&e.push(n);return e}(e):[],r=s.length,o=s[0],a=s[r-1],l=[];if(r>i)return function(t,e,n,i){let s,r=0,o=n[0];for(i=Math.ceil(i),s=0;s<t.length;s++)s===o&&(e.push(t[s]),r++,o=n[r*i])}(e,l,s,r/i),l;const c=function(t,e,n){const i=function(t){const e=t.length;let n,i;if(e<2)return!1;for(i=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==i)return!1;return i}(t),s=e.length/n;if(!i)return Math.max(s,1);const r=function(t){const e=[],n=Math.sqrt(t);let i;for(i=1;i<n;i++)t%i==0&&(e.push(i),e.push(t/i));return n===(0|n)&&e.push(n),e.sort(((t,e)=>t-e)).pop(),e}(i);for(let t=0,e=r.length-1;t<e;t++){const e=r[t];if(e>s)return e}return Math.max(s,1)}(s,e,i);if(r>0){let t,n;const i=r>1?Math.round((a-o)/(r-1)):null;for($g(e,l,c,ed(i)?0:o-i,o),t=0,n=r-1;t<n;t++)$g(e,l,c,s[t],s[t+1]);return $g(e,l,c,a,ed(i)?e.length:a+i),l}return $g(e,l,c),l}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,n=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,n=!n),this._startPixel=t,this._endPixel=e,this._reversePixels=n,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ld(this.options.afterUpdate,[this])}beforeSetDimensions(){ld(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ld(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),ld(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ld(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let n,i,s;for(n=0,i=t.length;n<i;n++)s=t[n],s.label=ld(e.callback,[s.value,n,t],this)}afterTickToLabelConversion(){ld(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ld(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,n=this.ticks.length,i=e.minRotation||0,s=e.maxRotation;let r,o,a,l=i;if(!this._isVisible()||!e.display||i>=s||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),h=c.widest.width,u=c.highest.height,d=qd(this.chart.width-h,0,this.maxWidth);r=t.offset?this.maxWidth/n:d/(n-1),h+6>r&&(r=d/(n-(t.offset?.5:1)),o=this.maxHeight-Xg(t.grid)-e.padding-Jg(t.title,this.chart.options.font),a=Math.sqrt(h*h+u*u),l=Ud(Math.min(Math.asin(qd((c.highest.height+6)/r,-1,1)),Math.asin(qd(o/a,-1,1))-Math.asin(qd(u/a,-1,1)))),l=Math.max(i,Math.min(s,l))),this.labelRotation=l}afterCalculateLabelRotation(){ld(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ld(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:n,title:i,grid:s}}=this,r=this._isVisible(),o=this.isHorizontal();if(r){const r=Jg(i,e.options.font);if(o?(t.width=this.maxWidth,t.height=Xg(s)+r):(t.height=this.maxHeight,t.width=Xg(s)+r),n.display&&this.ticks.length){const{first:e,last:i,widest:s,highest:r}=this._getLabelSizes(),a=2*n.padding,l=Fd(this.labelRotation),c=Math.cos(l),h=Math.sin(l);if(o){const e=n.mirror?0:h*s.width+c*r.height;t.height=Math.min(this.maxHeight,t.height+e+a)}else{const e=n.mirror?0:c*s.width+h*r.height;t.width=Math.min(this.maxWidth,t.width+e+a)}this._calculatePadding(e,i,h,c)}}this._handleMargins(),o?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,n,i){const{ticks:{align:s,padding:r},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,u=0;a?l?(h=i*t.width,u=n*e.height):(h=n*t.height,u=i*e.width):"start"===s?u=e.width:"end"===s?h=t.width:"inner"!==s&&(h=t.width/2,u=e.width/2),this.paddingLeft=Math.max((h-o+r)*this.width/(this.width-o),0),this.paddingRight=Math.max((u-c+r)*this.width/(this.width-c),0)}else{let n=e.height/2,i=t.height/2;"start"===s?(n=0,i=t.height):"end"===s&&(n=e.height,i=0),this.paddingTop=n+r,this.paddingBottom=i+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ld(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,n=t.length;e<n;e++)ed(t[e].label)&&(t.splice(e,1),n--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let n=this.ticks;e<n.length&&(n=Yg(n,e)),this._labelSizes=t=this._computeLabelSizes(n,n.length)}return t}_computeLabelSizes(t,e){const{ctx:n,_longestTextCache:i}=this,s=[],r=[];let o,a,l,c,h,u,d,p,f,g,m,_=0,y=0;for(o=0;o<e;++o){if(c=t[o].label,h=this._resolveTickFontOptions(o),n.font=u=h.string,d=i[u]=i[u]||{data:{},gc:[]},p=h.lineHeight,f=g=0,ed(c)||nd(c)){if(nd(c))for(a=0,l=c.length;a<l;++a)m=c[a],ed(m)||nd(m)||(f=Yp(n,d.data,d.gc,f,m),g+=p)}else f=Yp(n,d.data,d.gc,f,c),g=p;s.push(f),r.push(g),_=Math.max(f,_),y=Math.max(g,y)}!function(t,e){cd(t,(t=>{const n=t.gc,i=n.length/2;let s;if(i>e){for(s=0;s<i;++s)delete t.data[n[s]];n.splice(0,i)}}))}(i,e);const v=s.indexOf(_),b=r.indexOf(y),w=t=>({width:s[t]||0,height:r[t]||0});return{first:w(0),last:w(e-1),widest:w(v),highest:w(b),widths:s,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return qd(this._alignToPixels?Xp(this.chart,e,0):e,-32768,32767)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const n=e[t];return n.$context||(n.$context=function(t,e,n){return yf(t,{tick:n,index:e,type:"tick"})}(this.getContext(),t,n))}return this.$context||(this.$context=yf(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=Fd(this.labelRotation),n=Math.abs(Math.cos(e)),i=Math.abs(Math.sin(e)),s=this._getLabelSizes(),r=t.autoSkipPadding||0,o=s?s.widest.width+r:0,a=s?s.highest.height+r:0;return this.isHorizontal()?a*n>o*i?o/n:a/i:a*i<o*n?a/n:o/i}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,n=this.chart,i=this.options,{grid:s,position:r}=i,o=s.offset,a=this.isHorizontal(),l=this.ticks.length+(o?1:0),c=Xg(s),h=[],u=s.setContext(this.getContext()),d=u.drawBorder?u.borderWidth:0,p=d/2,f=function(t){return Xp(n,t,d)};let g,m,_,y,v,b,w,x,k,I,C,T;if("top"===r)g=f(this.bottom),b=this.bottom-c,x=g-p,I=f(t.top)+p,T=t.bottom;else if("bottom"===r)g=f(this.top),I=t.top,T=f(t.bottom)-p,b=g+p,x=this.top+c;else if("left"===r)g=f(this.right),v=this.right-c,w=g-p,k=f(t.left)+p,C=t.right;else if("right"===r)g=f(this.left),k=t.left,C=f(t.right)-p,v=g+p,w=this.left+c;else if("x"===e){if("center"===r)g=f((t.top+t.bottom)/2+.5);else if(id(r)){const t=Object.keys(r)[0],e=r[t];g=f(this.chart.scales[t].getPixelForValue(e))}I=t.top,T=t.bottom,b=g+p,x=b+c}else if("y"===e){if("center"===r)g=f((t.left+t.right)/2);else if(id(r)){const t=Object.keys(r)[0],e=r[t];g=f(this.chart.scales[t].getPixelForValue(e))}v=g-p,w=v-c,k=t.left,C=t.right}const E=od(i.ticks.maxTicksLimit,l),S=Math.max(1,Math.ceil(l/E));for(m=0;m<l;m+=S){const t=s.setContext(this.getContext(m)),e=t.lineWidth,i=t.color,r=t.borderDash||[],l=t.borderDashOffset,c=t.tickWidth,u=t.tickColor,d=t.tickBorderDash||[],p=t.tickBorderDashOffset;_=Gg(this,m,o),void 0!==_&&(y=Xp(n,_,e),a?v=w=k=C=y:b=x=I=T=y,h.push({tx1:v,ty1:b,tx2:w,ty2:x,x1:k,y1:I,x2:C,y2:T,width:e,color:i,borderDash:r,borderDashOffset:l,tickWidth:c,tickColor:u,tickBorderDash:d,tickBorderDashOffset:p}))}return this._ticksLength=l,this._borderValue=g,h}_computeLabelItems(t){const e=this.axis,n=this.options,{position:i,ticks:s}=n,r=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:h}=s,u=Xg(n.grid),d=u+c,p=h?-c:d,f=-Fd(this.labelRotation),g=[];let m,_,y,v,b,w,x,k,I,C,T,E,S="middle";if("top"===i)w=this.bottom-p,x=this._getXAxisLabelAlignment();else if("bottom"===i)w=this.top+p,x=this._getXAxisLabelAlignment();else if("left"===i){const t=this._getYAxisLabelAlignment(u);x=t.textAlign,b=t.x}else if("right"===i){const t=this._getYAxisLabelAlignment(u);x=t.textAlign,b=t.x}else if("x"===e){if("center"===i)w=(t.top+t.bottom)/2+d;else if(id(i)){const t=Object.keys(i)[0],e=i[t];w=this.chart.scales[t].getPixelForValue(e)+d}x=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===i)b=(t.left+t.right)/2-d;else if(id(i)){const t=Object.keys(i)[0],e=i[t];b=this.chart.scales[t].getPixelForValue(e)}x=this._getYAxisLabelAlignment(u).textAlign}"y"===e&&("start"===a?S="top":"end"===a&&(S="bottom"));const P=this._getLabelSizes();for(m=0,_=o.length;m<_;++m){y=o[m],v=y.label;const t=s.setContext(this.getContext(m));k=this.getPixelForTick(m)+s.labelOffset,I=this._resolveTickFontOptions(m),C=I.lineHeight,T=nd(v)?v.length:1;const e=T/2,n=t.color,a=t.textStrokeColor,c=t.textStrokeWidth;let u,d=x;if(r?(b=k,"inner"===x&&(d=m===_-1?this.options.reverse?"left":"right":0===m?this.options.reverse?"right":"left":"center"),E="top"===i?"near"===l||0!==f?-T*C+C/2:"center"===l?-P.highest.height/2-e*C+C:-P.highest.height+C/2:"near"===l||0!==f?C/2:"center"===l?P.highest.height/2-e*C:P.highest.height-T*C,h&&(E*=-1)):(w=k,E=(1-T)*C/2),t.showLabelBackdrop){const e=gf(t.backdropPadding),n=P.heights[m],i=P.widths[m];let s=w+E-e.top,r=b-e.left;switch(S){case"middle":s-=n/2;break;case"bottom":s-=n}switch(x){case"center":r-=i/2;break;case"right":r-=i}u={left:r,top:s,width:i+e.width,height:n+e.height,color:t.backdropColor}}g.push({rotation:f,label:v,font:I,color:n,strokeColor:a,strokeWidth:c,textOffset:E,textAlign:d,textBaseline:S,translation:[b,w],backdrop:u})}return g}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-Fd(this.labelRotation))return"top"===t?"left":"right";let n="center";return"start"===e.align?n="left":"end"===e.align?n="right":"inner"===e.align&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:n,mirror:i,padding:s}}=this.options,r=t+s,o=this._getLabelSizes().widest.width;let a,l;return"left"===e?i?(l=this.right+s,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-r,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l=this.left)):"right"===e?i?(l=this.left+s,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+r,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:n,top:i,width:s,height:r}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(n,i,s,r),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex((e=>e.value===t));return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,r;const o=(t,e,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke(),n.restore())};if(e.display)for(s=0,r=i.length;s<r;++s){const t=i[s];e.drawOnChartArea&&o({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&o({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:n}}=this,i=n.setContext(this.getContext()),s=n.drawBorder?i.borderWidth:0;if(!s)return;const r=n.setContext(this.getContext(0)).lineWidth,o=this._borderValue;let a,l,c,h;this.isHorizontal()?(a=Xp(t,this.left,s)-s/2,l=Xp(t,this.right,r)+r/2,c=h=o):(c=Xp(t,this.top,s)-s/2,h=Xp(t,this.bottom,r)+r/2,a=l=o),e.save(),e.lineWidth=i.borderWidth,e.strokeStyle=i.borderColor,e.beginPath(),e.moveTo(a,c),e.lineTo(l,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,n=this._computeLabelArea();n&&ef(e,n);const i=this._labelItems||(this._labelItems=this._computeLabelItems(t));let s,r;for(s=0,r=i.length;s<r;++s){const t=i[s],n=t.font,r=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),of(e,r,0,t.textOffset,n,t)}n&&nf(e)}drawTitle(){const{ctx:t,options:{position:e,title:n,reverse:i}}=this;if(!n.display)return;const s=mf(n.font),r=gf(n.padding),o=n.align;let a=s.lineHeight/2;"bottom"===e||"center"===e||id(e)?(a+=r.bottom,nd(n.text)&&(a+=s.lineHeight*(n.text.length-1))):a+=r.top;const{titleX:l,titleY:c,maxWidth:h,rotation:u}=function(t,e,n,i){const{top:s,left:r,bottom:o,right:a,chart:l}=t,{chartArea:c,scales:h}=l;let u,d,p,f=0;const g=o-s,m=a-r;if(t.isHorizontal()){if(d=np(i,r,a),id(n)){const t=Object.keys(n)[0],i=n[t];p=h[t].getPixelForValue(i)+g-e}else p="center"===n?(c.bottom+c.top)/2+g-e:Kg(t,n,e);u=a-r}else{if(id(n)){const t=Object.keys(n)[0],i=n[t];d=h[t].getPixelForValue(i)-m+e}else d="center"===n?(c.left+c.right)/2-m+e:Kg(t,n,e);p=np(i,o,s),f="left"===n?-Sd:Sd}return{titleX:d,titleY:p,maxWidth:u,rotation:f}}(this,a,e,o);of(t,n.text,0,0,s,{color:n.color,maxWidth:h,rotation:u,textAlign:Qg(o,e,i),textBaseline:"middle",translation:[l,c]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,n=od(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===Zg.prototype.draw?[{z:n,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:n+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let s,r;for(s=0,r=e.length;s<r;++s){const r=e[s];r[n]!==this.id||t&&r.type!==t||i.push(r)}return i}_resolveTickFontOptions(t){return mf(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class tm{constructor(t,e,n){this.type=t,this.scope=e,this.override=n,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let n;(function(t){return"id"in t&&"defaults"in t})(e)&&(n=this.register(e));const i=this.items,s=t.id,r=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in i||(i[s]=t,function(t,e,n){const i=fd(Object.create(null),[n?Kp.get(n):{},Kp.get(e),t.defaults]);Kp.set(e,i),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((n=>{const i=n.split("."),s=i.pop(),r=[t].concat(i).join("."),o=e[n].split("."),a=o.pop(),l=o.join(".");Kp.route(r,s,l,a)}))}(e,t.defaultRoutes),t.descriptors&&Kp.describe(e,t.descriptors)}(t,r,n),this.override&&Kp.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const e=this.items,n=t.id,i=this.scope;n in e&&delete e[n],i&&n in Kp[i]&&(delete Kp[i][n],this.override&&delete Vp[n])}}var em=new class{constructor(){this.controllers=new tm(Eg,"datasets",!0),this.elements=new tm(Vg,"elements"),this.plugins=new tm(Object,"plugins"),this.scales=new tm(Zg,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,n){[...e].forEach((e=>{const i=n||this._getRegistryForType(e);n||i.isForType(e)||i===this.plugins&&e.id?this._exec(t,i,e):cd(e,(e=>{const i=n||this._getRegistryForType(e);this._exec(t,i,e)}))}))}_exec(t,e,n){const i=vd(t);ld(n["before"+i],[],n),e[t](n),ld(n["after"+i],[],n)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const n=this._typedRegistries[e];if(n.isForType(t))return n}return this.plugins}_get(t,e,n){const i=e.get(t);if(void 0===i)throw new Error('"'+t+'" is not a registered '+n+".");return i}};class nm extends Eg{update(t){const e=this._cachedMeta,{data:n=[]}=e,i=this.chart._animationsDisabled;let{start:s,count:r}=ip(e,n,i);if(this._drawStart=s,this._drawCount=r,sp(e)&&(s=0,r=n.length),this.options.showLine){const{dataset:s,_dataset:r}=e;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=n;const o=this.resolveDatasetElementOptions(t);o.segment=this.options.segment,this.updateElement(s,void 0,{animated:!i,options:o},t)}this.updateElements(n,s,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=em.getElement("line")),super.addElements()}updateElements(t,e,n,i){const s="reset"===i,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(e,i),h=this.getSharedOptions(c),u=this.includeOptions(i,h),d=r.axis,p=o.axis,{spanGaps:f,segment:g}=this.options,m=Nd(f)?f:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||s||"none"===i;let y=e>0&&this.getParsed(e-1);for(let c=e;c<e+n;++c){const e=t[c],n=this.getParsed(c),f=_?e:{},v=ed(n[p]),b=f[d]=r.getPixelForValue(n[d],c),w=f[p]=s||v?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[p],c);f.skip=isNaN(b)||isNaN(w)||v,f.stop=c>0&&Math.abs(n[d]-y[d])>m,g&&(f.parsed=n,f.raw=l.data[c]),u&&(f.options=h||this.resolveDataElementOptions(c,e.active?"active":i)),_||this.updateElement(e,c,f,i),y=n}this.updateSharedOptions(h,i,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}const n=t.dataset,i=n.options&&n.options.borderWidth||0;if(!e.length)return i;const s=e[0].size(this.resolveDataElementOptions(0)),r=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(i,s,r)/2}}nm.id="scatter",nm.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},nm.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var im=Object.freeze({__proto__:null,BarController:Lg,BubbleController:Fg,DoughnutController:Ug,LineController:jg,PolarAreaController:Bg,PieController:zg,RadarController:Wg,ScatterController:nm});function sm(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class rm{constructor(t){this.options=t||{}}init(t){}formats(){return sm()}parse(t,e){return sm()}format(t,e){return sm()}add(t,e,n){return sm()}diff(t,e,n){return sm()}startOf(t,e,n){return sm()}endOf(t,e){return sm()}}rm.override=function(t){Object.assign(rm.prototype,t)};var om={_date:rm};function am(t,e,n,i){const{controller:s,data:r,_sorted:o}=t,a=s._cachedMeta.iScale;if(a&&e===a.axis&&"r"!==e&&o&&r.length){const t=a._reversePixels?Gd:Yd;if(!i)return t(r,e,n);if(s._sharedOptions){const i=r[0],s="function"==typeof i.getRange&&i.getRange(e);if(s){const i=t(r,e,n-s),o=t(r,e,n+s);return{lo:i.lo,hi:o.hi}}}}return{lo:0,hi:r.length-1}}function lm(t,e,n,i,s){const r=t.getSortedVisibleDatasetMetas(),o=n[e];for(let t=0,n=r.length;t<n;++t){const{index:n,data:a}=r[t],{lo:l,hi:c}=am(r[t],e,o,s);for(let t=l;t<=c;++t){const e=a[t];e.skip||i(e,n,t)}}}function cm(t,e,n,i,s){const r=[];return s||t.isPointInArea(e)?(lm(t,n,e,(function(n,o,a){(s||tf(n,t.chartArea,0))&&n.inRange(e.x,e.y,i)&&r.push({element:n,datasetIndex:o,index:a})}),!0),r):r}function hm(t,e,n,i,s,r){return r||t.isPointInArea(e)?"r"!==n||i?function(t,e,n,i,s,r){let o=[];const a=function(t){const e=-1!==t.indexOf("x"),n=-1!==t.indexOf("y");return function(t,i){const s=e?Math.abs(t.x-i.x):0,r=n?Math.abs(t.y-i.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(r,2))}}(n);let l=Number.POSITIVE_INFINITY;return lm(t,n,e,(function(n,c,h){const u=n.inRange(e.x,e.y,s);if(i&&!u)return;const d=n.getCenterPoint(s);if(!r&&!t.isPointInArea(d)&&!u)return;const p=a(e,d);p<l?(o=[{element:n,datasetIndex:c,index:h}],l=p):p===l&&o.push({element:n,datasetIndex:c,index:h})})),o}(t,e,n,i,s,r):function(t,e,n,i){let s=[];return lm(t,n,e,(function(t,n,r){const{startAngle:o,endAngle:a}=t.getProps(["startAngle","endAngle"],i),{angle:l}=Bd(t,{x:e.x,y:e.y});Hd(l,o,a)&&s.push({element:t,datasetIndex:n,index:r})})),s}(t,e,n,s):[]}function um(t,e,n,i,s){const r=[],o="x"===n?"inXRange":"inYRange";let a=!1;return lm(t,n,e,((t,i,l)=>{t[o](e[n],s)&&(r.push({element:t,datasetIndex:i,index:l}),a=a||t.inRange(e.x,e.y,s))})),i&&!a?[]:r}var dm={evaluateInteractionItems:lm,modes:{index(t,e,n,i){const s=qf(e,t),r=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?cm(t,s,r,i,o):hm(t,s,r,!1,i,o),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=a[0].index,n=t.data[e];n&&!n.skip&&l.push({element:n,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,n,i){const s=qf(e,t),r=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?cm(t,s,r,i,o):hm(t,s,r,!1,i,o);if(a.length>0){const e=a[0].datasetIndex,n=t.getDatasetMeta(e).data;a=[];for(let t=0;t<n.length;++t)a.push({element:n[t],datasetIndex:e,index:t})}return a},point:(t,e,n,i)=>cm(t,qf(e,t),n.axis||"xy",i,n.includeInvisible||!1),nearest(t,e,n,i){const s=qf(e,t),r=n.axis||"xy",o=n.includeInvisible||!1;return hm(t,s,r,n.intersect,i,o)},x:(t,e,n,i)=>um(t,qf(e,t),"x",n.intersect,i),y:(t,e,n,i)=>um(t,qf(e,t),"y",n.intersect,i)}};const pm=["left","top","right","bottom"];function fm(t,e){return t.filter((t=>t.pos===e))}function gm(t,e){return t.filter((t=>-1===pm.indexOf(t.pos)&&t.box.axis===e))}function mm(t,e){return t.sort(((t,n)=>{const i=e?n:t,s=e?t:n;return i.weight===s.weight?i.index-s.index:i.weight-s.weight}))}function _m(t,e,n,i){return Math.max(t[n],e[n])+Math.max(t[i],e[i])}function ym(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function vm(t,e,n,i){const{pos:s,box:r}=n,o=t.maxPadding;if(!id(s)){n.size&&(t[s]-=n.size);const e=i[n.stack]||{size:0,count:1};e.size=Math.max(e.size,n.horizontal?r.height:r.width),n.size=e.size/e.count,t[s]+=n.size}r.getPadding&&ym(o,r.getPadding());const a=Math.max(0,e.outerWidth-_m(o,t,"left","right")),l=Math.max(0,e.outerHeight-_m(o,t,"top","bottom")),c=a!==t.w,h=l!==t.h;return t.w=a,t.h=l,n.horizontal?{same:c,other:h}:{same:h,other:c}}function bm(t,e){const n=e.maxPadding;return function(t){const i={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{i[t]=Math.max(e[t],n[t])})),i}(t?["left","right"]:["top","bottom"])}function wm(t,e,n,i){const s=[];let r,o,a,l,c,h;for(r=0,o=t.length,c=0;r<o;++r){a=t[r],l=a.box,l.update(a.width||e.w,a.height||e.h,bm(a.horizontal,e));const{same:o,other:u}=vm(e,n,a,i);c|=o&&s.length,h=h||u,l.fullSize||s.push(a)}return c&&wm(s,e,n,i)||h}function xm(t,e,n,i,s){t.top=n,t.left=e,t.right=e+i,t.bottom=n+s,t.width=i,t.height=s}function km(t,e,n,i){const s=n.padding;let{x:r,y:o}=e;for(const a of t){const t=a.box,l=i[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const i=e.w*c,r=l.size||t.height;bd(l.start)&&(o=l.start),t.fullSize?xm(t,s.left,o,n.outerWidth-s.right-s.left,r):xm(t,e.left+l.placed,o,i,r),l.start=o,l.placed+=i,o=t.bottom}else{const i=e.h*c,o=l.size||t.width;bd(l.start)&&(r=l.start),t.fullSize?xm(t,r,s.top,o,n.outerHeight-s.bottom-s.top):xm(t,r,e.top+l.placed,o,i),l.start=r,l.placed+=i,r=t.right}}e.x=r,e.y=o}Kp.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Im={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;-1!==n&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,i){if(!t)return;const s=gf(t.options.layout.padding),r=Math.max(e-s.width,0),o=Math.max(n-s.height,0),a=function(t){const e=function(t){const e=[];let n,i,s,r,o,a;for(n=0,i=(t||[]).length;n<i;++n)s=t[n],({position:r,options:{stack:o,stackWeight:a=1}}=s),e.push({index:n,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return e}(t),n=mm(e.filter((t=>t.box.fullSize)),!0),i=mm(fm(e,"left"),!0),s=mm(fm(e,"right")),r=mm(fm(e,"top"),!0),o=mm(fm(e,"bottom")),a=gm(e,"x"),l=gm(e,"y");return{fullSize:n,leftAndTop:i.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:fm(e,"chartArea"),vertical:i.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}(t.boxes),l=a.vertical,c=a.horizontal;cd(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const h=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,u=Object.freeze({outerWidth:e,outerHeight:n,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),d=Object.assign({},s);ym(d,gf(i));const p=Object.assign({maxPadding:d,w:r,h:o,x:s.left,y:s.top},s),f=function(t,e){const n=function(t){const e={};for(const n of t){const{stack:t,pos:i,stackWeight:s}=n;if(!t||!pm.includes(i))continue;const r=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=s}return e}(t),{vBoxMaxWidth:i,hBoxMaxHeight:s}=e;let r,o,a;for(r=0,o=t.length;r<o;++r){a=t[r];const{fullSize:o}=a.box,l=n[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*i:o&&e.availableWidth,a.height=s):(a.width=i,a.height=c?c*s:o&&e.availableHeight)}return n}(l.concat(c),u);wm(a.fullSize,p,u,f),wm(l,p,u,f),wm(c,p,u,f)&&wm(l,p,u,f),function(t){const e=t.maxPadding;function n(n){const i=Math.max(e[n]-t[n],0);return t[n]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}(p),km(a.leftAndTop,p,u,f),p.x+=p.w,p.y+=p.h,km(a.rightAndBottom,p,u,f),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},cd(a.chartArea,(e=>{const n=e.box;Object.assign(n,t.chartArea),n.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})}))}};class Cm{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,n){}removeEventListener(t,e,n){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,n,i){return e=Math.max(0,e||t.width),n=n||t.height,{width:e,height:Math.max(0,i?Math.floor(e/i):n)}}isAttached(t){return!0}updateConfig(t){}}class Tm extends Cm{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Em="$chartjs",Sm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Pm=t=>null===t||""===t,Rm=!!Yf&&{passive:!0};function Mm(t,e,n){t.canvas.removeEventListener(e,n,Rm)}function Om(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function Dm(t,e,n){const i=t.canvas,s=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Om(n.addedNodes,i),e=e&&!Om(n.removedNodes,i);e&&n()}));return s.observe(document,{childList:!0,subtree:!0}),s}function Nm(t,e,n){const i=t.canvas,s=new MutationObserver((t=>{let e=!1;for(const n of t)e=e||Om(n.removedNodes,i),e=e&&!Om(n.addedNodes,i);e&&n()}));return s.observe(document,{childList:!0,subtree:!0}),s}const Am=new Map;let Lm=0;function Fm(){const t=window.devicePixelRatio;t!==Lm&&(Lm=t,Am.forEach(((e,n)=>{n.currentDevicePixelRatio!==t&&e()})))}function Um(t,e,n){const i=t.canvas,s=i&&Bf(i);if(!s)return;const r=tp(((t,e)=>{const i=s.clientWidth;n(t,e),i<s.clientWidth&&n()}),window),o=new ResizeObserver((t=>{const e=t[0],n=e.contentRect.width,i=e.contentRect.height;0===n&&0===i||r(n,i)}));return o.observe(s),function(t,e){Am.size||window.addEventListener("resize",Fm),Am.set(t,e)}(t,r),o}function jm(t,e,n){n&&n.disconnect(),"resize"===e&&function(t){Am.delete(t),Am.size||window.removeEventListener("resize",Fm)}(t)}function Bm(t,e,n){const i=t.canvas,s=tp((e=>{null!==t.ctx&&n(function(t,e){const n=Sm[t.type]||t.type,{x:i,y:s}=qf(t,e);return{type:n,chart:e,native:t,x:void 0!==i?i:null,y:void 0!==s?s:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,n){t.addEventListener(e,n,Rm)}(i,e,s),s}class zm extends Cm{acquireContext(t,e){const n=t&&t.getContext&&t.getContext("2d");return n&&n.canvas===t?(function(t,e){const n=t.style,i=t.getAttribute("height"),s=t.getAttribute("width");if(t[Em]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Pm(s)){const e=Gf(t,"width");void 0!==e&&(t.width=e)}if(Pm(i))if(""===t.style.height)t.height=t.width/(e||2);else{const e=Gf(t,"height");void 0!==e&&(t.height=e)}}(t,e),n):null}releaseContext(t){const e=t.canvas;if(!e[Em])return!1;const n=e[Em].initial;["height","width"].forEach((t=>{const i=n[t];ed(i)?e.removeAttribute(t):e.setAttribute(t,i)}));const i=n.style||{};return Object.keys(i).forEach((t=>{e.style[t]=i[t]})),e.width=e.width,delete e[Em],!0}addEventListener(t,e,n){this.removeEventListener(t,e);const i=t.$proxies||(t.$proxies={}),s={attach:Dm,detach:Nm,resize:Um}[e]||Bm;i[e]=s(t,e,n)}removeEventListener(t,e){const n=t.$proxies||(t.$proxies={}),i=n[e];i&&(({attach:jm,detach:jm,resize:jm}[e]||Mm)(t,e,i),n[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,n,i){return function(t,e,n,i){const s=Wf(t),r=Hf(s,"margin"),o=zf(s.maxWidth,t,"clientWidth")||Td,a=zf(s.maxHeight,t,"clientHeight")||Td,l=function(t,e,n){let i,s;if(void 0===e||void 0===n){const r=Bf(t);if(r){const t=r.getBoundingClientRect(),o=Wf(r),a=Hf(o,"border","width"),l=Hf(o,"padding");e=t.width-l.width-a.width,n=t.height-l.height-a.height,i=zf(o.maxWidth,r,"clientWidth"),s=zf(o.maxHeight,r,"clientHeight")}else e=t.clientWidth,n=t.clientHeight}return{width:e,height:n,maxWidth:i||Td,maxHeight:s||Td}}(t,e,n);let{width:c,height:h}=l;if("content-box"===s.boxSizing){const t=Hf(s,"border","width"),e=Hf(s,"padding");c-=e.width+t.width,h-=e.height+t.height}return c=Math.max(0,c-r.width),h=Math.max(0,i?Math.floor(c/i):h-r.height),c=$f(Math.min(c,o,l.maxWidth)),h=$f(Math.min(h,a,l.maxHeight)),c&&!h&&(h=$f(c/2)),{width:c,height:h}}(t,e,n,i)}isAttached(t){const e=Bf(t);return!(!e||!e.isConnected)}}class Wm{constructor(){this._init=[]}notify(t,e,n,i){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const s=i?this._descriptors(t).filter(i):this._descriptors(t),r=this._notify(s,t,e,n);return"afterDestroy"===e&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall")),r}_notify(t,e,n,i){i=i||{};for(const s of t){const t=s.plugin;if(!1===ld(t[n],[e,i,s.options],t)&&i.cancelable)return!1}return!0}invalidate(){ed(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const n=t&&t.config,i=od(n.options&&n.options.plugins,{}),s=function(t){const e={},n=[],i=Object.keys(em.plugins.items);for(let t=0;t<i.length;t++)n.push(em.getPlugin(i[t]));const s=t.plugins||[];for(let t=0;t<s.length;t++){const i=s[t];-1===n.indexOf(i)&&(n.push(i),e[i.id]=!0)}return{plugins:n,localIds:e}}(n);return!1!==i||e?function(t,{plugins:e,localIds:n},i,s){const r=[],o=t.getContext();for(const a of e){const e=a.id,l=Vm(i[e],s);null!==l&&r.push({plugin:a,options:Hm(t.config,{plugin:a,local:n[e]},l,o)})}return r}(t,s,i,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],n=this._cache,i=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(i(e,n),t,"stop"),this._notify(i(n,e),t,"start")}}function Vm(t,e){return e||!1!==t?!0===t?{}:t:null}function Hm(t,{plugin:e,local:n},i,s){const r=t.pluginScopeKeys(e),o=t.getOptionScopes(i,r);return n&&e.defaults&&o.push(e.defaults),t.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function qm(t,e){const n=Kp.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function $m(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(n=e.position)||"bottom"===n?"x":"left"===n||"right"===n?"y":void 0)||t.charAt(0).toLowerCase();var n}function Km(t){const e=t.options||(t.options={});e.plugins=od(e.plugins,{}),e.scales=function(t,e){const n=Vp[t.type]||{scales:{}},i=e.scales||{},s=qm(t.type,e),r=Object.create(null),o=Object.create(null);return Object.keys(i).forEach((t=>{const e=i[t];if(!id(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const a=$m(t,e),l=function(t,e){return t===e?"_index_":"_value_"}(a,s),c=n.scales||{};r[a]=r[a]||t,o[t]=gd(Object.create(null),[{axis:a},e,c[a],c[l]])})),t.data.datasets.forEach((n=>{const s=n.type||t.type,a=n.indexAxis||qm(s,e),l=(Vp[s]||{}).scales||{};Object.keys(l).forEach((t=>{const e=function(t,e){let n=t;return"_index_"===t?n=e:"_value_"===t&&(n="x"===e?"y":"x"),n}(t,a),s=n[e+"AxisID"]||r[e]||e;o[s]=o[s]||Object.create(null),gd(o[s],[{axis:e},i[s],l[t]])}))})),Object.keys(o).forEach((t=>{const e=o[t];gd(e,[Kp.scales[e.type],Kp.scale])})),o}(t,e)}function Ym(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const Gm=new Map,Xm=new Set;function Jm(t,e){let n=Gm.get(t);return n||(n=e(),Gm.set(t,n),Xm.add(n)),n}const Qm=(t,e,n)=>{const i=yd(e,n);void 0!==i&&t.add(i)};class Zm{constructor(t){this._config=function(t){return(t=t||{}).data=Ym(t.data),Km(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Ym(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Km(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Jm(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return Jm(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return Jm(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return Jm(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const n=this._scopeCache;let i=n.get(t);return i&&!e||(i=new Map,n.set(t,i)),i}getOptionScopes(t,e,n){const{options:i,type:s}=this,r=this._cachedScopes(t,n),o=r.get(e);if(o)return o;const a=new Set;e.forEach((e=>{t&&(a.add(t),e.forEach((e=>Qm(a,t,e)))),e.forEach((t=>Qm(a,i,t))),e.forEach((t=>Qm(a,Vp[s]||{},t))),e.forEach((t=>Qm(a,Kp,t))),e.forEach((t=>Qm(a,Hp,t)))}));const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),Xm.has(e)&&r.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,Vp[e]||{},Kp.datasets[e]||{},{type:e},Kp,Hp]}resolveNamedOptions(t,e,n,i=[""]){const s={$shared:!0},{resolver:r,subPrefixes:o}=t_(this._resolverCache,t,i);let a=r;(function(t,e){const{isScriptable:n,isIndexable:i}=wf(t);for(const s of e){const e=n(s),r=i(s),o=(r||e)&&t[s];if(e&&(wd(o)||e_(o))||r&&nd(o))return!0}return!1})(r,e)&&(s.$shared=!1,a=bf(r,n=wd(n)?n():n,this.createResolver(t,n,o)));for(const t of e)s[t]=a[t];return s}createResolver(t,e,n=[""],i){const{resolver:s}=t_(this._resolverCache,t,n);return id(e)?bf(s,e,void 0,i):s}}function t_(t,e,n){let i=t.get(e);i||(i=new Map,t.set(e,i));const s=n.join();let r=i.get(s);return r||(r={resolver:vf(e,n),subPrefixes:n.filter((t=>!t.toLowerCase().includes("hover")))},i.set(s,r)),r}const e_=t=>id(t)&&Object.getOwnPropertyNames(t).reduce(((e,n)=>e||wd(t[n])),!1),n_=["top","bottom","left","right","chartArea"];function i_(t,e){return"top"===t||"bottom"===t||-1===n_.indexOf(t)&&"x"===e}function s_(t,e){return function(n,i){return n[t]===i[t]?n[e]-i[e]:n[t]-i[t]}}function r_(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),ld(n&&n.onComplete,[t],e)}function o_(t){const e=t.chart,n=e.options.animation;ld(n&&n.onProgress,[t],e)}function a_(t){return jf()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const l_={},c_=t=>{const e=a_(t);return Object.values(l_).filter((t=>t.canvas===e)).pop()};function h_(t,e,n){const i=Object.keys(t);for(const s of i){const i=+s;if(i>=e){const r=t[s];delete t[s],(n>0||i>e)&&(t[i+n]=r)}}}class u_{constructor(t,e){const n=this.config=new Zm(e),i=a_(t),s=c_(i);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const r=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(t){return!jf()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Tm:zm}(i)),this.platform.updateConfig(n);const o=this.platform.acquireContext(i,r.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=td(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Wm,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(t,e){let n;return function(...i){return e?(clearTimeout(n),n=setTimeout(t,e,i)):t.apply(this,i),e}}((t=>this.update(t)),r.resizeDelay||0),this._dataChanges=[],l_[this.id]=this,o&&a?(hg.listen(this,"complete",r_),hg.listen(this,"progress",o_),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:n,height:i,_aspectRatio:s}=this;return ed(t)?e&&s?s:i?n/i:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Kf(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Jp(this.canvas,this.ctx),this}stop(){return hg.stop(this),this}resize(t,e){hg.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const n=this.options,i=this.canvas,s=n.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(i,t,e,s),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Kf(this,o,!0)&&(this.notifyPlugins("resize",{size:r}),ld(n.onResize,[this,r],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){cd(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,n=this.scales,i=Object.keys(n).reduce(((t,e)=>(t[e]=!1,t)),{});let s=[];e&&(s=s.concat(Object.keys(e).map((t=>{const n=e[t],i=$m(t,n),s="r"===i,r="x"===i;return{options:n,dposition:s?"chartArea":r?"bottom":"left",dtype:s?"radialLinear":r?"category":"linear"}})))),cd(s,(e=>{const s=e.options,r=s.id,o=$m(r,s),a=od(s.type,e.dtype);void 0!==s.position&&i_(s.position,o)===i_(e.dposition)||(s.position=e.dposition),i[r]=!0;let l=null;r in n&&n[r].type===a?l=n[r]:(l=new(em.getScale(a))({id:r,type:a,ctx:this.ctx,chart:this}),n[l.id]=l),l.init(s,t)})),cd(i,((t,e)=>{t||delete n[e]})),cd(n,(t=>{Im.configure(this,t,t.options),Im.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,n=t.length;if(t.sort(((t,e)=>t.index-e.index)),n>e){for(let t=e;t<n;++t)this._destroyDatasetMeta(t);t.splice(e,n-e)}this._sortedMetasets=t.slice(0).sort(s_("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,n)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(n)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=e.length;n<i;n++){const i=e[n];let s=this.getDatasetMeta(n);const r=i.type||this.config.type;if(s.type&&s.type!==r&&(this._destroyDatasetMeta(n),s=this.getDatasetMeta(n)),s.type=r,s.indexAxis=i.indexAxis||qm(r,this.options),s.order=i.order||0,s.index=n,s.label=""+i.label,s.visible=this.isDatasetVisible(n),s.controller)s.controller.updateIndex(n),s.controller.linkScales();else{const e=em.getController(r),{datasetElementType:i,dataElementType:o}=Kp.datasets[r];Object.assign(e.prototype,{dataElementType:em.getElement(o),datasetElementType:i&&em.getElement(i)}),s.controller=new e(this,n),t.push(s.controller)}}return this._updateMetasets(),t}_resetElements(){cd(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const n=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),n=!i&&-1===s.indexOf(e);e.buildOrUpdateElements(n),r=Math.max(+e.getMaxOverflow(),r)}r=this._minPadding=n.layout.autoPadding?r:0,this._updateLayout(r),i||cd(s,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(s_("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){cd(this.scales,(t=>{Im.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),n=new Set(t.events);xd(e,n)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:s}of e)h_(t,i,"_removeElements"===n?-s:s)}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,n=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),i=n(0);for(let t=1;t<e;t++)if(!xd(i,n(t)))return;return Array.from(i).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Im.update(this,this.width,this.height,t);const e=this.chartArea,n=e.width<=0||e.height<=0;this._layers=[],cd(this.boxes,(t=>{n&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,n=this.data.datasets.length;e<n;++e)this._updateDataset(e,wd(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const n=this.getDatasetMeta(t),i={meta:n,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(e),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(hg.has(this)?this.attached&&!hg.running(this)&&hg.start(this):(this.draw(),r_({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,n=[];let i,s;for(i=0,s=e.length;i<s;++i){const s=e[i];t&&!s.visible||n.push(s)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,n=t._clip,i=!n.disabled,s=this.chartArea,r={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",r)&&(i&&ef(e,{left:!1===n.left?0:s.left-n.left,right:!1===n.right?this.width:s.right+n.right,top:!1===n.top?0:s.top-n.top,bottom:!1===n.bottom?this.height:s.bottom+n.bottom}),t.controller.draw(),i&&nf(e),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(t){return tf(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,n,i){const s=dm.modes[e];return"function"==typeof s?s(this,t,n,i):[]}getDatasetMeta(t){const e=this.data.datasets[t],n=this._metasets;let i=n.filter((t=>t&&t._dataset===e)).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=yf(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const n=this.getDatasetMeta(t);return"boolean"==typeof n.hidden?!n.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,n){const i=n?"show":"hide",s=this.getDatasetMeta(t),r=s.controller._resolveAnimations(void 0,i);bd(e)?(s.data[e].hidden=!n,this.update()):(this.setDatasetVisibility(t,n),r.update(s,{visible:n}),this.update((e=>e.datasetIndex===t?i:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),hg.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Jp(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete l_[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(t,e,n)=>{t.offsetX=e,t.offsetY=n,this._eventHandler(t)};cd(this.options.events,(t=>n(t,i)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,n=(n,i)=>{e.addEventListener(this,n,i),t[n]=i},i=(n,i)=>{t[n]&&(e.removeEventListener(this,n,i),delete t[n])},s=(t,e)=>{this.canvas&&this.resize(t,e)};let r;const o=()=>{i("attach",o),this.attached=!0,this.resize(),n("resize",s),n("detach",r)};r=()=>{this.attached=!1,i("resize",s),this._stop(),this._resize(0,0),n("attach",o)},e.isAttached(this.canvas)?o():r()}unbindEvents(){cd(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},cd(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,n){const i=n?"set":"remove";let s,r,o,a;for("dataset"===e&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+i+"DatasetHoverStyle"]()),o=0,a=t.length;o<a;++o){r=t[o];const e=r&&this.getDatasetMeta(r.datasetIndex).controller;e&&e[i+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],n=t.map((({datasetIndex:t,index:e})=>{const n=this.getDatasetMeta(t);if(!n)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:n.data[e],index:e}}));!hd(n,e)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,e))}notifyPlugins(t,e,n){return this._plugins.notify(this,t,e,n)}_updateHoverStyles(t,e,n){const i=this.options.hover,s=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),r=s(e,t),o=n?t:s(t,e);r.length&&this.updateHoverStyle(r,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(t,e){const n={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},i=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const s=this._handleEvent(t,e,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(s||n.changed)&&this.render(),this}_handleEvent(t,e,n){const{_active:i=[],options:s}=this,r=e,o=this._getActiveElements(t,i,n,r),a=function(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}(t),l=function(t,e,n,i){return n&&"mouseout"!==t.type?i?e:t:null}(t,this._lastEvent,n,a);n&&(this._lastEvent=null,ld(s.onHover,[t,o,this],this),a&&ld(s.onClick,[t,o,this],this));const c=!hd(o,i);return(c||e)&&(this._active=o,this._updateHoverStyles(o,i,e)),this._lastEvent=l,c}_getActiveElements(t,e,n,i){if("mouseout"===t.type)return[];if(!n)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,i)}}const d_=()=>cd(u_.instances,(t=>t._plugins.invalidate())),p_=!0;function f_(t,e,n){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=e;let c=s/a;t.beginPath(),t.arc(r,o,a,i-c,n+c),l>s?(c=s/l,t.arc(r,o,l,n+c,i-c,!0)):t.arc(r,o,s,n+Sd,i-Sd),t.closePath(),t.clip()}function g_(t,e,n,i){return{x:n+t*Math.cos(e),y:i+t*Math.sin(e)}}function m_(t,e,n,i,s,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:h}=e,u=Math.max(e.outerRadius+i+n-c,0),d=h>0?h+i+n+c:0;let p=0;const f=s-l;if(i){const t=((h>0?h-i:0)+(u>0?u-i:0))/2;p=(f-(0!==t?f*t/(t+i):f))/2}const g=(f-Math.max(.001,f*u-n/kd)/u)/2,m=l+g+p,_=s-g-p,{outerStart:y,outerEnd:v,innerStart:b,innerEnd:w}=function(t,e,n,i){const s=df(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),r=(n-e)/2,o=Math.min(r,i*e/2),a=t=>{const e=(n-Math.min(r,t))*i/2;return qd(t,0,Math.min(r,e))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:qd(s.innerStart,0,o),innerEnd:qd(s.innerEnd,0,o)}}(e,d,u,_-m),x=u-y,k=u-v,I=m+y/x,C=_-v/k,T=d+b,E=d+w,S=m+b/T,P=_-w/E;if(t.beginPath(),r){if(t.arc(o,a,u,I,C),v>0){const e=g_(k,C,o,a);t.arc(e.x,e.y,v,C,_+Sd)}const e=g_(E,_,o,a);if(t.lineTo(e.x,e.y),w>0){const e=g_(E,P,o,a);t.arc(e.x,e.y,w,_+Sd,P+Math.PI)}if(t.arc(o,a,d,_-w/d,m+b/d,!0),b>0){const e=g_(T,S,o,a);t.arc(e.x,e.y,b,S+Math.PI,m-Sd)}const n=g_(x,m,o,a);if(t.lineTo(n.x,n.y),y>0){const e=g_(x,I,o,a);t.arc(e.x,e.y,y,m-Sd,I)}}else{t.moveTo(o,a);const e=Math.cos(I)*u+o,n=Math.sin(I)*u+a;t.lineTo(e,n);const i=Math.cos(C)*u+o,s=Math.sin(C)*u+a;t.lineTo(i,s)}t.closePath()}Object.defineProperties(u_,{defaults:{enumerable:p_,value:Kp},instances:{enumerable:p_,value:l_},overrides:{enumerable:p_,value:Vp},registry:{enumerable:p_,value:em},version:{enumerable:p_,value:"3.9.1"},getChart:{enumerable:p_,value:c_},register:{enumerable:p_,value:(...t)=>{em.add(...t),d_()}},unregister:{enumerable:p_,value:(...t)=>{em.remove(...t),d_()}}});class __ extends Vg{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.getProps(["x","y"],n),{angle:s,distance:r}=Bd(i,{x:t,y:e}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),u=this.options.spacing/2,d=od(h,a-o)>=Id||Hd(s,o,a),p=$d(r,l+u,c+u);return d&&p}getCenterPoint(t){const{x:e,y:n,startAngle:i,endAngle:s,innerRadius:r,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:a,spacing:l}=this.options,c=(i+s)/2,h=(r+o+l+a)/2;return{x:e+Math.cos(c)*h,y:n+Math.sin(c)*h}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:n}=this,i=(e.offset||0)/2,s=(e.spacing||0)/2,r=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=n>Id?Math.floor(n/Id):0,0===n||this.innerRadius<0||this.outerRadius<0)return;t.save();let o=0;if(i){o=i/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*o,Math.sin(e)*o),this.circumference>=kd&&(o=i)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const a=function(t,e,n,i,s){const{fullCircles:r,startAngle:o,circumference:a}=e;let l=e.endAngle;if(r){m_(t,e,n,i,o+Id,s);for(let e=0;e<r;++e)t.fill();isNaN(a)||(l=o+a%Id,a%Id==0&&(l+=Id))}return m_(t,e,n,i,l,s),t.fill(),l}(t,this,o,s,r);(function(t,e,n,i,s,r){const{options:o}=e,{borderWidth:a,borderJoinStyle:l}=o,c="inner"===o.borderAlign;a&&(c?(t.lineWidth=2*a,t.lineJoin=l||"round"):(t.lineWidth=a,t.lineJoin=l||"bevel"),e.fullCircles&&function(t,e,n){const{x:i,y:s,startAngle:r,pixelMargin:o,fullCircles:a}=e,l=Math.max(e.outerRadius-o,0),c=e.innerRadius+o;let h;for(n&&f_(t,e,r+Id),t.beginPath(),t.arc(i,s,c,r+Id,r,!0),h=0;h<a;++h)t.stroke();for(t.beginPath(),t.arc(i,s,l,r,r+Id),h=0;h<a;++h)t.stroke()}(t,e,c),c&&f_(t,e,s),m_(t,e,n,i,s,r),t.stroke())})(t,this,o,s,a,r),t.restore()}}function y_(t,e,n=e){t.lineCap=od(n.borderCapStyle,e.borderCapStyle),t.setLineDash(od(n.borderDash,e.borderDash)),t.lineDashOffset=od(n.borderDashOffset,e.borderDashOffset),t.lineJoin=od(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=od(n.borderWidth,e.borderWidth),t.strokeStyle=od(n.borderColor,e.borderColor)}function v_(t,e,n){t.lineTo(n.x,n.y)}function b_(t,e,n={}){const i=t.length,{start:s=0,end:r=i-1}=n,{start:o,end:a}=e,l=Math.max(s,o),c=Math.min(r,a),h=s<o&&r<o||s>a&&r>a;return{count:i,start:l,loop:e.loop,ilen:c<l&&!h?i+c-l:c-l}}function w_(t,e,n,i){const{points:s,options:r}=e,{count:o,start:a,loop:l,ilen:c}=b_(s,n,i),h=function(t){return t.stepped?sf:t.tension||"monotone"===t.cubicInterpolationMode?rf:v_}(r);let u,d,p,{move:f=!0,reverse:g}=i||{};for(u=0;u<=c;++u)d=s[(a+(g?c-u:u))%o],d.skip||(f?(t.moveTo(d.x,d.y),f=!1):h(t,p,d,g,r.stepped),p=d);return l&&(d=s[(a+(g?c:0))%o],h(t,p,d,g,r.stepped)),!!l}function x_(t,e,n,i){const s=e.points,{count:r,start:o,ilen:a}=b_(s,n,i),{move:l=!0,reverse:c}=i||{};let h,u,d,p,f,g,m=0,_=0;const y=t=>(o+(c?a-t:t))%r,v=()=>{p!==f&&(t.lineTo(m,f),t.lineTo(m,p),t.lineTo(m,g))};for(l&&(u=s[y(0)],t.moveTo(u.x,u.y)),h=0;h<=a;++h){if(u=s[y(h)],u.skip)continue;const e=u.x,n=u.y,i=0|e;i===d?(n<p?p=n:n>f&&(f=n),m=(_*m+e)/++_):(v(),t.lineTo(e,n),d=i,_=0,p=f=n),g=n}v()}function k_(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||n?w_:x_}__.id="arc",__.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0},__.defaultRoutes={backgroundColor:"backgroundColor"};const I_="function"==typeof Path2D;class C_ extends Vg{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;Uf(this._points,n,t,i,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(t,e){const n=t.points,i=t.options.spanGaps,s=n.length;if(!s)return[];const r=!!t._loop,{start:o,end:a}=function(t,e,n,i){let s=0,r=e-1;if(n&&!i)for(;s<e&&!t[s].skip;)s++;for(;s<e&&t[s].skip;)s++;for(s%=e,n&&(r+=s);r>s&&t[r%e].skip;)r--;return r%=e,{start:s,end:r}}(n,s,r,i);return function(t,e,n,i){return i&&i.setContext&&n?function(t,e,n,i){const s=t._chart.getContext(),r=lg(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=n.length,c=[];let h=r,u=e[0].start,d=u;function p(t,e,i,s){const r=a?-1:1;if(t!==e){for(t+=l;n[t%l].skip;)t-=r;for(;n[e%l].skip;)e+=r;t%l!=e%l&&(c.push({start:t%l,end:e%l,loop:i,style:s}),h=s,u=e%l)}}for(const t of e){u=a?u:t.start;let e,r=n[u%l];for(d=u+1;d<=t.end;d++){const a=n[d%l];e=lg(i.setContext(yf(s,{type:"segment",p0:r,p1:a,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:o}))),cg(e,h)&&p(u,d-1,t.loop,h),r=a,h=e}u<d-1&&p(u,d-1,t.loop,h)}return c}(t,e,n,i):e}(t,!0===i?[{start:o,end:a,loop:r}]:function(t,e,n,i){const s=t.length,r=[];let o,a=e,l=t[e];for(o=e+1;o<=n;++o){const n=t[o%s];n.skip||n.stop?l.skip||(i=!1,r.push({start:e%s,end:(o-1)%s,loop:i}),e=a=n.stop?o:null):(a=o,l.skip&&(e=o)),l=n}return null!==a&&r.push({start:e%s,end:a%s,loop:i}),r}(n,o,a<o?a+s:a,!!t._fullLoop&&0===o&&a===s-1),n,e)}(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,n=t.length;return n&&e[t[n-1].end]}interpolate(t,e){const n=this.options,i=t[e],s=this.points,r=ag(this,{property:e,start:i,end:i});if(!r.length)return;const o=[],a=function(t){return t.stepped?Jf:t.tension||"monotone"===t.cubicInterpolationMode?Qf:Xf}(n);let l,c;for(l=0,c=r.length;l<c;++l){const{start:c,end:h}=r[l],u=s[c],d=s[h];if(u===d){o.push(u);continue}const p=a(u,d,Math.abs((i-u[e])/(d[e]-u[e])),n.stepped);p[e]=t[e],o.push(p)}return 1===o.length?o[0]:o}pathSegment(t,e,n){return k_(this)(t,this,e,n)}path(t,e,n){const i=this.segments,s=k_(this);let r=this._loop;e=e||0,n=n||this.points.length-e;for(const o of i)r&=s(t,this,o,{start:e,end:e+n-1});return!!r}draw(t,e,n,i){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),function(t,e,n,i){I_&&!e.options.segment?function(t,e,n,i){let s=e._path;s||(s=e._path=new Path2D,e.path(s,n,i)&&s.closePath()),y_(t,e.options),t.stroke(s)}(t,e,n,i):function(t,e,n,i){const{segments:s,options:r}=e,o=k_(e);for(const a of s)y_(t,r,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+i-1})&&t.closePath(),t.stroke()}(t,e,n,i)}(t,this,n,i),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function T_(t,e,n,i){const s=t.options,{[n]:r}=t.getProps([n],i);return Math.abs(e-r)<s.radius+s.hitRadius}C_.id="line",C_.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},C_.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},C_.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class E_ extends Vg{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,n){const i=this.options,{x:s,y:r}=this.getProps(["x","y"],n);return Math.pow(t-s,2)+Math.pow(e-r,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(t,e){return T_(this,t,"x",e)}inYRange(t,e){return T_(this,t,"y",e)}getCenterPoint(t){const{x:e,y:n}=this.getProps(["x","y"],t);return{x:e,y:n}}size(t){let e=(t=t||this.options||{}).radius||0;return e=Math.max(e,e&&t.hoverRadius||0),2*(e+(e&&t.borderWidth||0))}draw(t,e){const n=this.options;this.skip||n.radius<.1||!tf(this,e,this.size(n)/2)||(t.strokeStyle=n.borderColor,t.lineWidth=n.borderWidth,t.fillStyle=n.backgroundColor,Qp(t,n,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function S_(t,e){const{x:n,y:i,base:s,width:r,height:o}=t.getProps(["x","y","base","width","height"],e);let a,l,c,h,u;return t.horizontal?(u=o/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,h=i+u):(u=r/2,a=n-u,l=n+u,c=Math.min(i,s),h=Math.max(i,s)),{left:a,top:c,right:l,bottom:h}}function P_(t,e,n,i){return t?0:qd(e,n,i)}function R_(t,e,n,i){const s=null===e,r=null===n,o=t&&!(s&&r)&&S_(t,i);return o&&(s||$d(e,o.left,o.right))&&(r||$d(n,o.top,o.bottom))}function M_(t,e){t.rect(e.x,e.y,e.w,e.h)}function O_(t,e,n={}){const i=t.x!==n.x?-e:0,s=t.y!==n.y?-e:0,r=(t.x+t.w!==n.x+n.w?e:0)-i,o=(t.y+t.h!==n.y+n.h?e:0)-s;return{x:t.x+i,y:t.y+s,w:t.w+r,h:t.h+o,radius:t.radius}}E_.id="point",E_.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},E_.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class D_ extends Vg{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:n,backgroundColor:i}}=this,{inner:s,outer:r}=function(t){const e=S_(t),n=e.right-e.left,i=e.bottom-e.top,s=function(t,e,n){const i=t.options.borderWidth,s=t.borderSkipped,r=pf(i);return{t:P_(s.top,r.top,0,n),r:P_(s.right,r.right,0,e),b:P_(s.bottom,r.bottom,0,n),l:P_(s.left,r.left,0,e)}}(t,n/2,i/2),r=function(t,e,n){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),s=t.options.borderRadius,r=ff(s),o=Math.min(e,n),a=t.borderSkipped,l=i||id(s);return{topLeft:P_(!l||a.top||a.left,r.topLeft,0,o),topRight:P_(!l||a.top||a.right,r.topRight,0,o),bottomLeft:P_(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:P_(!l||a.bottom||a.right,r.bottomRight,0,o)}}(t,n/2,i/2);return{outer:{x:e.left,y:e.top,w:n,h:i,radius:r},inner:{x:e.left+s.l,y:e.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}(this),o=(a=r.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?lf:M_;var a;t.save(),r.w===s.w&&r.h===s.h||(t.beginPath(),o(t,O_(r,e,s)),t.clip(),o(t,O_(s,-e,r)),t.fillStyle=n,t.fill("evenodd")),t.beginPath(),o(t,O_(s,e)),t.fillStyle=i,t.fill(),t.restore()}inRange(t,e,n){return R_(this,t,e,n)}inXRange(t,e){return R_(this,t,null,e)}inYRange(t,e){return R_(this,null,t,e)}getCenterPoint(t){const{x:e,y:n,base:i,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+i)/2:e,y:s?n:(n+i)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}D_.id="bar",D_.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},D_.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var N_=Object.freeze({__proto__:null,ArcElement:__,LineElement:C_,PointElement:E_,BarElement:D_});function A_(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{value:e})}}function L_(t){t.data.datasets.forEach((t=>{A_(t)}))}var F_={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,n)=>{if(!n.enabled)return void L_(t);const i=t.width;t.data.datasets.forEach(((e,s)=>{const{_data:r,indexAxis:o}=e,a=t.getDatasetMeta(s),l=r||e.data;if("y"===_f([o,t.options.indexAxis]))return;if(!a.controller.supportsDecimation)return;const c=t.scales[a.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(t.options.parsing)return;let h,{start:u,count:d}=function(t,e){const n=e.length;let i,s=0;const{iScale:r}=t,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(s=qd(Yd(e,r.axis,o).lo,0,n-1)),i=c?qd(Yd(e,r.axis,a).hi+1,s,n)-s:n-s,{start:s,count:i}}(a,l);if(d<=(n.threshold||4*i))A_(e);else{switch(ed(r)&&(e._data=l,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),n.algorithm){case"lttb":h=function(t,e,n,i,s){const r=s.samples||i;if(r>=n)return t.slice(e,e+n);const o=[],a=(n-2)/(r-2);let l=0;const c=e+n-1;let h,u,d,p,f,g=e;for(o[l++]=t[g],h=0;h<r-2;h++){let i,s=0,r=0;const c=Math.floor((h+1)*a)+1+e,m=Math.min(Math.floor((h+2)*a)+1,n)+e,_=m-c;for(i=c;i<m;i++)s+=t[i].x,r+=t[i].y;s/=_,r/=_;const y=Math.floor(h*a)+1+e,v=Math.min(Math.floor((h+1)*a)+1,n)+e,{x:b,y:w}=t[g];for(d=p=-1,i=y;i<v;i++)p=.5*Math.abs((b-s)*(t[i].y-w)-(b-t[i].x)*(r-w)),p>d&&(d=p,u=t[i],f=i);o[l++]=u,g=f}return o[l++]=t[c],o}(l,u,d,i,n);break;case"min-max":h=function(t,e,n,i){let s,r,o,a,l,c,h,u,d,p,f=0,g=0;const m=[],_=e+n-1,y=t[e].x,v=t[_].x-y;for(s=e;s<e+n;++s){r=t[s],o=(r.x-y)/v*i,a=r.y;const e=0|o;if(e===l)a<d?(d=a,c=s):a>p&&(p=a,h=s),f=(g*f+r.x)/++g;else{const n=s-1;if(!ed(c)&&!ed(h)){const e=Math.min(c,h),i=Math.max(c,h);e!==u&&e!==n&&m.push({...t[e],x:f}),i!==u&&i!==n&&m.push({...t[i],x:f})}s>0&&n!==u&&m.push(t[n]),m.push(r),l=e,g=0,d=p=a,c=h=u=s}}return m}(l,u,d,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}e._decimated=h}}))},destroy(t){L_(t)}};function U_(t,e,n,i){if(i)return;let s=e[t],r=n[t];return"angle"===t&&(s=Vd(s),r=Vd(r)),{property:t,start:s,end:r}}function j_(t,e,n){for(;e>t;e--){const t=n[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function B_(t,e,n,i){return t&&e?i(t[n],e[n]):t?t[n]:e?e[n]:0}function z_(t,e){let n=[],i=!1;return nd(t)?(i=!0,n=t):n=function(t,e){const{x:n=null,y:i=null}=t||{},s=e.points,r=[];return e.segments.forEach((({start:t,end:e})=>{e=j_(t,e,s);const o=s[t],a=s[e];null!==i?(r.push({x:o.x,y:i}),r.push({x:a.x,y:i})):null!==n&&(r.push({x:n,y:o.y}),r.push({x:n,y:a.y}))})),r}(t,e),n.length?new C_({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function W_(t){return t&&!1!==t.fill}function V_(t,e,n){let i=t[e].fill;const s=[e];let r;if(!n)return i;for(;!1!==i&&-1===s.indexOf(i);){if(!sd(i))return i;if(r=t[i],!r)return!1;if(r.visible)return i;s.push(i),i=r.fill}return!1}function H_(t,e,n){const i=function(t){const e=t.options,n=e.fill;let i=od(n&&n.target,n);return void 0===i&&(i=!!e.backgroundColor),!1!==i&&null!==i&&(!0===i?"origin":i)}(t);if(id(i))return!isNaN(i.value)&&i;let s=parseFloat(i);return sd(s)&&Math.floor(s)===s?function(t,e,n,i){return"-"!==t&&"+"!==t||(n=e+n),!(n===e||n<0||n>=i)&&n}(i[0],e,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function q_(t,e,n){const i=[];for(let s=0;s<n.length;s++){const r=n[s],{first:o,last:a,point:l}=$_(r,e,"x");if(!(!l||o&&a))if(o)i.unshift(l);else if(t.push(l),!a)break}t.push(...i)}function $_(t,e,n){const i=t.interpolate(e,n);if(!i)return{};const s=i[n],r=t.segments,o=t.points;let a=!1,l=!1;for(let t=0;t<r.length;t++){const e=r[t],i=o[e.start][n],c=o[e.end][n];if($d(s,i,c)){a=s===i,l=s===c;break}}return{first:a,last:l,point:i}}class K_{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,n){const{x:i,y:s,radius:r}=this;return e=e||{start:0,end:Id},t.arc(i,s,r,e.end,e.start,!0),!n.bounds}interpolate(t){const{x:e,y:n,radius:i}=this,s=t.angle;return{x:e+Math.cos(s)*i,y:n+Math.sin(s)*i,angle:s}}}function Y_(t,e,n){const i=function(t){const{chart:e,fill:n,line:i}=t;if(sd(n))return function(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}(e,n);if("stack"===n)return function(t){const{scale:e,index:n,line:i}=t,s=[],r=i.segments,o=i.points,a=function(t,e){const n=[],i=t.getMatchingVisibleMetas("line");for(let t=0;t<i.length;t++){const s=i[t];if(s.index===e)break;s.hidden||n.unshift(s.dataset)}return n}(e,n);a.push(z_({x:null,y:e.bottom},i));for(let t=0;t<r.length;t++){const e=r[t];for(let t=e.start;t<=e.end;t++)q_(s,o[t],a)}return new C_({points:s,options:{}})}(t);if("shape"===n)return!0;const s=function(t){return(t.scale||{}).getPointPositionForValue?function(t){const{scale:e,fill:n}=t,i=e.options,s=e.getLabels().length,r=i.reverse?e.max:e.min,o=function(t,e,n){let i;return i="start"===t?n:"end"===t?e.options.reverse?e.min:e.max:id(t)?t.value:e.getBaseValue(),i}(n,e,r),a=[];if(i.grid.circular){const t=e.getPointPositionForValue(0,r);return new K_({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(o)})}for(let t=0;t<s;++t)a.push(e.getPointPositionForValue(t,o));return a}(t):function(t){const{scale:e={},fill:n}=t,i=function(t,e){let n=null;return"start"===t?n=e.bottom:"end"===t?n=e.top:id(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}(n,e);if(sd(i)){const t=e.isHorizontal();return{x:t?i:null,y:t?null:i}}return null}(t)}(t);return s instanceof K_?s:z_(s,i)}(e),{line:s,scale:r,axis:o}=e,a=s.options,l=a.fill,c=a.backgroundColor,{above:h=c,below:u=c}=l||{};i&&s.points.length&&(ef(t,n),function(t,e){const{line:n,target:i,above:s,below:r,area:o,scale:a}=e,l=n._loop?"angle":e.axis;t.save(),"x"===l&&r!==s&&(G_(t,i,o.top),X_(t,{line:n,target:i,color:s,scale:a,property:l}),t.restore(),t.save(),G_(t,i,o.bottom)),X_(t,{line:n,target:i,color:r,scale:a,property:l}),t.restore()}(t,{line:s,target:i,above:h,below:u,area:n,scale:r,axis:o}),nf(t))}function G_(t,e,n){const{segments:i,points:s}=e;let r=!0,o=!1;t.beginPath();for(const a of i){const{start:i,end:l}=a,c=s[i],h=s[j_(i,l,s)];r?(t.moveTo(c.x,c.y),r=!1):(t.lineTo(c.x,n),t.lineTo(c.x,c.y)),o=!!e.pathSegment(t,a,{move:o}),o?t.closePath():t.lineTo(h.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function X_(t,e){const{line:n,target:i,property:s,color:r,scale:o}=e,a=function(t,e,n){const i=t.segments,s=t.points,r=e.points,o=[];for(const t of i){let{start:i,end:a}=t;a=j_(i,a,s);const l=U_(n,s[i],s[a],t.loop);if(!e.segments){o.push({source:t,target:l,start:s[i],end:s[a]});continue}const c=ag(e,l);for(const e of c){const i=U_(n,r[e.start],r[e.end],e.loop),a=og(t,s,i);for(const t of a)o.push({source:t,target:e,start:{[n]:B_(l,i,"start",Math.max)},end:{[n]:B_(l,i,"end",Math.min)}})}}return o}(n,i,s);for(const{source:e,target:l,start:c,end:h}of a){const{style:{backgroundColor:a=r}={}}=e,u=!0!==i;t.save(),t.fillStyle=a,J_(t,o,u&&U_(s,c,h)),t.beginPath();const d=!!n.pathSegment(t,e);let p;if(u){d?t.closePath():Q_(t,i,h,s);const e=!!i.pathSegment(t,l,{move:d,reverse:!0});p=d&&e,p||Q_(t,i,c,s)}t.closePath(),t.fill(p?"evenodd":"nonzero"),t.restore()}}function J_(t,e,n){const{top:i,bottom:s}=e.chart.chartArea,{property:r,start:o,end:a}=n||{};"x"===r&&(t.beginPath(),t.rect(o,i,a-o,s-i),t.clip())}function Q_(t,e,n,i){const s=e.interpolate(n,i);s&&t.lineTo(s.x,s.y)}var Z_={id:"filler",afterDatasetsUpdate(t,e,n){const i=(t.data.datasets||[]).length,s=[];let r,o,a,l;for(o=0;o<i;++o)r=t.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof C_&&(l={visible:t.isDatasetVisible(o),index:o,fill:H_(a,o,i),chart:t,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,s.push(l);for(o=0;o<i;++o)l=s[o],l&&!1!==l.fill&&(l.fill=V_(s,o,n.propagate))},beforeDraw(t,e,n){const i="beforeDraw"===n.drawTime,s=t.getSortedVisibleDatasetMetas(),r=t.chartArea;for(let e=s.length-1;e>=0;--e){const n=s[e].$filler;n&&(n.line.updateControlPoints(r,n.axis),i&&n.fill&&Y_(t.ctx,n,r))}},beforeDatasetsDraw(t,e,n){if("beforeDatasetsDraw"!==n.drawTime)return;const i=t.getSortedVisibleDatasetMetas();for(let e=i.length-1;e>=0;--e){const n=i[e].$filler;W_(n)&&Y_(t.ctx,n,t.chartArea)}},beforeDatasetDraw(t,e,n){const i=e.meta.$filler;W_(i)&&"beforeDatasetDraw"===n.drawTime&&Y_(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ty=(t,e)=>{let{boxHeight:n=e,boxWidth:i=e}=t;return t.usePointStyle&&(n=Math.min(n,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(e,n)}};class ey extends Vg{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,n){this.maxWidth=t,this.maxHeight=e,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=ld(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,n)=>t.sort(e,n,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const n=t.labels,i=mf(n.font),s=i.size,r=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=ty(n,s);let l,c;e.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(r,s,o,a)+10):(c=this.maxHeight,l=this._fitCols(r,s,o,a)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(c,t.maxHeight||this.maxHeight)}_fitRows(t,e,n,i){const{ctx:s,maxWidth:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+o;let h=t;s.textAlign="left",s.textBaseline="middle";let u=-1,d=-c;return this.legendItems.forEach(((t,p)=>{const f=n+e/2+s.measureText(t.text).width;(0===p||l[l.length-1]+f+2*o>r)&&(h+=c,l[l.length-(p>0?0:1)]=0,d+=c,u++),a[p]={left:0,top:d,row:u,width:f,height:i},l[l.length-1]+=f+o})),h}_fitCols(t,e,n,i){const{ctx:s,maxHeight:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=r-t;let h=o,u=0,d=0,p=0,f=0;return this.legendItems.forEach(((t,r)=>{const g=n+e/2+s.measureText(t.text).width;r>0&&d+i+2*o>c&&(h+=u+o,l.push({width:u,height:d}),p+=u+o,f++,u=d=0),a[r]={left:p,top:d,col:f,width:g,height:i},u=Math.max(u,g),d+=i+o})),h+=u,l.push({width:u,height:d}),h}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:n,labels:{padding:i},rtl:s}}=this,r=eg(s,this.left,this.width);if(this.isHorizontal()){let s=0,o=np(n,this.left+i,this.right-this.lineWidths[s]);for(const a of e)s!==a.row&&(s=a.row,o=np(n,this.left+i,this.right-this.lineWidths[s])),a.top+=this.top+t+i,a.left=r.leftForLtr(r.x(o),a.width),o+=a.width+i}else{let s=0,o=np(n,this.top+t+i,this.bottom-this.columnSizes[s].height);for(const a of e)a.col!==s&&(s=a.col,o=np(n,this.top+t+i,this.bottom-this.columnSizes[s].height)),a.top=o,a.left+=this.left+i,a.left=r.leftForLtr(r.x(a.left),a.width),o+=a.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;ef(t,this),this._draw(),nf(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:n,ctx:i}=this,{align:s,labels:r}=t,o=Kp.color,a=eg(t.rtl,this.left,this.width),l=mf(r.font),{color:c,padding:h}=r,u=l.size,d=u/2;let p;this.drawTitle(),i.textAlign=a.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:f,boxHeight:g,itemHeight:m}=ty(r,u),_=this.isHorizontal(),y=this._computeTitleHeight();p=_?{x:np(s,this.left+h,this.right-n[0]),y:this.top+h+y,line:0}:{x:this.left+h,y:np(s,this.top+y+h,this.bottom-e[0].height),line:0},ng(this.ctx,t.textDirection);const v=m+h;this.legendItems.forEach(((b,w)=>{i.strokeStyle=b.fontColor||c,i.fillStyle=b.fontColor||c;const x=i.measureText(b.text).width,k=a.textAlign(b.textAlign||(b.textAlign=r.textAlign)),I=f+d+x;let C=p.x,T=p.y;a.setWidth(this.width),_?w>0&&C+I+h>this.right&&(T=p.y+=v,p.line++,C=p.x=np(s,this.left+h,this.right-n[p.line])):w>0&&T+v>this.bottom&&(C=p.x=C+e[p.line].width+h,p.line++,T=p.y=np(s,this.top+y+h,this.bottom-e[p.line].height)),function(t,e,n){if(isNaN(f)||f<=0||isNaN(g)||g<0)return;i.save();const s=od(n.lineWidth,1);if(i.fillStyle=od(n.fillStyle,o),i.lineCap=od(n.lineCap,"butt"),i.lineDashOffset=od(n.lineDashOffset,0),i.lineJoin=od(n.lineJoin,"miter"),i.lineWidth=s,i.strokeStyle=od(n.strokeStyle,o),i.setLineDash(od(n.lineDash,[])),r.usePointStyle){const o={radius:g*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:s},l=a.xPlus(t,f/2);Zp(i,o,l,e+d,r.pointStyleWidth&&f)}else{const r=e+Math.max((u-g)/2,0),o=a.leftForLtr(t,f),l=ff(n.borderRadius);i.beginPath(),Object.values(l).some((t=>0!==t))?lf(i,{x:o,y:r,w:f,h:g,radius:l}):i.rect(o,r,f,g),i.fill(),0!==s&&i.stroke()}i.restore()}(a.x(C),T,b),C=((t,e,n,i)=>t===(i?"left":"right")?n:"center"===t?(e+n)/2:e)(k,C+f+d,_?C+I:this.right,t.rtl),function(t,e,n){of(i,n.text,t,e+m/2,l,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(C),T,b),_?p.x+=I+h:p.y+=v})),ig(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,n=mf(e.font),i=gf(e.padding);if(!e.display)return;const s=eg(t.rtl,this.left,this.width),r=this.ctx,o=e.position,a=n.size/2,l=i.top+a;let c,h=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),c=this.top+l,h=np(t.align,h,this.right-u);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);c=l+np(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const d=np(o,h,h+u);r.textAlign=s.textAlign(ep(o)),r.textBaseline="middle",r.strokeStyle=e.color,r.fillStyle=e.color,r.font=n.string,of(r,e.text,d,c,n)}_computeTitleHeight(){const t=this.options.title,e=mf(t.font),n=gf(t.padding);return t.display?e.lineHeight+n.height:0}_getLegendItemAt(t,e){let n,i,s;if($d(t,this.left,this.right)&&$d(e,this.top,this.bottom))for(s=this.legendHitBoxes,n=0;n<s.length;++n)if(i=s[n],$d(t,i.left,i.left+i.width)&&$d(e,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(t){const e=this.options;if(!function(t,e){return!("mousemove"!==t&&"mouseout"!==t||!e.onHover&&!e.onLeave)||!(!e.onClick||"click"!==t&&"mouseup"!==t)}(t.type,e))return;const n=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const r=this._hoveredItem,o=(s=n,null!==(i=r)&&null!==s&&i.datasetIndex===s.datasetIndex&&i.index===s.index);r&&!o&&ld(e.onLeave,[t,r,this],this),this._hoveredItem=n,n&&!o&&ld(e.onHover,[t,n,this],this)}else n&&ld(e.onClick,[t,n,this],this);var i,s}}var ny={id:"legend",_element:ey,start(t,e,n){const i=t.legend=new ey({ctx:t.ctx,options:n,chart:t});Im.configure(t,i,n),Im.addBox(t,i)},stop(t){Im.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const i=t.legend;Im.configure(t,i,n),i.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const i=e.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),e.hidden=!0):(s.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:r}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const o=t.controller.getStyle(n?0:void 0),a=gf(o.borderWidth);return{text:e[t.index].label,fillStyle:o.backgroundColor,fontColor:r,hidden:!t.visible,lineCap:o.borderCapStyle,lineDash:o.borderDash,lineDashOffset:o.borderDashOffset,lineJoin:o.borderJoinStyle,lineWidth:(a.width+a.height)/4,strokeStyle:o.borderColor,pointStyle:i||o.pointStyle,rotation:o.rotation,textAlign:s||o.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class iy extends Vg{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const i=nd(n.text)?n.text.length:1;this._padding=gf(n.padding);const s=i*mf(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:n,bottom:i,right:s,options:r}=this,o=r.align;let a,l,c,h=0;return this.isHorizontal()?(l=np(o,n,s),c=e+t,a=s-n):("left"===r.position?(l=n+t,c=np(o,i,e),h=-.5*kd):(l=s-t,c=np(o,e,i),h=.5*kd),a=i-e),{titleX:l,titleY:c,maxWidth:a,rotation:h}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const n=mf(e.font),i=n.lineHeight/2+this._padding.top,{titleX:s,titleY:r,maxWidth:o,rotation:a}=this._drawArgs(i);of(t,e.text,0,0,n,{color:e.color,maxWidth:o,rotation:a,textAlign:ep(e.align),textBaseline:"middle",translation:[s,r]})}}var sy={id:"title",_element:iy,start(t,e,n){!function(t,e){const n=new iy({ctx:t.ctx,options:e,chart:t});Im.configure(t,n,e),Im.addBox(t,n),t.titleBlock=n}(t,n)},stop(t){const e=t.titleBlock;Im.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const i=t.titleBlock;Im.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ry=new WeakMap;var oy={id:"subtitle",start(t,e,n){const i=new iy({ctx:t.ctx,options:n,chart:t});Im.configure(t,i,n),Im.addBox(t,i),ry.set(t,i)},stop(t){Im.removeBox(t,ry.get(t)),ry.delete(t)},beforeUpdate(t,e,n){const i=ry.get(t);Im.configure(t,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ay={average(t){if(!t.length)return!1;let e,n,i=0,s=0,r=0;for(e=0,n=t.length;e<n;++e){const n=t[e].element;if(n&&n.hasValue()){const t=n.tooltipPosition();i+=t.x,s+=t.y,++r}}return{x:i/r,y:s/r}},nearest(t,e){if(!t.length)return!1;let n,i,s,r=e.x,o=e.y,a=Number.POSITIVE_INFINITY;for(n=0,i=t.length;n<i;++n){const i=t[n].element;if(i&&i.hasValue()){const t=zd(e,i.getCenterPoint());t<a&&(a=t,s=i)}}if(s){const t=s.tooltipPosition();r=t.x,o=t.y}return{x:r,y:o}}};function ly(t,e){return e&&(nd(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function cy(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function hy(t,e){const{element:n,datasetIndex:i,index:s}=e,r=t.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:t,label:o,parsed:r.getParsed(s),raw:t.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function uy(t,e){const n=t.chart.ctx,{body:i,footer:s,title:r}=t,{boxWidth:o,boxHeight:a}=e,l=mf(e.bodyFont),c=mf(e.titleFont),h=mf(e.footerFont),u=r.length,d=s.length,p=i.length,f=gf(e.padding);let g=f.height,m=0,_=i.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);_+=t.beforeBody.length+t.afterBody.length,u&&(g+=u*c.lineHeight+(u-1)*e.titleSpacing+e.titleMarginBottom),_&&(g+=p*(e.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(_-p)*l.lineHeight+(_-1)*e.bodySpacing),d&&(g+=e.footerMarginTop+d*h.lineHeight+(d-1)*e.footerSpacing);let y=0;const v=function(t){m=Math.max(m,n.measureText(t).width+y)};return n.save(),n.font=c.string,cd(t.title,v),n.font=l.string,cd(t.beforeBody.concat(t.afterBody),v),y=e.displayColors?o+2+e.boxPadding:0,cd(i,(t=>{cd(t.before,v),cd(t.lines,v),cd(t.after,v)})),y=0,n.font=h.string,cd(t.footer,v),n.restore(),m+=f.width,{width:m,height:g}}function dy(t,e,n,i){const{x:s,width:r}=n,{width:o,chartArea:{left:a,right:l}}=t;let c="center";return"center"===i?c=s<=(a+l)/2?"left":"right":s<=r/2?c="left":s>=o-r/2&&(c="right"),function(t,e,n,i){const{x:s,width:r}=i,o=n.caretSize+n.caretPadding;return"left"===t&&s+r+o>e.width||"right"===t&&s-r-o<0||void 0}(c,t,e,n)&&(c="center"),c}function py(t,e,n){const i=n.yAlign||e.yAlign||function(t,e){const{y:n,height:i}=e;return n<i/2?"top":n>t.height-i/2?"bottom":"center"}(t,n);return{xAlign:n.xAlign||e.xAlign||dy(t,e,n,i),yAlign:i}}function fy(t,e,n,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=t,{xAlign:a,yAlign:l}=n,c=s+r,{topLeft:h,topRight:u,bottomLeft:d,bottomRight:p}=ff(o);let f=function(t,e){let{x:n,width:i}=t;return"right"===e?n-=i:"center"===e&&(n-=i/2),n}(e,a);const g=function(t,e,n){let{y:i,height:s}=t;return"top"===e?i+=n:i-="bottom"===e?s+n:s/2,i}(e,l,c);return"center"===l?"left"===a?f+=c:"right"===a&&(f-=c):"left"===a?f-=Math.max(h,d)+s:"right"===a&&(f+=Math.max(u,p)+s),{x:qd(f,0,i.width-e.width),y:qd(g,0,i.height-e.height)}}function gy(t,e,n){const i=gf(n.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-i.right:t.x+i.left}function my(t){return ly([],cy(t))}function _y(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}class yy extends Vg{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&e.options.animation&&n.animations,s=new gg(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=yf(this.chart.getContext(),{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"}))}getTitle(t,e){const{callbacks:n}=e,i=n.beforeTitle.apply(this,[t]),s=n.title.apply(this,[t]),r=n.afterTitle.apply(this,[t]);let o=[];return o=ly(o,cy(i)),o=ly(o,cy(s)),o=ly(o,cy(r)),o}getBeforeBody(t,e){return my(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:n}=e,i=[];return cd(t,(t=>{const e={before:[],lines:[],after:[]},s=_y(n,t);ly(e.before,cy(s.beforeLabel.call(this,t))),ly(e.lines,s.label.call(this,t)),ly(e.after,cy(s.afterLabel.call(this,t))),i.push(e)})),i}getAfterBody(t,e){return my(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:n}=e,i=n.beforeFooter.apply(this,[t]),s=n.footer.apply(this,[t]),r=n.afterFooter.apply(this,[t]);let o=[];return o=ly(o,cy(i)),o=ly(o,cy(s)),o=ly(o,cy(r)),o}_createItems(t){const e=this._active,n=this.chart.data,i=[],s=[],r=[];let o,a,l=[];for(o=0,a=e.length;o<a;++o)l.push(hy(this.chart,e[o]));return t.filter&&(l=l.filter(((e,i,s)=>t.filter(e,i,s,n)))),t.itemSort&&(l=l.sort(((e,i)=>t.itemSort(e,i,n)))),cd(l,(e=>{const n=_y(t.callbacks,e);i.push(n.labelColor.call(this,e)),s.push(n.labelPointStyle.call(this,e)),r.push(n.labelTextColor.call(this,e))})),this.labelColors=i,this.labelPointStyles=s,this.labelTextColors=r,this.dataPoints=l,l}update(t,e){const n=this.options.setContext(this.getContext()),i=this._active;let s,r=[];if(i.length){const t=ay[n.position].call(this,i,this._eventPosition);r=this._createItems(n),this.title=this.getTitle(r,n),this.beforeBody=this.getBeforeBody(r,n),this.body=this.getBody(r,n),this.afterBody=this.getAfterBody(r,n),this.footer=this.getFooter(r,n);const e=this._size=uy(this,n),o=Object.assign({},t,e),a=py(this.chart,n,o),l=fy(n,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,s={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=r,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,n,i){const s=this.getCaretPosition(t,n,i);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,n){const{xAlign:i,yAlign:s}=this,{caretSize:r,cornerRadius:o}=n,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:h}=ff(o),{x:u,y:d}=t,{width:p,height:f}=e;let g,m,_,y,v,b;return"center"===s?(v=d+f/2,"left"===i?(g=u,m=g-r,y=v+r,b=v-r):(g=u+p,m=g+r,y=v-r,b=v+r),_=g):(m="left"===i?u+Math.max(a,c)+r:"right"===i?u+p-Math.max(l,h)-r:this.caretX,"top"===s?(y=d,v=y-r,g=m-r,_=m+r):(y=d+f,v=y+r,g=m+r,_=m-r),b=y),{x1:g,x2:m,x3:_,y1:y,y2:v,y3:b}}drawTitle(t,e,n){const i=this.title,s=i.length;let r,o,a;if(s){const l=eg(n.rtl,this.x,this.width);for(t.x=gy(this,n.titleAlign,n),e.textAlign=l.textAlign(n.titleAlign),e.textBaseline="middle",r=mf(n.titleFont),o=n.titleSpacing,e.fillStyle=n.titleColor,e.font=r.string,a=0;a<s;++a)e.fillText(i[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+o,a+1===s&&(t.y+=n.titleMarginBottom-o)}}_drawColorBox(t,e,n,i,s){const r=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:a,boxWidth:l,boxPadding:c}=s,h=mf(s.bodyFont),u=gy(this,"left",s),d=i.x(u),p=a<h.lineHeight?(h.lineHeight-a)/2:0,f=e.y+p;if(s.usePointStyle){const e={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=i.leftForLtr(d,l)+l/2,c=f+a/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,Qp(t,e,n,c),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,Qp(t,e,n,c)}else{t.lineWidth=id(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const e=i.leftForLtr(d,l-c),n=i.leftForLtr(i.xPlus(d,1),l-c-2),o=ff(r.borderRadius);Object.values(o).some((t=>0!==t))?(t.beginPath(),t.fillStyle=s.multiKeyBackground,lf(t,{x:e,y:f,w:l,h:a,radius:o}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),lf(t,{x:n,y:f+1,w:l-2,h:a-2,radius:o}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(e,f,l,a),t.strokeRect(e,f,l,a),t.fillStyle=r.backgroundColor,t.fillRect(n,f+1,l-2,a-2))}t.fillStyle=this.labelTextColors[n]}drawBody(t,e,n){const{body:i}=this,{bodySpacing:s,bodyAlign:r,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=n,h=mf(n.bodyFont);let u=h.lineHeight,d=0;const p=eg(n.rtl,this.x,this.width),f=function(n){e.fillText(n,p.x(t.x+d),t.y+u/2),t.y+=u+s},g=p.textAlign(r);let m,_,y,v,b,w,x;for(e.textAlign=r,e.textBaseline="middle",e.font=h.string,t.x=gy(this,g,n),e.fillStyle=n.bodyColor,cd(this.beforeBody,f),d=o&&"right"!==g?"center"===r?l/2+c:l+2+c:0,v=0,w=i.length;v<w;++v){for(m=i[v],_=this.labelTextColors[v],e.fillStyle=_,cd(m.before,f),y=m.lines,o&&y.length&&(this._drawColorBox(e,t,v,p,n),u=Math.max(h.lineHeight,a)),b=0,x=y.length;b<x;++b)f(y[b]),u=h.lineHeight;cd(m.after,f)}d=0,u=h.lineHeight,cd(this.afterBody,f),t.y-=s}drawFooter(t,e,n){const i=this.footer,s=i.length;let r,o;if(s){const a=eg(n.rtl,this.x,this.width);for(t.x=gy(this,n.footerAlign,n),t.y+=n.footerMarginTop,e.textAlign=a.textAlign(n.footerAlign),e.textBaseline="middle",r=mf(n.footerFont),e.fillStyle=n.footerColor,e.font=r.string,o=0;o<s;++o)e.fillText(i[o],a.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+n.footerSpacing}}drawBackground(t,e,n,i){const{xAlign:s,yAlign:r}=this,{x:o,y:a}=t,{width:l,height:c}=n,{topLeft:h,topRight:u,bottomLeft:d,bottomRight:p}=ff(i.cornerRadius);e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.beginPath(),e.moveTo(o+h,a),"top"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+l-u,a),e.quadraticCurveTo(o+l,a,o+l,a+u),"center"===r&&"right"===s&&this.drawCaret(t,e,n,i),e.lineTo(o+l,a+c-p),e.quadraticCurveTo(o+l,a+c,o+l-p,a+c),"bottom"===r&&this.drawCaret(t,e,n,i),e.lineTo(o+d,a+c),e.quadraticCurveTo(o,a+c,o,a+c-d),"center"===r&&"left"===s&&this.drawCaret(t,e,n,i),e.lineTo(o,a+h),e.quadraticCurveTo(o,a,o+h,a),e.closePath(),e.fill(),i.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,n=this.$animations,i=n&&n.x,s=n&&n.y;if(i||s){const n=ay[t.position].call(this,this._active,this._eventPosition);if(!n)return;const r=this._size=uy(this,t),o=Object.assign({},n,this._size),a=py(e,t,o),l=fy(t,o,a,e);i._to===l.x&&s._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=r.width,this.height=r.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(e);const i={width:this.width,height:this.height},s={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const r=gf(e.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&o&&(t.save(),t.globalAlpha=n,this.drawBackground(s,t,i,e),ng(t,e.textDirection),s.y+=r.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),ig(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const n=this._active,i=t.map((({datasetIndex:t,index:e})=>{const n=this.chart.getDatasetMeta(t);if(!n)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:n.data[e],index:e}})),s=!hd(n,i),r=this._positionChanged(i,e);(s||r)&&(this._active=i,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,n=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,s=this._active||[],r=this._getActiveElements(t,s,e,n),o=this._positionChanged(r,t),a=e||!hd(r,s)||o;return a&&(this._active=r,(i.enabled||i.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),a}_getActiveElements(t,e,n,i){const s=this.options;if("mouseout"===t.type)return[];if(!i)return e;const r=this.chart.getElementsAtEventForMode(t,s.mode,s,n);return s.reverse&&r.reverse(),r}_positionChanged(t,e){const{caretX:n,caretY:i,options:s}=this,r=ay[s.position].call(this,t,e);return!1!==r&&(n!==r.x||i!==r.y)}}yy.positioners=ay;var vy={id:"tooltip",_element:yy,positioners:ay,afterInit(t,e,n){n&&(t.tooltip=new yy({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",n))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:Zu,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return n[e.dataIndex]}return""},afterTitle:Zu,beforeBody:Zu,beforeLabel:Zu,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return ed(n)||(e+=n),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Zu,afterBody:Zu,beforeFooter:Zu,footer:Zu,afterFooter:Zu}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},by=Object.freeze({__proto__:null,Decimation:F_,Filler:Z_,Legend:ny,SubTitle:oy,Title:sy,Tooltip:vy});class wy extends Zg{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:n,label:i}of e)t[n]===i&&t.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(ed(t))return null;const n=this.getLabels();return((t,e)=>null===t?null:qd(Math.round(t),0,e))(e=isFinite(e)&&n[e]===t?e:function(t,e,n,i){const s=t.indexOf(e);return-1===s?((t,e,n,i)=>("string"==typeof e?(n=t.push(e)-1,i.unshift({index:n,label:e})):isNaN(e)&&(n=null),n))(t,e,n,i):s!==t.lastIndexOf(e)?n:s}(n,t,od(e,t),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(n=0),e||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const t=this.min,e=this.max,n=this.options.offset,i=[];let s=this.getLabels();s=0===t&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let n=t;n<=e;n++)i.push({value:n});return i}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function xy(t,e,{horizontal:n,minRotation:i}){const s=Fd(i),r=(n?Math.sin(s):Math.cos(s))||.001,o=.75*e*(""+t).length;return Math.min(e/r,o)}wy.id="category",wy.defaults={ticks:{callback:wy.prototype.getLabelForValue}};class ky extends Zg{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return ed(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this;const r=t=>i=e?i:t,o=t=>s=n?s:t;if(t){const t=Od(i),e=Od(s);t<0&&e<0?o(0):t>0&&e>0&&r(0)}if(i===s){let e=1;(s>=Number.MAX_SAFE_INTEGER||i<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*s)),o(s+e),t||r(i-e)}this.min=i,this.max=s}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:n,stepSize:i}=t;return i?(e=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),n=n||11),n&&(e=Math.min(n,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=function(t,e){const n=[],{bounds:i,step:s,min:r,max:o,precision:a,count:l,maxTicks:c,maxDigits:h,includeBounds:u}=t,d=s||1,p=c-1,{min:f,max:g}=e,m=!ed(r),_=!ed(o),y=!ed(l),v=(g-f)/(h+1);let b,w,x,k,I=Dd((g-f)/p/d)*d;if(I<1e-14&&!m&&!_)return[{value:f},{value:g}];k=Math.ceil(g/I)-Math.floor(f/I),k>p&&(I=Dd(k*I/p/d)*d),ed(a)||(b=Math.pow(10,a),I=Math.ceil(I*b)/b),"ticks"===i?(w=Math.floor(f/I)*I,x=Math.ceil(g/I)*I):(w=f,x=g),m&&_&&s&&function(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}((o-r)/s,I/1e3)?(k=Math.round(Math.min((o-r)/I,c)),I=(o-r)/k,w=r,x=o):y?(w=m?r:w,x=_?o:x,k=l-1,I=(x-w)/k):(k=(x-w)/I,k=Ad(k,Math.round(k),I/1e3)?Math.round(k):Math.ceil(k));const C=Math.max(jd(I),jd(w));b=Math.pow(10,ed(a)?C:a),w=Math.round(w*b)/b,x=Math.round(x*b)/b;let T=0;for(m&&(u&&w!==r?(n.push({value:r}),w<r&&T++,Ad(Math.round((w+T*I)*b)/b,r,xy(r,v,t))&&T++):w<r&&T++);T<k;++T)n.push({value:Math.round((w+T*I)*b)/b});return _&&u&&x!==o?n.length&&Ad(n[n.length-1].value,o,xy(o,v,t))?n[n.length-1].value=o:n.push({value:o}):_&&x!==o||n.push({value:x}),n}({maxTicks:n,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&Ld(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const t=this.ticks;let e=this.min,n=this.max;if(super.configure(),this.options.offset&&t.length){const i=(n-e)/Math.max(t.length-1,1)/2;e-=i,n+=i}this._startValue=e,this._endValue=n,this._valueRange=n-e}getLabelForValue(t){return tg(t,this.chart.options.locale,this.options.ticks.format)}}class Iy extends ky{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=sd(t)?t:0,this.max=sd(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,n=Fd(this.options.ticks.minRotation),i=(t?Math.sin(n):Math.cos(n))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/i))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function Cy(t){return 1==t/Math.pow(10,Math.floor(Md(t)))}Iy.id="linear",Iy.defaults={ticks:{callback:qg.formatters.numeric}};class Ty extends Zg{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const n=ky.prototype.parse.apply(this,[t,e]);if(0!==n)return sd(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=sd(t)?Math.max(0,t):null,this.max=sd(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let n=this.min,i=this.max;const s=e=>n=t?n:e,r=t=>i=e?i:t,o=(t,e)=>Math.pow(10,Math.floor(Md(t))+e);n===i&&(n<=0?(s(1),r(10)):(s(o(n,-1)),r(o(i,1)))),n<=0&&s(o(i,-1)),i<=0&&r(o(n,1)),this._zero&&this.min!==this._suggestedMin&&n===o(this.min,0)&&s(o(n,-1)),this.min=n,this.max=i}buildTicks(){const t=this.options,e=function(t,e){const n=Math.floor(Md(e.max)),i=Math.ceil(e.max/Math.pow(10,n)),s=[];let r=rd(t.min,Math.pow(10,Math.floor(Md(e.min)))),o=Math.floor(Md(r)),a=Math.floor(r/Math.pow(10,o)),l=o<0?Math.pow(10,Math.abs(o)):1;do{s.push({value:r,major:Cy(r)}),++a,10===a&&(a=1,++o,l=o>=0?1:l),r=Math.round(a*Math.pow(10,o)*l)/l}while(o<n||o===n&&a<i);const c=rd(t.max,r);return s.push({value:c,major:Cy(r)}),s}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&Ld(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":tg(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Md(t),this._valueRange=Md(this.max)-Md(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Md(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Ey(t){const e=t.ticks;if(e.display&&t.display){const t=gf(e.backdropPadding);return od(e.font&&e.font.size,Kp.font.size)+t.height}return 0}function Sy(t,e,n,i,s){return t===i||t===s?{start:e-n/2,end:e+n/2}:t<i||t>s?{start:e-n,end:e}:{start:e,end:e+n}}function Py(t,e,n,i,s){const r=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,l=0;i.start<e.l?(a=(e.l-i.start)/r,t.l=Math.min(t.l,e.l-a)):i.end>e.r&&(a=(i.end-e.r)/r,t.r=Math.max(t.r,e.r+a)),s.start<e.t?(l=(e.t-s.start)/o,t.t=Math.min(t.t,e.t-l)):s.end>e.b&&(l=(s.end-e.b)/o,t.b=Math.max(t.b,e.b+l))}function Ry(t){return 0===t||180===t?"center":t<180?"left":"right"}function My(t,e,n){return 90===n||270===n?t-=e/2:(n>270||n<90)&&(t-=e),t}function Oy(t,e,n,i){const{ctx:s}=t;if(n)s.arc(t.xCenter,t.yCenter,e,0,Id);else{let n=t.getPointPosition(0,e);s.moveTo(n.x,n.y);for(let r=1;r<i;r++)n=t.getPointPosition(r,e),s.lineTo(n.x,n.y)}}Ty.id="logarithmic",Ty.defaults={ticks:{callback:qg.formatters.logarithmic,major:{enabled:!0}}};class Dy extends ky{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=gf(Ey(this.options)/2),e=this.width=this.maxWidth-t.width,n=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+n/2+t.top),this.drawingArea=Math.floor(Math.min(e,n)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=sd(t)&&!isNaN(t)?t:0,this.max=sd(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ey(this.options))}generateTickLabels(t){ky.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const n=ld(this.options.pointLabels.callback,[t,e],this);return n||0===n?n:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?function(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},n=Object.assign({},e),i=[],s=[],r=t._pointLabels.length,o=t.options.pointLabels,a=o.centerPointLabels?kd/r:0;for(let u=0;u<r;u++){const r=o.setContext(t.getPointLabelContext(u));s[u]=r.padding;const d=t.getPointPosition(u,t.drawingArea+s[u],a),p=mf(r.font),f=(l=t.ctx,c=p,h=nd(h=t._pointLabels[u])?h:[h],{w:Gp(l,c.string,h),h:h.length*c.lineHeight});i[u]=f;const g=Vd(t.getIndexAngle(u)+a),m=Math.round(Ud(g));Py(n,e,g,Sy(m,d.x,f.w,0,180),Sy(m,d.y,f.h,90,270))}var l,c,h;t.setCenterPoint(e.l-n.l,n.r-e.r,e.t-n.t,n.b-e.b),t._pointLabelItems=function(t,e,n){const i=[],s=t._pointLabels.length,r=t.options,o=Ey(r)/2,a=t.drawingArea,l=r.pointLabels.centerPointLabels?kd/s:0;for(let r=0;r<s;r++){const s=t.getPointPosition(r,a+o+n[r],l),d=Math.round(Ud(Vd(s.angle+Sd))),p=e[r],f=My(s.y,p.h,d),g=Ry(d),m=(c=s.x,h=p.w,"right"===(u=g)?c-=h:"center"===u&&(c-=h/2),c);i.push({x:s.x,y:f,textAlign:g,left:m,top:f,right:m+p.w,bottom:f+p.h})}var c,h,u;return i}(t,i,s)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,n,i){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,n,i))}getIndexAngle(t){return Vd(t*(Id/(this._pointLabels.length||1))+Fd(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(ed(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(ed(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const n=e[t];return function(t,e,n){return yf(t,{label:n,index:e,type:"pointLabel"})}(this.getContext(),t,n)}}getPointPosition(t,e,n=0){const i=this.getIndexAngle(t)-Sd+n;return{x:Math.cos(i)*e+this.xCenter,y:Math.sin(i)*e+this.yCenter,angle:i}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:n,right:i,bottom:s}=this._pointLabelItems[t];return{left:e,top:n,right:i,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const n=this.ctx;n.save(),n.beginPath(),Oy(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),n.closePath(),n.fillStyle=t,n.fill(),n.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:n,grid:i}=e,s=this._pointLabels.length;let r,o,a;if(e.pointLabels.display&&function(t,e){const{ctx:n,options:{pointLabels:i}}=t;for(let s=e-1;s>=0;s--){const e=i.setContext(t.getPointLabelContext(s)),r=mf(e.font),{x:o,y:a,textAlign:l,left:c,top:h,right:u,bottom:d}=t._pointLabelItems[s],{backdropColor:p}=e;if(!ed(p)){const t=ff(e.borderRadius),i=gf(e.backdropPadding);n.fillStyle=p;const s=c-i.left,r=h-i.top,o=u-c+i.width,a=d-h+i.height;Object.values(t).some((t=>0!==t))?(n.beginPath(),lf(n,{x:s,y:r,w:o,h:a,radius:t}),n.fill()):n.fillRect(s,r,o,a)}of(n,t._pointLabels[s],o,a+r.lineHeight/2,r,{color:e.color,textAlign:l,textBaseline:"middle"})}}(this,s),i.display&&this.ticks.forEach(((t,e)=>{0!==e&&(o=this.getDistanceFromCenterForValue(t.value),function(t,e,n,i){const s=t.ctx,r=e.circular,{color:o,lineWidth:a}=e;!r&&!i||!o||!a||n<0||(s.save(),s.strokeStyle=o,s.lineWidth=a,s.setLineDash(e.borderDash),s.lineDashOffset=e.borderDashOffset,s.beginPath(),Oy(t,n,r,i),s.closePath(),s.stroke(),s.restore())}(this,i.setContext(this.getContext(e-1)),o,s))})),n.display){for(t.save(),r=s-1;r>=0;r--){const i=n.setContext(this.getPointLabelContext(r)),{color:s,lineWidth:l}=i;l&&s&&(t.lineWidth=l,t.strokeStyle=s,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,o=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),a=this.getPointPosition(r,o),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(a.x,a.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,n=e.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let s,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(i),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((i,o)=>{if(0===o&&!e.reverse)return;const a=n.setContext(this.getContext(o)),l=mf(a.font);if(s=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){t.font=l.string,r=t.measureText(i.label).width,t.fillStyle=a.backdropColor;const e=gf(a.backdropPadding);t.fillRect(-r/2-e.left,-s-l.size/2-e.top,r+e.width,l.size+e.height)}of(t,i.label,0,-s,l,{color:a.color})})),t.restore()}drawTitle(){}}Dy.id="radialLinear",Dy.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:qg.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},Dy.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},Dy.descriptors={angleLines:{_fallback:"grid"}};const Ny={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ay=Object.keys(Ny);function Ly(t,e){return t-e}function Fy(t,e){if(ed(e))return null;const n=t._adapter,{parser:i,round:s,isoWeekday:r}=t._parseOpts;let o=e;return"function"==typeof i&&(o=i(o)),sd(o)||(o="string"==typeof i?n.parse(o,i):n.parse(o)),null===o?null:(s&&(o="week"!==s||!Nd(r)&&!0!==r?n.startOf(o,s):n.startOf(o,"isoWeek",r)),+o)}function Uy(t,e,n,i){const s=Ay.length;for(let r=Ay.indexOf(t);r<s-1;++r){const t=Ny[Ay[r]],s=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((n-e)/(s*t.size))<=i)return Ay[r]}return Ay[s-1]}function jy(t,e,n){if(n){if(n.length){const{lo:i,hi:s}=Kd(n,e);t[n[i]>=e?n[i]:n[s]]=!0}}else t[e]=!0}function By(t,e,n){const i=[],s={},r=e.length;let o,a;for(o=0;o<r;++o)a=e[o],s[a]=o,i.push({value:a,major:!1});return 0!==r&&n?function(t,e,n,i){const s=t._adapter,r=+s.startOf(e[0].value,i),o=e[e.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,i))l=n[a],l>=0&&(e[l].major=!0);return e}(t,i,s,n):i}class zy extends Zg{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const n=t.time||(t.time={}),i=this._adapter=new om._date(t.adapters.date);i.init(e),gd(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:Fy(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,n=t.time.unit||"day";let{min:i,max:s,minDefined:r,maxDefined:o}=this.getUserBounds();function a(t){r||isNaN(t.min)||(i=Math.min(i,t.min)),o||isNaN(t.max)||(s=Math.max(s,t.max))}r&&o||(a(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||a(this.getMinMax(!1))),i=sd(i)&&!isNaN(i)?i:+e.startOf(Date.now(),n),s=sd(s)&&!isNaN(s)?s:+e.endOf(Date.now(),n)+1,this.min=Math.min(i,s-1),this.max=Math.max(i+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],n=t[t.length-1]),{min:e,max:n}}buildTicks(){const t=this.options,e=t.time,n=t.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const s=this.min,r=function(t,e,n){let i=0,s=t.length;for(;i<s&&t[i]<e;)i++;for(;s>i&&t[s-1]>n;)s--;return i>0||s<t.length?t.slice(i,s):t}(i,s,this.max);return this._unit=e.unit||(n.autoSkip?Uy(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(t,e,n,i,s){for(let r=Ay.length-1;r>=Ay.indexOf(n);r--){const n=Ay[r];if(Ny[n].common&&t._adapter.diff(s,i,n)>=e-1)return n}return Ay[n?Ay.indexOf(n):0]}(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(t){for(let e=Ay.indexOf(t)+1,n=Ay.length;e<n;++e)if(Ny[Ay[e]].common)return Ay[e]}(this._unit):void 0,this.initOffsets(i),t.reverse&&r.reverse(),By(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t){let e,n,i=0,s=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),i=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,n=this.getDecimalForValue(t[t.length-1]),s=1===t.length?n:(n-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;i=qd(i,0,r),s=qd(s,0,r),this._offsets={start:i,end:s,factor:1/(i+1+s)}}_generate(){const t=this._adapter,e=this.min,n=this.max,i=this.options,s=i.time,r=s.unit||Uy(s.minUnit,e,n,this._getLabelCapacity(e)),o=od(s.stepSize,1),a="week"===r&&s.isoWeekday,l=Nd(a)||!0===a,c={};let h,u,d=e;if(l&&(d=+t.startOf(d,"isoWeek",a)),d=+t.startOf(d,l?"day":r),t.diff(n,e,r)>1e5*o)throw new Error(e+" and "+n+" are too far apart with stepSize of "+o+" "+r);const p="data"===i.ticks.source&&this.getDataTimestamps();for(h=d,u=0;h<n;h=+t.add(h,o,r),u++)jy(c,h,p);return h!==n&&"ticks"!==i.bounds&&1!==u||jy(c,h,p),Object.keys(c).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,n=this.options.time;return n.tooltipFormat?e.format(t,n.tooltipFormat):e.format(t,n.displayFormats.datetime)}_tickFormatFunction(t,e,n,i){const s=this.options,r=s.time.displayFormats,o=this._unit,a=this._majorUnit,l=o&&r[o],c=a&&r[a],h=n[e],u=a&&c&&h&&h.major,d=this._adapter.format(t,i||(u?c:l)),p=s.ticks.callback;return p?ld(p,[d,e,n],this):d}generateTickLabels(t){let e,n,i;for(e=0,n=t.length;e<n;++e)i=t[e],i.label=this._tickFormatFunction(i.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,n=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+n)*e.factor)}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+n*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,n=this.ctx.measureText(t).width,i=Fd(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(i),r=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*s+o*r,h:n*r+o*s}}_getLabelCapacity(t){const e=this.options.time,n=e.displayFormats,i=n[e.unit]||n.millisecond,s=this._tickFormatFunction(t,0,By(this,[t],this._majorUnit),i),r=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return o>0?o:1}getDataTimestamps(){let t,e,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(t=0,e=i.length;t<e;++t)n=n.concat(i[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const t=this._cache.labels||[];let e,n;if(t.length)return t;const i=this.getLabels();for(e=0,n=i.length;e<n;++e)t.push(Fy(this,i[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Qd(t.sort(Ly))}}function Wy(t,e,n){let i,s,r,o,a=0,l=t.length-1;n?(e>=t[a].pos&&e<=t[l].pos&&({lo:a,hi:l}=Yd(t,"pos",e)),({pos:i,time:r}=t[a]),({pos:s,time:o}=t[l])):(e>=t[a].time&&e<=t[l].time&&({lo:a,hi:l}=Yd(t,"time",e)),({time:i,pos:r}=t[a]),({time:s,pos:o}=t[l]));const c=s-i;return c?r+(o-r)*(e-i)/c:r}zy.id="time",zy.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class Vy extends zy{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Wy(e,this.min),this._tableRange=Wy(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:n}=this,i=[],s=[];let r,o,a,l,c;for(r=0,o=t.length;r<o;++r)l=t[r],l>=e&&l<=n&&i.push(l);if(i.length<2)return[{time:e,pos:0},{time:n,pos:1}];for(r=0,o=i.length;r<o;++r)c=i[r+1],a=i[r-1],l=i[r],Math.round((c+a)/2)!==l&&s.push({time:l,pos:r/(o-1)});return s}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),n=this.getLabelTimestamps();return t=e.length&&n.length?this.normalize(e.concat(n)):e.length?e:n,t=this._cache.all=t,t}getDecimalForValue(t){return(Wy(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,n=this.getDecimalForPixel(t)/e.factor-e.end;return Wy(this._table,n*this._tableRange+this._minPos,!0)}}Vy.id="timeseries",Vy.defaults=zy.defaults;const Hy=[im,N_,by,Object.freeze({__proto__:null,CategoryScale:wy,LinearScale:Iy,LogarithmicScale:Ty,RadialLinearScale:Dy,TimeScale:zy,TimeSeriesScale:Vy})];u_.register(...Hy);const qy=u_;function $y(t){return $y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$y(t)}function Ky(){Ky=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,s=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function h(t,e,n,i){var r=e&&e.prototype instanceof _?e:_,o=Object.create(r.prototype),a=new R(i||[]);return s(o,"_invoke",{value:T(t,n,a)}),o}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",p="suspendedYield",f="executing",g="completed",m={};function _(){}function y(){}function v(){}var b={};c(b,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(M([])));x&&x!==n&&i.call(x,o)&&(b=x);var k=v.prototype=_.prototype=Object.create(b);function I(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(s,r,o,a){var l=u(t[s],t,r);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==$y(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){c.value=t,o(c)}),(function(t){return n("throw",t,o,a)}))}a(l.arg)}var r;s(this,"_invoke",{value:function(t,i){function s(){return new e((function(e,s){n(t,i,e,s)}))}return r=r?r.then(s,s):s()}})}function T(e,n,i){var s=d;return function(r,o){if(s===f)throw Error("Generator is already running");if(s===g){if("throw"===r)throw o;return{value:t,done:!0}}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var l=E(a,i);if(l){if(l===m)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(s===d)throw s=g,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s=f;var c=u(e,n,i);if("normal"===c.type){if(s=i.done?g:p,c.arg===m)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(s=g,i.method="throw",i.arg=c.arg)}}}function E(e,n){var i=n.method,s=e.iterator[i];if(s===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;var r=u(s,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,r=function n(){for(;++s<e.length;)if(i.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError($y(e)+" is not iterable")}return y.prototype=v,s(k,"constructor",{value:v,configurable:!0}),s(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},I(C.prototype),c(C.prototype,a,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,i,s,r){void 0===r&&(r=Promise);var o=new C(h(t,n,i,s),r);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},I(k),c(k,l,"Generator"),c(k,o,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=M,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(i,s){return a.type="throw",a.arg=e,n.next=i,s&&(n.method="next",n.arg=t),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var s=i.arg;P(n)}return s}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:M(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),m}},e}function Yy(t,e,n,i,s,r,o){try{var a=t[r](o),l=a.value}catch(t){return void n(t)}a.done?e(l):Promise.resolve(l).then(i,s)}function Gy(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var r=t.apply(e,n);function o(t){Yy(r,i,s,o,a,"next",t)}function a(t){Yy(r,i,s,o,a,"throw",t)}o(void 0)}))}}function Xy(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}var Jy=ee({apiKey:"AIzaSyAx1lKQb2eGX5oWBwtiuYmvuzmEd_X5cPM",authDomain:"test-dff46.firebaseapp.com",databaseURL:"https://test-dff46-default-rtdb.firebaseio.com",projectId:"test-dff46",storageBucket:"test-dff46.appspot.com",messagingSenderId:"153347507128",appId:"1:153347507128:web:72b46e4aff57e059fa854d",measurementId:"G-C4PKRQPK50"}),Qy=function(t=ne()){const e=Jt(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=Jt(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(D(n.getOptions(),null!=e?e:{}))return t;ye(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:Vi,persistence:[ui,Yn,Xn]}),i=g("authTokenSyncURL");if(i){const t=(s=i,async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>Ki)return;const i=null==e?void 0:e.token;Yi!==i&&(Yi=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(t,e,n){V(t).beforeAuthStateChanged(e,n)}(n,t,(()=>t(n.currentUser))),function(e){V(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}var s;const r=d("auth");return r&&function(t,e,n){const i=xn(t);we(i._canInitEmulator,i,"emulator-config-failed"),we(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),r=In(e),{host:o,port:a}=function(t){const e=In(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const t=s[1];return{host:t,port:Cn(i.substr(t.length+1))}}{const[t,e]=i.split(":");return{host:t,port:Cn(e)}}}(e),l=null===a?"":`:${a}`;i.config.emulator={url:`${r}//${o}${l}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(n,`http://${r}`),n}(Jy),Zy=function(t=ne(),e){const n=Jt(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const t=p("database");t&&function(t,e,n,i={}){(t=V(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&ps("Cannot call useEmulator() after instance has already been initialized.");const s=t._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ps('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Ms(Ms.OWNER);else if(i.mockUserToken){const e="string"==typeof i.mockUserToken?i.mockUserToken:_(i.mockUserToken,t.app.options.projectId);r=new Ms(e)}!function(t,e,n,i){t.repoInfo_=new Fs(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),i&&(t.authTokenProvider_=i)}(s,e,n,r)}(n,...t)}return n}(Jy),tv=function(t=ne(),e){const n=Jt(t=V(t),lh).getImmediate({identifier:e}),i=p("storage");return i&&function(t,e,n,i={}){!function(t,e,n,i={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=i;s&&(t._overrideAuthToken="string"==typeof s?s:_(s,t.app.options.projectId))}(t,e,n,i)}(n,...i),n}(Jy),ev=function(t=ne()){return async function(){try{await x()}catch(t){return!1}return"undefined"!=typeof window&&w()&&!("undefined"==typeof navigator||!navigator.cookieEnabled)&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}().then((t=>{if(!t)throw Uu.create("unsupported-browser")}),(t=>{throw Uu.create("indexed-db-unsupported")})),Jt(V(t),"messaging").getImmediate()}(Jy),nv=document.querySelector(".user-info"),iv=document.getElementById("user-name"),sv=document.getElementById("user-image"),rv=document.getElementById("user-heart-rate"),ov=document.getElementById("sign-out"),av=document.getElementById("edit-profile"),lv=document.getElementById("edit-profile-modal"),cv=document.querySelector(".close-button"),hv=document.getElementById("edit-profile-form"),uv=document.getElementById("edit-error-message"),dv=document.querySelector(".container"),pv=document.createElement("div");pv.id="error-message",pv.style.color="red",pv.style.position="fixed",pv.style.top="20px",pv.style.left="50%",pv.style.transform="translateX(-50%)",pv.style.backgroundColor="#ffbaba",pv.style.color="#d8000c",pv.style.padding="10px 20px",pv.style.borderRadius="8px",pv.style.display="none",pv.style.zIndex="1000",dv?dv.prepend(pv):console.error("container ");var fv=document.querySelector(".permitted-users"),gv=document.getElementById("permitted-users-list"),mv=document.getElementById("loading-screen"),_v={};function yv(t){pv.textContent=t,pv.style.display="block",setTimeout((function(){pv.textContent="",pv.style.display="none"}),5e3)}function vv(t){uv?(uv.textContent=t,uv.style.display="block",setTimeout((function(){uv.textContent="",uv.style.display="none"}),5e3)):console.error("edit-error-message ")}function bv(){lv?(lv.style.display="none",vv(""),Dv()):console.error("edit-profile-modal ")}function wv(){mv?mv.style.display="flex":console.error("loading-screen ")}function xv(){mv?mv.style.display="none":console.error("loading-screen ")}function kv(t){return new Promise((function(e,n){tc(Xl(Zy,"Username/".concat(t))).then((function(t){var n=t.val();n?(iv.textContent=n.UName||"",sv.src=n.Uimage||"https://via.placeholder.com/100"):(iv.textContent="",sv.src="https://via.placeholder.com/100"),e()})).catch((function(t){console.error(":",t),yv(""),n(t)}));var i=Xl(Zy,"Userdata/".concat(t,"/Heartbeat/Watch1"));ic(i,(function(n){var s=n.val();if(s&&s.HeartRate){rv.textContent=s.HeartRate;var r=Xl(Zy,"Userdata/".concat(t,"/HeartbeatHistory"));Ql(Xl(r,Date.now().toString(36)+Math.random().toString(36).substr(2,5)),{HeartRate:s.HeartRate,timestamp:lc()}).then((function(){console.log("")})).catch((function(t){console.error(":",t),yv("")}))}else rv.textContent="-";!function(t){var e=document.getElementById("qr-code");e&&t?(e.innerHTML="",new QRCode(e,{text:t,width:180,height:180,colorDark:"#1d1d1f",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})):console.error("QRUID")}(t),i.off("value"),e()}),(function(t){console.error(":",t),yv(""),n(t)}))}))}function Iv(t){return new Promise((function(e,n){tc(Xl(Zy,"AcceptUser/".concat(t,"/permittedUser"))).then((function(t){var i=t.val();if(gv?gv.innerHTML="":console.error("permitted-users-list "),i){var s=Object.keys(i).filter((function(t){return!0===i[t]}));if(0===s.length){var r=_v.no_friends||"";return gv&&(gv.innerHTML="<p>".concat(r,"</p>")),void e()}Promise.all(s.map((function(t){return function(t){return new Promise((function(e,n){var i=Xl(Zy,"Username/".concat(t)),s=Xl(Zy,"Userdata/".concat(t,"/Heartbeat/Watch1"));Promise.all([tc(i),tc(s)]).then((function(t){var n,i,s=(i=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,s,r,o,a=[],l=!0,c=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(a.push(i.value),a.length!==e);l=!0);}catch(t){c=!0,s=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw s}}return a}}(n,i)||function(t,e){if(t){if("string"==typeof t)return Xy(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xy(t,e):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=s[0],o=s[1],a=r.val(),l=o.val(),c=a&&a.UName||"",h=a&&a.Uimage||"https://via.placeholder.com/90",u=l&&l.HeartRate?l.HeartRate:"-",d=document.createElement("div");d.className="user-card";var p=document.createElement("img");p.src=h,p.alt="".concat(c," "),p.loading="lazy";var f=document.createElement("div");f.className="user-info",f.innerHTML='<p class="user-name">'.concat(c,'</p><p class="heart-rate">').concat(u,"</p>"),d.appendChild(p),d.appendChild(f),gv&&gv.appendChild(d),e()})).catch((function(t){console.error(":",t),yv(""),n(t)}))}))}(t)}))).then((function(){e()})).catch((function(t){console.error(":",t),yv(""),n(t)}))}else{var o=_v.no_friends||"";gv&&(gv.innerHTML="<p>".concat(o,"</p>")),e()}})).catch((function(t){console.error(":",t),yv(""),n(t)}))}))}window.addEventListener("load",(function(){fetch("lang/".concat("ja",".json")).then((function(t){return t.json()})).then((function(t){_v=t,function(){var t=document.getElementById("header-title");t&&(t.textContent=_v.header_title||"");var e=document.querySelector(".user-info h2");e&&(e.textContent=_v.user_info_title||"");var n=document.getElementById("edit-profile");n&&(n.textContent=_v.edit_profile||"");var i=document.getElementById("sign-out");i&&(i.textContent=_v.sign_out||"")}()})).catch((function(t){console.error(":",t)})),Qy.currentUser&&async function(t){return Gu(t=V(t),{vapidKey:"YOUR_PUBLIC_VAPID_KEY"})}(ev).then((function(t){if(t){console.log("FCM:",t);var e=Qy.currentUser.uid;Ql(Xl(Zy,"Users/".concat(e,"/fcmToken")),t).then((function(){console.log("FCM")})).catch((function(t){console.error("FCM:",t),yv("")}))}else console.warn(""),yv("")})).catch((function(t){console.error(":",t),yv("")}))})),av?av.addEventListener("click",(function(){lv?(lv.style.display="block",hv["edit-username"]?hv["edit-username"].value=iv.textContent:console.error("edit-username ")):console.error("edit-profile-modal ")})):console.error("edit-profile "),cv?cv.addEventListener("click",bv):console.error("close-button "),window.addEventListener("click",(function(t){lv&&t.target==lv&&bv()})),window.addEventListener("keydown",(function(t){"Escape"===t.key&&lv&&"block"===lv.style.display&&bv()})),function(t){V(t).onAuthStateChanged((function(t){t?(console.log(":",t),nv&&(nv.style.display="flex"),fv&&(fv.style.display="block"),wv(),Promise.all([kv(t.uid),Iv(t.uid)]).then((function(){!function(t){ic(Xl(Zy,"Userdata/".concat(t,"/HeartbeatHistory")),(function(t){var e=t.val();if(e){var n=Object.entries(e).sort((function(t,e){return t[1].timestamp-e[1].timestamp})),i=n.map((function(t){return new Date(t[1].timestamp).toLocaleString()})),s=n.map((function(t){return t[1].HeartRate}));Tv?(Tv.data.labels=i,Tv.data.datasets[0].data=s,Tv.update()):Tv=new qy(Cv,{type:"line",data:{labels:i,datasets:[{label:"",data:s,borderColor:"#e74c3c",backgroundColor:"rgba(231, 76, 60, 0.2)",fill:!0,tension:.4}]},options:{responsive:!0,scales:{x:{display:!0,title:{display:!0,text:""}},y:{display:!0,title:{display:!0,text:""},suggestedMin:60,suggestedMax:100}}}})}}),(function(t){console.error(":",t),yv("")}))}(t.uid),xv()})).catch((function(t){console.error(":",t),yv(""),xv()}))):(console.log(""),nv&&(nv.style.display="none"),fv&&(fv.style.display="none"),gv&&(gv.innerHTML=""),window.location.href="index.html")}),void 0,void 0)}(Qy);var Cv=document.getElementById("heartRateChart").getContext("2d"),Tv=null;!function(t){!function(t,e){if(!navigator)throw Uu.create("only-available-in-window");t.onMessageHandler=e}(t=V(t),(function(t){console.log(":",t);var e=t.notification.title,n={body:t.notification.body,icon:t.notification.icon||"https://via.placeholder.com/100"};"granted"===Notification.permission&&new Notification(e,n)}))}(ev),ov?ov.addEventListener("click",(function(){(function(t){return V(t).signOut()})(Qy).then((function(){console.log(""),window.location.href="index.html"})).catch((function(t){console.error(":",t),yv("")}))})):console.error("sign-out ");var Ev=document.getElementById("friend-search");Ev?Ev.addEventListener("keyup",(function(){var t=document.getElementById("friend-search");if(t){var e=t.value.toLowerCase();if(gv)for(var n=gv.getElementsByClassName("user-card"),i=0;i<n.length;i++){var s=n[i].getElementsByClassName("user-info")[0];if(s){var r=s.getElementsByTagName("p")[0];r?r.innerText.toLowerCase().includes(e)?n[i].style.display="":n[i].style.display="none":console.error("user-name ")}else console.error("user-info ")}else console.error("permitted-users-list ")}else console.error("friend-search ")})):console.error("friend-search "),document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("menu-toggle"),e=document.getElementById("sidebar"),n=document.getElementById("sidebar-overlay");if(t&&e&&n){var i=function(){e.classList.remove("active"),n.classList.remove("active")};t.addEventListener("click",(function(){e.classList.contains("active")?i():(e.classList.add("active"),n.classList.add("active"))})),n.addEventListener("click",(function(){i()})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.classList.contains("active")&&i()}))}else console.error("")}));var Sv=document.getElementById("drop-zone"),Pv=(document.getElementById("image-input"),document.getElementById("crop-container")),Rv=document.querySelector("#image-preview img"),Mv=null,Ov=null;function Dv(){if(Sv&&Pv&&Rv){Sv.style.display="block";var t=document.querySelector(".crop-editor");t?t.style.display="none":console.error("crop-editor "),Nv(),Ov=null,Rv.src=""}else console.error("")}function Nv(){Mv&&(Mv.destroy(),Mv=null)}function Av(){return Lv.apply(this,arguments)}function Lv(){return Lv=Gy(Ky().mark((function t(){var e;return Ky().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Mv){t.next=2;break}throw new Error("");case 2:return e=Mv.getCroppedCanvas({width:512,height:512,fillColor:"#fff",imageSmoothingQuality:"high"}),t.abrupt("return",new Promise((function(t,n){e.toBlob((function(e){e?t(e):n(new Error(""))}),"image/jpeg",.95)})));case 4:case"end":return t.stop()}}),t)}))),Lv.apply(this,arguments)}function Fv(){return(Fv=Gy(Ky().mark((function t(){var e,n,i;return Ky().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Av();case 3:e=t.sent,n=URL.createObjectURL(e),Rv.src=n,(i=document.querySelector(".crop-editor"))&&(i.style.display="none"),Sv&&(Sv.style.display="block"),Nv(),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),vv(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}var Uv=document.querySelector(".crop-cancel-btn"),jv=document.querySelector(".crop-confirm-btn");function Bv(t,e){return zv.apply(this,arguments)}function zv(){return zv=Gy(Ky().mark((function t(e,n){var i,s,r,o;return Ky().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="profile_".concat(Date.now(),".jpg"),a=tv,l="users/".concat(n,"/images/").concat(i),s=ih(a=V(a),l),t.next=4,ch(s,e);case 4:return r=t.sent,t.next=7,hh(r.ref);case 7:return o=t.sent,t.abrupt("return",o);case 9:case"end":return t.stop()}var a,l}),t)}))),zv.apply(this,arguments)}function Wv(t,e,n){return Vv.apply(this,arguments)}function Vv(){return Vv=Gy(Ky().mark((function t(e,n,i){var s,r;return Ky().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={UName:n,Uimage:i,lastUpdated:lc()},r=Xl(Zy,"Username/".concat(e)),t.next=4,Zl(r,s);case 4:case"end":return t.stop()}}),t)}))),Vv.apply(this,arguments)}Uv?Uv.addEventListener("click",Dv):console.error("crop-cancel-btn "),jv?jv.addEventListener("click",(function(){return Fv.apply(this,arguments)})):console.error("crop-confirm-btn "),hv?hv.addEventListener("submit",function(){var t=Gy(Ky().mark((function t(e){var n,i,s,r,o;return Ky().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),n=hv["edit-username"]){t.next=6;break}return vv("edit-username "),console.error("edit-username "),t.abrupt("return");case 6:if(i=n.value.trim(),s=Qy.currentUser?Qy.currentUser.uid:null){t.next=12;break}return vv(""),console.error(""),t.abrupt("return");case 12:if(i){t.next=16;break}return vv(""),console.error(""),t.abrupt("return");case 16:if(t.prev=16,wv(),console.log(""),r=sv.src,console.log("URL:",r),!Ov||!Mv){t.next=31;break}return console.log(""),t.next=25,Av();case 25:return o=t.sent,console.log("Cropped Blob :",o),t.next=29,Bv(o,s);case 29:r=t.sent,console.log("URL:",r);case 31:return t.next=33,Wv(s,i,r);case 33:console.log("Firebase Realtime Database "),iv.textContent=i,sv.src=r,console.log("UI"),bv(),console.log(""),t.next=45;break;case 41:t.prev=41,t.t0=t.catch(16),vv(": ".concat(t.t0.message)),console.error(":",t.t0);case 45:return t.prev=45,xv(),console.log(""),t.finish(45);case 49:case"end":return t.stop()}}),t,null,[[16,41,45,49]])})));return function(e){return t.apply(this,arguments)}}()):console.error("edit-profile-form ")})();
//# sourceMappingURL=main.bundle.js.map